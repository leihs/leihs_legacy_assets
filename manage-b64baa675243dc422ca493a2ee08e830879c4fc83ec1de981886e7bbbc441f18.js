!function(t){function e(t,e){return t[0]<e[0]?-1:t[0]>e[0]?1:0}function n(t,e){return t[0]>e[0]?-1:t[0]<e[0]?1:0}var r=new Array;new Array;t.fn.jqBarGraph=t.fn.jqbargraph=function(s){init=function(e){r[e.id]=t.extend({},t.fn.jqBarGraph.defaults,s),t(e).css({width:r[e.id].width,height:r[e.id].height,position:"relative","text-align":"center"}),doGraph(e),doGrid(e)},sum=function(t){total=0;for(val in t)total+=t[val];return total.toFixed(2)},maxVal=function(t){maxvalue=0;for(var e in t)value=t[e][0],value instanceof Array&&(value=sum(value)),parseFloat(value)>parseFloat(maxvalue)&&(maxvalue=value);return maxvalue},maxMulti=function(t){maxvalue=0,maxvalue2=0;for(var e in t){ar2=t[e][0];for(var n in ar2)ar2[n]>maxvalue2&&(maxvalue2=ar2[n]);maxvalue2>maxvalue&&(maxvalue=maxvalue2)}return maxvalue},doGraph=function(s){if(arr=r[s.id],data=arr.data,void 0==data)return void t(s).html("There is not enought data for graph");"asc"==arr.sort&&data.sort(e),"desc"==arr.sort&&data.sort(n),legend="",prefix=arr.prefix,postfix=arr.postfix,space=arr.barSpace,legendWidth=arr.legend?arr.legendWidth:0,gridSpace=arr.gridSpace,fieldWidth=(t(s).width()-legendWidth-gridSpace)/data.length,totalHeight=t(s).height();var a=new Array;max=maxVal(data),colPosition=0;for(var l in data){if(valueData=data[l][0],valueData instanceof Array?value=parseFloat(sum(valueData)):value=parseFloat(valueData),lbl=data[l][1],color=data[l][2],unique=l+s.id,void 0==color&&0==arr.colors&&(color=arr.color),arr.colors&&!color&&(colorsCounter=arr.colors.length,colorsCounter==colPosition&&(colPosition=0),color=arr.colors[colPosition],colPosition++),"multi"==arr.type&&(color="none"),void 0==lbl&&(lbl=arr.lbl),out="<div class='graphField"+s.id+"' id='graphField"+unique+"' style='position: absolute'>",lbl.value?out+="<div class='graphValue"+s.id+"' id='graphValue"+unique+"'>"+lbl.value+"</div>":out+="<div class='graphValue"+s.id+"' id='graphValue"+unique+"'>"+prefix+value+postfix+"</div>",out+="<div class='graphBar"+s.id+"' id='graphFieldBar"+unique+"' style='background-color:"+color+";position: relative; overflow: hidden;'></div>",(!arr.legend||arr.legends)&&(out+="<div class='graphLabel"+s.id+"' id='graphLabel"+unique+"'>"+lbl.name+"</div>"),out+="</div>",t(s).append(out),totalHeightBar=totalHeight-t(".graphLabel"+s.id).outerHeight()-t(".graphValue"+s.id).outerHeight(),fieldHeight=totalHeightBar*value/max,t("#graphField"+unique).css({left:fieldWidth*l+gridSpace,width:fieldWidth-space,"margin-left":space/2,"margin-right":space/2}),valueData instanceof Array){"multi"==arr.type?(maxe=maxMulti(data),totalHeightBar=fieldHeight=totalHeight-t(".graphLabel"+s.id).height(),t(".graphValue"+s.id).remove()):maxe=max;for(i in valueData)heig=totalHeightBar*valueData[i]/maxe,wid=parseInt((fieldWidth-space)/valueData.length),sv="",fs=0,valueElement="",arr.showValues&&0!=valueData[i]&&sum(valueData)!=valueData[i]&&(sv=arr.prefix+valueData[i]+arr.postfix,fs=12,valueElement="<span class='text'>"+sv+"</span>"),o="<div class='subBars"+s.id+"' style='height:"+heig+"px; background-color: "+arr.colors[i]+"; left:"+wid*i+"px; color:"+arr.showValuesColor+"; font-size:"+fs+"px' ></div>",t("#graphFieldBar"+unique).prepend(o)}"multi"==arr.type&&t(".subBars"+s.id).css({width:wid,position:"absolute",bottom:0}),"bottom"==arr.position&&t(".graphField"+s.id).css("bottom",0),arr.legends||a.push([color,lbl,s.id,unique]),arr.animate?(t("#graphFieldBar"+unique).css({height:0}),t("#graphFieldBar"+unique).animate({height:fieldHeight},1e3*arr.speed)):t("#graphFieldBar"+unique).css({height:fieldHeight})}for(var d in arr.legends)a.push([arr.colors[d],arr.legends[d],s.id,d]);createLegend(a),arr.legend&&(t(s).append("<div id='legendHolder"+unique+"'></div>"),t("#legendHolder"+unique).css({width:legendWidth,"float":"right","text-align":"left"}),t("#legendHolder"+unique).append(legend),t(".legendBar"+s.id).css({"float":"left",margin:3,height:12,width:20,"font-size":0})),arr.title&&(t(s).wrap("<div id='graphHolder"+unique+"'></div>"),t("#graphHolder"+unique).prepend(arr.title).css({width:arr.width+"px","text-align":"center"}))},doGrid=function(e){if(s=r[e.id],s.grid){arr=r[e.id],data=arr.data;var n=parseFloat(maxVal(data)),i=Math.floor(n/Math.pow(10,n.toString().length-1));i*=Math.pow(10,n.toString().length-1),i=arr.gridAtMax?n:i;for(var o=i/arr.gridSections,a=[],l=i/arr.gridSections/(arr.interGrids+1),d=[],p=0;p<arr.gridSections;p++){a.push(Math.round(o*p));for(var u=1;u<=arr.interGrids;u++)d.push(a[p]+l*u)}a.push(i);for(var c=arr.gridColors,h=t(e).find(".graphLabel").first().outerHeight(),f=t(e).find(".graphValue").first().outerHeight(),v="<div class='bar-grid' style='position:absolute; height:"+s.height+"px; width:"+s.width+"px;'>",p=0;p<a.length;p++)y=(n-a[p])/n,y=y===-(1/0)?0:y,y=y*(s.height-h-f)+f,v+="<div class='grid-line' style='border-top: 1px solid "+c[0]+";display:block; width: "+s.width+"px;position:absolute; top:"+y+"px'>",v+="<span class='grid-text' style='position: absolute; left: 0; top:-5px;'></span>",v+="<hr/>",v+="</div>";for(var p=0;p<d.length;p++)y=(n-d[p])/n,y=y===-(1/0)?0:y,y=y*(s.height-h-f)+f,v+="<div class='grid-line grid-intermediate' style='border-top: 1px solid "+c[1]+";opacity: 0.5;block; width: "+s.width+"px;position:absolute; top:"+y+"px'>",v+="<hr/>",v+="</div>";v+="</div>",t(e).prepend(v)}},createLegend=function(t){legend="";for(var e in t)legend+="<div id='legend"+t[e][3]+"' style='overflow: hidden; zoom: 1;'>",legend+="<div class='legendBar"+t[e][2]+"' id='legendColor"+t[e][3]+"' style='background-color:"+t[e][0]+"'></div>",legend+="<div class='legendLabel"+t[e][2]+"' id='graphLabel"+unique+"'>"+t[e][1]+"</div>",legend+="</div>"},this.each(function(){init(this)})},t.fn.jqBarGraph.defaults={barSpace:10,width:400,height:300,color:"#000000",colors:!1,lbl:"",sort:!1,position:"bottom",prefix:"",postfix:"",animate:!0,speed:1.5,legendWidth:100,legend:!1,legends:!1,type:!1,showValues:!0,showValuesColor:"#fff",title:!1,grid:!0,gridSpace:20,gridAtMax:!1,gridSections:2,gridColors:["#444444","#AAAAAA"],interGrids:1}}(jQuery),function(t){var e,n={className:"autosizejs",id:"autosizejs",append:"\n",callback:!1,resizeDelay:10,placeholder:!0},i=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent","whiteSpace"],r=t('<textarea tabindex="-1"/>').data("autosize",!0)[0];r.style.cssText="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; padding: 0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden; transition:none; -webkit-transition:none; -moz-transition:none;",r.style.lineHeight="99px","99px"===t(r).css("lineHeight")&&i.push("lineHeight"),r.style.lineHeight="",t.fn.autosize=function(o){return this.length?(o=t.extend({},n,o||{}),r.parentNode!==document.body&&t(document.body).append(r),this.each(function(){function n(){var e,n=window.getComputedStyle?window.getComputedStyle(c,null):null;n?(e=parseFloat(n.width),("border-box"===n.boxSizing||"border-box"===n.webkitBoxSizing||"border-box"===n.mozBoxSizing)&&t.each(["paddingLeft","paddingRight","borderLeftWidth","borderRightWidth"],function(t,i){e-=parseFloat(n[i])})):e=h.width(),r.style.width=Math.max(e,0)+"px"}function s(){var s={};if(e=c,r.className=o.className,r.id=o.id,d=parseFloat(h.css("maxHeight")),t.each(i,function(t,e){s[e]=h.css(e)}),t(r).css(s).attr("wrap",h.attr("wrap")),n(),window.chrome){var a=c.style.width;c.style.width="0px";c.offsetWidth;c.style.width=a}}function a(){var t,i;e!==c?s():n(),!c.value&&o.placeholder?r.value=h.attr("placeholder")||"":r.value=c.value,r.value+=o.append||"",r.style.overflowY=c.style.overflowY,i=parseFloat(c.style.height)||0,r.scrollTop=0,r.scrollTop=9e4,t=r.scrollTop,d&&t>d?(c.style.overflowY="scroll",t=d):(c.style.overflowY="hidden",p>t&&(t=p)),t+=f,Math.abs(i-t)>.01&&(c.style.height=t+"px",r.className=r.className,v&&o.callback.call(c,c),h.trigger("autosize.resized"))}function l(){clearTimeout(u),u=setTimeout(function(){var t=h.width();t!==g&&(g=t,a())},parseInt(o.resizeDelay,10))}var d,p,u,c=this,h=t(c),f=0,v=t.isFunction(o.callback),m={height:c.style.height,overflow:c.style.overflow,overflowY:c.style.overflowY,wordWrap:c.style.wordWrap,resize:c.style.resize},g=h.width(),y=h.css("resize");h.data("autosize")||(h.data("autosize",!0),("border-box"===h.css("box-sizing")||"border-box"===h.css("-moz-box-sizing")||"border-box"===h.css("-webkit-box-sizing"))&&(f=h.outerHeight()-h.height()),p=Math.max(parseFloat(h.css("minHeight"))-f||0,h.height()),h.css({overflow:"hidden",overflowY:"hidden",wordWrap:"break-word"}),"vertical"===y?h.css("resize","none"):"both"===y&&h.css("resize","horizontal"),"onpropertychange"in c?"oninput"in c?h.on("input.autosize keyup.autosize",a):h.on("propertychange.autosize",function(){"value"===event.propertyName&&a()}):h.on("input.autosize",a),o.resizeDelay!==!1&&t(window).on("resize.autosize",l),h.on("autosize.resize",a),h.on("autosize.resizeIncludeStyle",function(){e=null,a()}),h.on("autosize.destroy",function(){e=null,clearTimeout(u),t(window).off("resize",l),h.off("autosize").off(".autosize").css(m).removeData("autosize")}),a())})):this}}(jQuery||$),function(){}.call(this),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t(window.jQuery)}(function(t){"use strict";var e=0,n=["accepts","cache","contents","contentType","crossDomain","data","dataType","headers","ifModified","mimeType","password","processData","timeout","traditional","type","url","username"],i=function(t){return t};t.ajaxSetup({converters:{"postmessage text":i,"postmessage json":i,"postmessage html":i}}),t.ajaxTransport("postmessage",function(i){if(i.postMessage&&window.postMessage){var r,o=t("<a>").prop("href",i.postMessage)[0],s=o.protocol+"//"+o.host,a=i.xhr().upload;return{send:function(o,l){e+=1;var d={id:"postmessage-transport-"+e},p="message."+d.id;r=t('<iframe style="display:none;" src="'+i.postMessage+'" name="'+d.id+'"></iframe>').bind("load",function(){t.each(n,function(t,e){d[e]=i[e]}),d.dataType=d.dataType.replace("postmessage ",""),t(window).bind(p,function(e){e=e.originalEvent;var n,i=e.data;e.origin===s&&i.id===d.id&&("progress"===i.type?(n=document.createEvent("Event"),n.initEvent(i.type,!1,!0),t.extend(n,i),a.dispatchEvent(n)):(l(i.status,i.statusText,{postmessage:i.result},i.headers),r.remove(),t(window).unbind(p)))}),r[0].contentWindow.postMessage(d,s)}).appendTo(document.body)},abort:function(){r&&r.remove()}}}})}),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t(window.jQuery)}(function(t){"use strict";window.XDomainRequest&&!t.support.cors&&t.ajaxTransport(function(e){if(e.crossDomain&&e.async){e.timeout&&(e.xdrTimeout=e.timeout,delete e.timeout);var n;return{send:function(i,r){function o(e,i,o,s){n.onload=n.onerror=n.ontimeout=t.noop,n=null,r(e,i,o,s)}var s=/\?/.test(e.url)?"&":"?";n=new XDomainRequest,"DELETE"===e.type?(e.url=e.url+s+"_method=DELETE",e.type="POST"):"PUT"===e.type?(e.url=e.url+s+"_method=PUT",e.type="POST"):"PATCH"===e.type&&(e.url=e.url+s+"_method=PATCH",e.type="POST"),n.open(e.type,e.url),n.onload=function(){o(200,"OK",{text:n.responseText},"Content-Type: "+n.contentType)},n.onerror=function(){o(404,"Not Found")},e.xdrTimeout&&(n.ontimeout=function(){o(0,"timeout")},n.timeout=e.xdrTimeout),n.send(e.hasContent&&e.data||null)},abort:function(){n&&(n.onerror=t.noop(),n.abort())}}}})}),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],t):t(window.jQuery)}(function(t){"use strict";t.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||t('<input type="file">').prop("disabled")),t.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),t.support.xhrFormDataFileUpload=!!window.FormData,t.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),t.widget("blueimp.fileupload",{options:{dropZone:t(document),pasteZone:t(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(e,n){return e=this.messages[e]||e.toString(),n&&t.each(n,function(t,n){e=e.replace("{"+t+"}",n)}),e},formData:function(t){return t.serializeArray()},add:function(e,n){return e.isDefaultPrevented()?!1:void((n.autoUpload||n.autoUpload!==!1&&t(this).fileupload("option","autoUpload"))&&n.process().done(function(){n.submit()}))},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:t.support.blobSlice&&function(){var t=this.slice||this.webkitSlice||this.mozSlice;return t.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(t,e,n){var i=t-this.timestamp;return(!this.bitrate||!n||i>n)&&(this.bitrate=(e-this.loaded)*(1e3/i)*8,this.loaded=e,this.timestamp=t),this.bitrate}},_isXHRUpload:function(e){return!e.forceIframeTransport&&(!e.multipart&&t.support.xhrFileUpload||t.support.xhrFormDataFileUpload)},_getFormData:function(e){var n;return"function"==typeof e.formData?e.formData(e.form):t.isArray(e.formData)?e.formData:"object"===t.type(e.formData)?(n=[],t.each(e.formData,function(t,e){n.push({name:t,value:e})}),n):[]},_getTotal:function(e){var n=0;return t.each(e,function(t,e){n+=e.size||1}),n},_initProgressObject:function(e){var n={loaded:0,total:0,bitrate:0};e._progress?t.extend(e._progress,n):e._progress=n},_initResponseObject:function(t){var e;if(t._response)for(e in t._response)t._response.hasOwnProperty(e)&&delete t._response[e];else t._response={}},_onProgress:function(e,n){if(e.lengthComputable){var i,r=Date.now?Date.now():(new Date).getTime();if(n._time&&n.progressInterval&&r-n._time<n.progressInterval&&e.loaded!==e.total)return;n._time=r,i=Math.floor(e.loaded/e.total*(n.chunkSize||n._progress.total))+(n.uploadedBytes||0),this._progress.loaded+=i-n._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(r,this._progress.loaded,n.bitrateInterval),n._progress.loaded=n.loaded=i,n._progress.bitrate=n.bitrate=n._bitrateTimer.getBitrate(r,i,n.bitrateInterval),this._trigger("progress",t.Event("progress",{delegatedEvent:e}),n),this._trigger("progressall",t.Event("progressall",{delegatedEvent:e}),this._progress)}},_initProgressListener:function(e){var n=this,i=e.xhr?e.xhr():t.ajaxSettings.xhr();i.upload&&(t(i.upload).bind("progress",function(t){var i=t.originalEvent;t.lengthComputable=i.lengthComputable,t.loaded=i.loaded,t.total=i.total,n._onProgress(t,e)}),e.xhr=function(){return i})},_isInstanceOf:function(t,e){return Object.prototype.toString.call(e)==="[object "+t+"]"},_initXHRData:function(e){var n,i=this,r=e.files[0],o=e.multipart||!t.support.xhrFileUpload,s=e.paramName[0];e.headers=t.extend({},e.headers),e.contentRange&&(e.headers["Content-Range"]=e.contentRange),o&&!e.blob&&this._isInstanceOf("File",r)||(e.headers["Content-Disposition"]='attachment; filename="'+encodeURI(r.name)+'"'),o?t.support.xhrFormDataFileUpload&&(e.postMessage?(n=this._getFormData(e),e.blob?n.push({name:s,value:e.blob}):t.each(e.files,function(t,i){n.push({name:e.paramName[t]||s,value:i})})):(i._isInstanceOf("FormData",e.formData)?n=e.formData:(n=new FormData,t.each(this._getFormData(e),function(t,e){n.append(e.name,e.value)})),e.blob?n.append(s,e.blob,r.name):t.each(e.files,function(t,r){(i._isInstanceOf("File",r)||i._isInstanceOf("Blob",r))&&n.append(e.paramName[t]||s,r,r.uploadName||r.name)})),e.data=n):(e.contentType=r.type,e.data=e.blob||r),e.blob=null},_initIframeSettings:function(e){var n=t("<a></a>").prop("href",e.url).prop("host");e.dataType="iframe "+(e.dataType||""),e.formData=this._getFormData(e),e.redirect&&n&&n!==location.host&&e.formData.push({name:e.redirectParamName||"redirect",value:e.redirect})},_initDataSettings:function(t){this._isXHRUpload(t)?(this._chunkedUpload(t,!0)||(t.data||this._initXHRData(t),this._initProgressListener(t)),t.postMessage&&(t.dataType="postmessage "+(t.dataType||""))):this._initIframeSettings(t)},_getParamName:function(e){var n=t(e.fileInput),i=e.paramName;return i?t.isArray(i)||(i=[i]):(i=[],n.each(function(){for(var e=t(this),n=e.prop("name")||"files[]",r=(e.prop("files")||[1]).length;r;)i.push(n),r-=1}),i.length||(i=[n.prop("name")||"files[]"])),i},_initFormSettings:function(e){e.form&&e.form.length||(e.form=t(e.fileInput.prop("form")),e.form.length||(e.form=t(this.options.fileInput.prop("form")))),e.paramName=this._getParamName(e),e.url||(e.url=e.form.prop("action")||location.href),e.type=(e.type||"string"===t.type(e.form.prop("method"))&&e.form.prop("method")||"").toUpperCase(),"POST"!==e.type&&"PUT"!==e.type&&"PATCH"!==e.type&&(e.type="POST"),e.formAcceptCharset||(e.formAcceptCharset=e.form.attr("accept-charset"))},_getAJAXSettings:function(e){var n=t.extend({},this.options,e);return this._initFormSettings(n),this._initDataSettings(n),n},_getDeferredState:function(t){return t.state?t.state():t.isResolved()?"resolved":t.isRejected()?"rejected":"pending"},_enhancePromise:function(t){return t.success=t.done,t.error=t.fail,t.complete=t.always,t},_getXHRPromise:function(e,n,i){var r=t.Deferred(),o=r.promise();return n=n||this.options.context||o,e===!0?r.resolveWith(n,i):e===!1&&r.rejectWith(n,i),o.abort=r.promise,this._enhancePromise(o)},_addConvenienceMethods:function(e,n){var i=this,r=function(e){return t.Deferred().resolveWith(i,e).promise()};n.process=function(e,o){return(e||o)&&(n._processQueue=this._processQueue=(this._processQueue||r([this])).pipe(function(){return n.errorThrown?t.Deferred().rejectWith(i,[n]).promise():r(arguments)}).pipe(e,o)),this._processQueue||r([this])},n.submit=function(){return"pending"!==this.state()&&(n.jqXHR=this.jqXHR=i._trigger("submit",t.Event("submit",{delegatedEvent:e}),this)!==!1&&i._onSend(e,this)),this.jqXHR||i._getXHRPromise()},n.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",i._getXHRPromise())},n.state=function(){return this.jqXHR?i._getDeferredState(this.jqXHR):this._processQueue?i._getDeferredState(this._processQueue):void 0},n.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===i._getDeferredState(this._processQueue)},n.progress=function(){return this._progress},n.response=function(){return this._response}},_getUploadedBytes:function(t){var e=t.getResponseHeader("Range"),n=e&&e.split("-"),i=n&&n.length>1&&parseInt(n[1],10);return i&&i+1},_chunkedUpload:function(e,n){e.uploadedBytes=e.uploadedBytes||0;var i,r,o=this,s=e.files[0],a=s.size,l=e.uploadedBytes,d=e.maxChunkSize||a,p=this._blobSlice,u=t.Deferred(),c=u.promise();return this._isXHRUpload(e)&&p&&(l||a>d)&&!e.data?n?!0:l>=a?(s.error=e.i18n("uploadedBytes"),this._getXHRPromise(!1,e.context,[null,"error",s.error])):(r=function(){var n=t.extend({},e),c=n._progress.loaded;n.blob=p.call(s,l,l+d,s.type),n.chunkSize=n.blob.size,n.contentRange="bytes "+l+"-"+(l+n.chunkSize-1)+"/"+a,o._initXHRData(n),o._initProgressListener(n),i=(o._trigger("chunksend",null,n)!==!1&&t.ajax(n)||o._getXHRPromise(!1,n.context)).done(function(i,s,d){l=o._getUploadedBytes(d)||l+n.chunkSize,c+n.chunkSize-n._progress.loaded&&o._onProgress(t.Event("progress",{lengthComputable:!0,loaded:l-n.uploadedBytes,total:l-n.uploadedBytes}),n),e.uploadedBytes=n.uploadedBytes=l,n.result=i,n.textStatus=s,n.jqXHR=d,o._trigger("chunkdone",null,n),o._trigger("chunkalways",null,n),a>l?r():u.resolveWith(n.context,[i,s,d])}).fail(function(t,e,i){n.jqXHR=t,n.textStatus=e,n.errorThrown=i,o._trigger("chunkfail",null,n),o._trigger("chunkalways",null,n),u.rejectWith(n.context,[t,e,i])})},this._enhancePromise(c),c.abort=function(){return i.abort()},r(),c):!1},_beforeSend:function(t,e){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(e),this._initProgressObject(e),e._progress.loaded=e.loaded=e.uploadedBytes||0,e._progress.total=e.total=this._getTotal(e.files)||1,e._progress.bitrate=e.bitrate=0,this._active+=1,this._progress.loaded+=e.loaded,this._progress.total+=e.total},_onDone:function(e,n,i,r){var o=r._progress.total,s=r._response;r._progress.loaded<o&&this._onProgress(t.Event("progress",{lengthComputable:!0,loaded:o,total:o}),r),s.result=r.result=e,s.textStatus=r.textStatus=n,s.jqXHR=r.jqXHR=i,this._trigger("done",null,r)},_onFail:function(t,e,n,i){var r=i._response;i.recalculateProgress&&(this._progress.loaded-=i._progress.loaded,this._progress.total-=i._progress.total),r.jqXHR=i.jqXHR=t,r.textStatus=i.textStatus=e,r.errorThrown=i.errorThrown=n,this._trigger("fail",null,i)},_onAlways:function(t,e,n,i){this._trigger("always",null,i)},_onSend:function(e,n){n.submit||this._addConvenienceMethods(e,n);var i,r,o,s,a=this,l=a._getAJAXSettings(n),d=function(){return a._sending+=1,l._bitrateTimer=new a._BitrateTimer,i=i||((r||a._trigger("send",t.Event("send",{delegatedEvent:e}),l)===!1)&&a._getXHRPromise(!1,l.context,r)||a._chunkedUpload(l)||t.ajax(l)).done(function(t,e,n){a._onDone(t,e,n,l)}).fail(function(t,e,n){a._onFail(t,e,n,l)}).always(function(t,e,n){if(a._onAlways(t,e,n,l),a._sending-=1,a._active-=1,l.limitConcurrentUploads&&l.limitConcurrentUploads>a._sending)for(var i=a._slots.shift();i;){if("pending"===a._getDeferredState(i)){i.resolve();break}i=a._slots.shift()}0===a._active&&a._trigger("stop")})};return this._beforeSend(e,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(o=t.Deferred(),this._slots.push(o),s=o.pipe(d)):(this._sequence=this._sequence.pipe(d,d),s=this._sequence),s.abort=function(){return r=[void 0,"abort","abort"],i?i.abort():(o&&o.rejectWith(l.context,r),d())},this._enhancePromise(s)):d()},_onAdd:function(e,n){var i,r,o,s,a=this,l=!0,d=t.extend({},this.options,n),p=d.limitMultiFileUploads,u=this._getParamName(d);if((d.singleFileUploads||p)&&this._isXHRUpload(d))if(!d.singleFileUploads&&p)for(o=[],i=[],s=0;s<n.files.length;s+=p)o.push(n.files.slice(s,s+p)),r=u.slice(s,s+p),r.length||(r=u),i.push(r);else i=u;else o=[n.files],i=[u];return n.originalFiles=n.files,t.each(o||n.files,function(r,s){var d=t.extend({},n);return d.files=o?s:[s],d.paramName=i[r],a._initResponseObject(d),a._initProgressObject(d),a._addConvenienceMethods(e,d),l=a._trigger("add",t.Event("add",{delegatedEvent:e}),d)}),l},_replaceFileInput:function(e){var n=e.clone(!0);t("<form></form>").append(n)[0].reset(),e.after(n).detach(),t.cleanData(e.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(t,i){return i===e[0]?n[0]:i}),e[0]===this.element[0]&&(this.element=n)},_handleFileTreeEntry:function(e,n){var i,r=this,o=t.Deferred(),s=function(t){t&&!t.entry&&(t.entry=e),o.resolve([t])};return n=n||"",e.isFile?e._file?(e._file.relativePath=n,o.resolve(e._file)):e.file(function(t){t.relativePath=n,o.resolve(t)},s):e.isDirectory?(i=e.createReader(),i.readEntries(function(t){r._handleFileTreeEntries(t,n+e.name+"/").done(function(t){o.resolve(t)}).fail(s)},s)):o.resolve([]),o.promise()},_handleFileTreeEntries:function(e,n){var i=this;return t.when.apply(t,t.map(e,function(t){return i._handleFileTreeEntry(t,n)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(e){e=e||{};var n=e.items;return n&&n.length&&(n[0].webkitGetAsEntry||n[0].getAsEntry)?this._handleFileTreeEntries(t.map(n,function(t){var e;return t.webkitGetAsEntry?(e=t.webkitGetAsEntry(),e&&(e._file=t.getAsFile()),e):t.getAsEntry()})):t.Deferred().resolve(t.makeArray(e.files)).promise()},_getSingleFileInputFiles:function(e){e=t(e);var n,i,r=e.prop("webkitEntries")||e.prop("entries");if(r&&r.length)return this._handleFileTreeEntries(r);if(n=t.makeArray(e.prop("files")),n.length)void 0===n[0].name&&n[0].fileName&&t.each(n,function(t,e){e.name=e.fileName,e.size=e.fileSize});else{if(i=e.prop("value"),!i)return t.Deferred().resolve([]).promise();n=[{name:i.replace(/^.*\\/,"")}]}return t.Deferred().resolve(n).promise()},_getFileInputFiles:function(e){return e instanceof t&&1!==e.length?t.when.apply(t,t.map(e,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(e)},_onChange:function(e){var n=this,i={fileInput:t(e.target),form:t(e.target.form)};this._getFileInputFiles(i.fileInput).always(function(r){i.files=r,n.options.replaceFileInput&&n._replaceFileInput(i.fileInput),n._trigger("change",t.Event("change",{delegatedEvent:e}),i)!==!1&&n._onAdd(e,i)})},_onPaste:function(e){var n=e.originalEvent&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.items,i={files:[]};n&&n.length&&(t.each(n,function(t,e){var n=e.getAsFile&&e.getAsFile();n&&i.files.push(n)}),this._trigger("paste",t.Event("paste",{delegatedEvent:e}),i)!==!1&&this._onAdd(e,i))},_onDrop:function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var n=this,i=e.dataTransfer,r={};i&&i.files&&i.files.length&&(e.preventDefault(),this._getDroppedFiles(i).always(function(i){r.files=i,n._trigger("drop",t.Event("drop",{delegatedEvent:e}),r)!==!1&&n._onAdd(e,r)}))},_onDragOver:function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var n=e.dataTransfer;n&&-1!==t.inArray("Files",n.types)&&this._trigger("dragover",t.Event("dragover",{delegatedEvent:e}))!==!1&&(e.preventDefault(),n.dropEffect="copy")},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste})),t.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(e,n){var i=-1!==t.inArray(e,this._specialOptions);i&&this._destroyEventHandlers(),this._super(e,n),i&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var e=this.options;void 0===e.fileInput?e.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):e.fileInput instanceof t||(e.fileInput=t(e.fileInput)),e.dropZone instanceof t||(e.dropZone=t(e.dropZone)),e.pasteZone instanceof t||(e.pasteZone=t(e.pasteZone))},_getRegExp:function(t){var e=t.split("/"),n=e.pop();return e.shift(),new RegExp(e.join("/"),n)},_isRegExpOption:function(e,n){return"url"!==e&&"string"===t.type(n)&&/^\/.*\/[igm]{0,3}$/.test(n)},_initDataAttributes:function(){var e=this,n=this.options;t.each(t(this.element[0].cloneNode(!1)).data(),function(t,i){e._isRegExpOption(t,i)&&(i=e._getRegExp(i)),n[t]=i})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(e){var n=this;e&&!this.options.disabled&&(e.fileInput&&!e.files?this._getFileInputFiles(e.fileInput).always(function(t){e.files=t,n._onAdd(null,e)}):(e.files=t.makeArray(e.files),this._onAdd(null,e)))},send:function(e){if(e&&!this.options.disabled){if(e.fileInput&&!e.files){var n,i,r=this,o=t.Deferred(),s=o.promise();return s.abort=function(){return i=!0,n?n.abort():(o.reject(null,"abort","abort"),s)},this._getFileInputFiles(e.fileInput).always(function(t){if(!i){if(!t.length)return void o.reject();e.files=t,n=r._onSend(null,e).then(function(t,e,n){o.resolve(t,e,n)},function(t,e,n){o.reject(t,e,n)})}}),this._enhancePromise(s)}if(e.files=t.makeArray(e.files),e.files.length)return this._onSend(null,e)}return this._getXHRPromise(!1,e&&e.context)}})}),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","./jquery.fileupload"],t):t(window.jQuery)}(function(t){"use strict";var e=t.blueimp.fileupload.prototype.options.add;t.widget("blueimp.fileupload",t.blueimp.fileupload,{options:{processQueue:[],add:function(n,i){var r=t(this);i.process(function(){return r.fileupload("process",i)}),e.call(this,n,i)}},processActions:{},_processFile:function(e,n){var i=this,r=t.Deferred().resolveWith(i,[e]),o=r.promise();return this._trigger("process",null,e),t.each(e.processQueue,function(e,r){var s=function(e){return n.errorThrown?t.Deferred().rejectWith(i,[n]).promise():i.processActions[r.action].call(i,e,r)};o=o.pipe(s,r.always&&s)}),o.done(function(){i._trigger("processdone",null,e),i._trigger("processalways",null,e)}).fail(function(){i._trigger("processfail",null,e),i._trigger("processalways",null,e)}),o},_transformProcessQueue:function(e){var n=[];t.each(e.processQueue,function(){var i={},r=this.action,o=this.prefix===!0?r:this.prefix;t.each(this,function(n,r){"string"===t.type(r)&&"@"===r.charAt(0)?i[n]=e[r.slice(1)||(o?o+n.charAt(0).toUpperCase()+n.slice(1):n)]:i[n]=r}),n.push(i)}),e.processQueue=n},processing:function(){return this._processing},process:function(e){var n=this,i=t.extend({},this.options,e);return i.processQueue&&i.processQueue.length&&(this._transformProcessQueue(i),0===this._processing&&this._trigger("processstart"),t.each(e.files,function(r){var o=r?t.extend({},i):i,s=function(){return e.errorThrown?t.Deferred().rejectWith(n,[e]).promise():n._processFile(o,e)};o.index=r,n._processing+=1,n._processingQueue=n._processingQueue.pipe(s,s).always(function(){n._processing-=1,0===n._processing&&n._trigger("processstop")})})),this._processingQueue},_create:function(){this._super(),this._processing=0,this._processingQueue=t.Deferred().resolveWith(this).promise()}})}),function(){}.call(this),function(){var AutoComplete,bind=function(t,e){return function(){return t.apply(e,arguments)}};jQuery(function(){return $(document).on("focus","input[data-type='autocomplete']",function(t){var e;return $(this).hasClass("ui-autocomplete-input")||new AutoComplete($(this)),e=$(this),function(t){var e;return e=function(){return t.val().length&&t.is(":focus")?t.autocomplete("search"):void 0},setTimeout(e,150)}(e)})}),AutoComplete=function(){function AutoComplete(t){this.setExtendedValue=bind(this.setExtendedValue,this),this.onChange=bind(this.onChange,this),this.focus=bind(this.focus,this),this.select=bind(this.select,this),this.remote_source=bind(this.remote_source,this),this.setup=bind(this.setup,this),this.delegateEvents=bind(this.delegateEvents,this),this.setup(t),this.delegateEvents()}return AutoComplete.prototype.delegateEvents=function(){return this.el.bind("blur",function(t){return function(e){return null!=t.current_ajax?t.current_ajax.abort():void 0}}(this)),this.el.bind("change",this.onChange)},AutoComplete.prototype.setup=function(t,e){return this.el=$(t),this.el.data("_autocomplete",this["this"]),this.data=this.el.data(),this.el.autocomplete({source:null!=e?e:null!=this.data.autocomplete_data?this.data.autocomplete_data:this.data.url?this.remote_source:void 0,select:this.select,focus:this.focus,appendTo:this.el.closest(".modal").length?this.el.closest(".modal"):this.el.closest("form")}),this.el.autocomplete("widget").addClass(this.data.autocomplete_class),this.data.autocomplete_search_on_focus===!0&&this.el.bind("focus",function(t){return function(e){return t.el.autocomplete("option","minLength",0),t.el.autocomplete("search",""),t.el.autocomplete("widget").position({of:t.el,my:"right top",at:"right bottom"}),window.setTimeout(function(){return t.el.is(":focus")?t.el.select():void 0},100)}}(this)),null!=this.data.autocomplete_element_tmpl?this.el.data("uiAutocomplete")._renderItem=function(t){return function(e,n){return $(App.Render(t.data.autocomplete_element_tmpl,n)).data("value",n).appendTo(e)}}(this):void 0},AutoComplete.prototype.remote_source=function(t,e){var n,i;return n={format:"json"},n[null!=(i=this.data.autocomplete_search_attr)?i:"term"]=t.term,null!=this.data.autocomplete_with&&(n=$.extend(!0,n,{"with":this.data.autocomplete_with})),this.el.autocomplete("widget").scrollTop(0),null!=this.current_ajax&&this.current_ajax.abort(),this.current_ajax=$.ajax({url:this.data.url,data:n,dataType:"json",
success:function(t){return function(n){var i,r;return(null!=(r=n.entries)?r.length:void 0)&&(n=n.entries),i=$.map(n,function(e){var n;return e.label=null!=t.data.autocomplete_display_attribute?(n=e[t.data.autocomplete_display_attribute],null!=t.data.autocomplete_display_attribute_ext?n=[n,e[t.data.autocomplete_display_attribute_ext]].join(" "):void 0,n):e.label,null!=t.data.autocomplete_value_attribute&&(e.value=e[t.data.autocomplete_value_attribute]),e}),(null!=t.data.autocomplete_search_only_on_focus||null!=t.data.autocomplete_search_only_once)&&(t.setup(t.el,i),t.el.bind("blur",function(){return t.setup(t.el,t.source)})),e(i)}}(this)})},AutoComplete.prototype.select=function(event,element){var callback,el,labelValue,value;return this.data.autocomplete_clear_input_value_on_select===!0?this.el.val(""):(labelValue=element.item[this.data.autocomplete_display_attribute],null!=element.item[this.data.autocomplete_display_attribute_ext]&&(labelValue+=" "+element.item[this.data.autocomplete_display_attribute_ext]),this.el.val(labelValue)),value=null!=this.data.autocomplete_value_attribute?element.item[this.data.autocomplete_value_attribute]:element.item.value,this.data.autocomplete_blur_on_select===!0&&this.el.blur(),null!=this.data.autocomplete_value_target&&this.el.prevAll("input[name='"+this.data.autocomplete_value_target+"']").val(value).change(),null!=this.data.autocomplete_select_callback&&(el=$(event.currentTarget),callback=eval(this.data.autocomplete_select_callback),null!=callback&&callback(element,event)),this.setExtendedValue(),!1},AutoComplete.prototype.focus=function(t,e){return!1},AutoComplete.prototype.onChange=function(t){var e;return e=$(t.currentTarget),this.setExtendedValue(),$("input[name='"+this.data.autocomplete_value_target+"']").val(null)},AutoComplete.prototype.setExtendedValue=function(){return this.el.data("autocomplete_extensible")?this.el.prevAll("input[name='"+this.data.autocomplete_extended_key_target+"'][data-type='extended-value']").val(this.el.val()):void 0},AutoComplete}(),window.AutoComplete=AutoComplete}.call(this),function(){jQuery(function(){return $(document).on("focus","input[data-type='datepicker']",function(t){var e,n;return e=$(this),e.hasClass("hasDatepicker")?void 0:(e.datepicker(),n=e.prev("input[type=hidden]"),n.val().length&&e.val(moment(n.val()).format(i18n.date.L)),e.on("change",function(){var t;return t=e.val(),_.isEmpty(t)||(t=moment(t,i18n.date.L).format("YYYY-MM-DD")),n.val(t)}))})})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ManageBookingCalendar=function(n){function i(){return this.isClosedDay=t(this.isClosedDay,this),this.getInventoryPool=t(this.getInventoryPool,this),this.selectedPartitions=t(this.selectedPartitions,this),this.setupPartitionSelector=t(this.setupPartitionSelector,this),this.getHolidays=t(this.getHolidays,this),this.setQuantityText=t(this.setQuantityText,this),this.setDayElement=t(this.setDayElement,this),this.getGroupIds=t(this.getGroupIds,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.setup=function(t){return this.partitionSelector_el=this.el.find("select#booking-calendar-partitions"),t.startDateDisabled&&(this.startDate_el.prop("disabled",!0),this.startDate_el.val(moment().format("YYYY-MM-DD"))),this.reservations=t.reservations,this.models=t.models,this.setupPartitionSelector()},i.prototype.getGroupIds=function(){return this.partitionSelector_el.find("option:selected").data("value")},i.prototype.setDayElement=function(t,e,n){var i,r,o,s,a,l,d,p,u,c;for(r=!0,p=this.models,a=0,l=p.length;l>a;a++)d=p[a],i=d.availability().withoutLines(this.reservations,!0),u=this.quantity_el.val().length?parseInt(this.quantity_el.val()):_.reduce(this.reservations,function(t,e){return e.model_id===d.id?t+e.quantity:t},0),c=i.maxAvailableInTotal(t,t),s=i.maxAvailableForGroups(t,t,this.getGroupIds()),r=s>=u&&r,o=c>=u&&o;return this.models.length>1?this.setQuantityText(e,r?1:0,o?1:0):this.setQuantityText(e,s,c),this.setAvailability(e,r),this.setSelected(e,t)},i.prototype.setQuantityText=function(t,e,n){return this.models.length>1&&(e=0>=e?"x":"\u2713",n=0>=n?"x":"\u2713"),t.find(".fc-day-content > div").text(e),null!=n?t.find(".fc-day-content .total_quantity").length?t.find(".fc-day-content .total_quantity").text("/"+n):t.find(".fc-day-content").append("<span class='total_quantity'>/"+n+"</span>"):void 0},i.prototype.getHolidays=function(){return App.InventoryPool.current.holidays().all()},i.prototype.setupPartitionSelector=function(){return this.quantity_el.val().length?null==this.partitionSelector_el||0===this.partitionSelector_el.find("option").length?!1:(this.partitionSelector_el.find("option:first").select(),this.partitionSelector_el.bind("change",function(t){return function(e){return t.render()}}(this))):this.partitionSelector_el.prop("disabled",!0)},i.prototype.selectedPartitions=function(){return null!=this.partitionSelector_el&&this.partitionSelector_el.find("option").length&&this.partitionSelector_el.find("option:selected").val().length?JSON.parse(this.partitionSelector_el.find("option:selected").val()):null},i.prototype.getInventoryPool=function(){return App.InventoryPool.current},i.prototype.isClosedDay=function(t){var e;return e=this.getInventoryPool(),i.__super__.isClosedDay.apply(this,arguments)||!e.isVisitPossible(moment(t))},i}(App.BookingCalendar)}.call(this),function(){window.App.Modules.LineProblems={anyProblems:function(){return!!this.getProblems().length},getProblems:function(){var t,e,n,i,r,o;return i=[],null!=this.model_id&&(o=null!=this.subreservations?this.subreservations:[this],e=this.model().availability().withoutLines(o).maxAvailableForGroups(this.start_date,this.end_date,this.user().groupIds),r=null!=this.subreservations?_.reduce(this.subreservations,function(t,e){return t+e.quantity},0):this.quantity),moment(this.start_date).endOf("day").diff(moment().endOf("day"),"days")<0&&_.include(["approved","submitted"],this.status)||moment(this.end_date).endOf("day").diff(moment().endOf("day"),"days")<0&&"signed"===this.status?(t=_.include(["approved","submitted"],this.status)?Math.abs(moment(this.start_date).diff(moment().endOf("day"),"days")):Math.abs(moment(this.end_date).diff(moment().endOf("day"),"days")),i.push({type:"overdue",message:_jed("Overdue")+" "+_jed("since")+" "+t+" "+_jed(t,"day")})):null!=e&&r>e&&(n=this.model().availability().withoutLines(o,!0).maxAvailableInTotal(this.start_date,this.end_date),i.push({type:"availability",message:_jed("Not available")+" "+e+"("+n+")/"+this.model().availability().total_rentable})),this.item()&&(this.item().is_borrowable||i.push({type:"unborrowable",message:_jed("Item not borrowable")}),this.item().is_broken&&i.push({type:"broken",message:_jed("Item is defective")}),this.item().is_incomplete&&i.push({type:"incomplete",message:_jed("Item is incomplete")})),i}}}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;window.App.AccessRight=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.configure("AccessRight","id","role","user_id","inventory_pool_id","suspended_until"),n.belongsTo("users","App.User","user_id"),n.extend(Spine.Model.Ajax),n.url=function(){return null!=App.InventoryPool.current?"/manage/"+App.InventoryPool.current.id+"/access_rights":"/admin/access_rights"},n.rolesHierarchy=["customer","group_manager","lending_manager","inventory_manager"],n.prototype.name=function(){switch(this.role){case"admin":return _jed("Administrator");case"customer":return _jed("Customer");case"group_manager":return _jed("Group manager");case"lending_manager":return _jed("Lending manager");case"inventory_manager":return _jed("Inventory manager")}},n.atLeastRole=function(t,e){return"admin"!==t?_.indexOf(this.rolesHierarchy,t)>=_.indexOf(this.rolesHierarchy,e):void 0},n}(Spine.Model)}.call(this),function(){window.App.Availability.url=function(t){return function(){return"/manage/"+App.InventoryPool.current.id+"/availabilities"}}(this)}.call(this),function(){window.App.Building.url=function(t){return function(){return"/manage/"+App.InventoryPool.current.id+"/buildings"}}(this)}.call(this),function(){window.App.Category.url=function(t){return function(){return"/manage/"+App.InventoryPool.current.id+"/categories"}}(this)}.call(this),function(){window.App.Contract.url=function(t){return function(){return App.InventoryPool.url+"/"+App.InventoryPool.current.id+"/contracts"}}(this),window.App.Contract.prototype.approve=function(t){return $.post("/manage/"+App.InventoryPool.current.id+"/contracts/"+this.id+"/approve",{comment:t})},window.App.Contract.prototype.approve_anyway=function(t){return $.post("/manage/"+App.InventoryPool.current.id+"/contracts/"+this.id+"/approve",{force:!0,comment:t})},window.App.Contract.prototype.reject=function(t){return $.post("/manage/"+App.InventoryPool.current.id+"/contracts/"+this.id+"/reject",{comment:t})},window.App.Contract.prototype.swapUser=function(t,e){return $.post("/manage/"+App.InventoryPool.current.id+"/contracts/"+this.id+"/swap_user",{user_id:t,delegated_user_id:e})},window.App.Contract.prototype.sign=function(t){return $.post(App.InventoryPool.url+"/"+App.InventoryPool.current.id+"/contracts/"+this.id+"/sign",t)},window.App.Contract.prototype.editPath=function(){return App.Contract.url()+"/"+this.id+"/edit"},window.App.Contract.prototype.handOverPath=function(){return App.Contract.url()+"/"+this.id+"/hand_over"}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.Field=function(n){function i(){this.getItemValueLabel=t(this.getItemValueLabel,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.configure("Field","id","attribute","default","display_attr","display_attr_ext","forPackage","extended_key","extensible","form_name","group","label","permissions","required","search_attr","search_path","type","value_attr","item_value_label","item_value_label_ext","values","visibility_dependency_field_id","visibility_dependency_value","exclude_from_submit","values_dependency_field_id","values_url","values_label_method"),i.extend(Spine.Model.Ajax),i.url=function(){return"/manage/"+App.InventoryPool.current.id+"/fields"},i.prototype.getLabel=function(){return _jed(this.label)},i.prototype.isEditable=function(t){var e;return e=!0,null!=this.permissions&&null!=t&&(null==this.permissions.role||App.AccessRight.atLeastRole(App.User.current.role,this.permissions.role)||(e=!1),null!=this.permissions.owner&&this.permissions.owner&&null!=t.owner&&App.InventoryPool.current.id!==t.owner.id&&(e=!1)),e},i.prototype.getValue=function(t,e,n){var i;return null!=t&&(i=e instanceof Array?_.reduce(e,function(t,e){return null!=t&&null!=t[e]?t[e]:null},t):t[e]),"retired"===e&&(i=!!i),null!=i?(null!=this.currency&&(i=accounting.formatMoney(i,{format:"%v"})),i):null!=this["default"]&&n?this["default"]:null},i.prototype.getItemValueLabel=function(t,e){var n,i,r;return null!=e?(i=function(t){return t instanceof Array?_.reduce(t,function(t,e){return null!=t&&null!=t[e]?t[e]:null},e):e[t]},r=i(t),(n=i(this.item_value_label_ext))&&(r=[r,n].join(" ")),r):void 0},i.prototype.getFormName=function(t,e,n){return null==t&&(t=this.attribute),null==e&&(e=this.form_name),null==n&&(n=null),null!=e?"item["+e+"]":t instanceof Array?(e=_.reduce(t,function(t,e){return t+"["+e+"]"},"item"),null!=n&&(e+="[]"),e):"item["+t+"]"},i.prototype.getExtendedKeyFormName=function(){return this.getFormName(this.extended_key,this.form_name)},i.prototype.children=function(){return _.filter(App.Field.all(),function(t){return function(e){return e.visibility_dependency_field_id===t.id}}(this))},i.prototype.childrenWithValueDependency=function(){return _.filter(App.Field.all(),function(t){return function(e){return e.values_dependency_field_id===t.id}}(this))},i.prototype.descendants=function(){var t;return t=this.children(),_.isEmpty(t)?t:_.union(t,_.flatten(_.map(t,function(t){return t.descendants()})))},i.prototype.parent=function(){return null!=this.visibility_dependency_field_id?App.Field.find(this.visibility_dependency_field_id):void 0},i.prototype.parentWithValueDependency=function(){return null!=this.values_dependency_field_id?App.Field.find(this.values_dependency_field_id):void 0},i.prototype.getValueLabel=function(t,e){return void 0===e&&(e=null),e=_.find(t,function(t){return String(t.value)===e||t.value===e}),e?e.label:""},i.getValue=function(t){var e;if(e=App.Field.find(t.data("id")),t.find("[data-value]").length)return t.find("[data-value]").attr("data-value");switch(e.type){case"radio":return t.find("input:checked").val();case"date":return t.find("input[type=hidden]").val();case"autocomplete":return t.find("input[type=hidden]").val();case"autocomplete-search":return t.find("input[type=hidden]").val();case"text":return t.find("input[type=text]").val();case"textarea":return t.find("textarea").val();case"select":return t.find("option:selected").val()}},i.validate=function(t){var e,n,i,r,o,s;for(o=!0,t.find(".error").removeClass("error"),i=t.find("[data-required='true'][data-editable='true']:visible"),e=0,n=i.length;n>e;e++)r=i[e],s=App.Field.getValue($(r)),(null==s||0===s.length)&&(o=!1,$(r).addClass("error"));return o},i.toggleChildren=function(t,e,n,r){var o,s,a,l,d,p,u,c,h;if(p=App.Field.find(t.data("id")),e=$(e),null!=p.children&&(a=p.children()),null!=a&&a.length){for(h=[],u=0,c=a.length;c>u;u++)o=a[u],l=o.visibility_dependency_value,App.Field.getValue(t)===l||_.contains(l,App.Field.getValue(t))||_.isUndefined(l)&&App.Field.isPresent(App.Field.find(o.visibility_dependency_field_id),e)?App.Field.isPresent(o,e)?h.push(void 0):r&&o.forPackage||!r?(t.after(App.Render("manage/views/items/field",{},$.extend(n,{field:o}))),s=$("[data-type='field'][data-id='"+o.id+"']"),"composite"===o.type&&new App.CompositeFieldController({el:s,data:n}),null!=o.children&&(a=o.children()),null!=a&&a.length?h.push(i.toggleChildren(s,e,n,r)):h.push(void 0)):h.push(void 0):h.push(function(){var t,n,i,r;for(i=[o].concat(o.descendants()),r=[],t=0,n=i.length;n>t;t++)d=i[t],r.push(e.find("[data-type='field'][data-id='"+d.id+"']").remove());return r}());return h}},i.isPresent=function(t,e){return!!$(e).find("[data-id='"+t.id+"']").length},i.grouped=function(t){return _.groupBy(t,function(t){return null===t.group?"":t.group})},i}(Spine.Model)}.call(this),function(){window.App.Group.url=function(t){return function(){return"/manage/"+App.InventoryPool.current.id+"/groups"}}(this)}.call(this),function(){window.App.Holiday.url=function(t){return function(){return"/manage/"+App.InventoryPool.current.id+"/holidays"}}(this)}.call(this),function(){window.App.Inventory.url=function(t){return function(){return"/manage/"+App.InventoryPool.current.id+"/inventory"}}(this),window.App.Inventory.findByInventoryCode=function(t){return function(t){return $.get("/manage/"+App.InventoryPool.current.id+"/inventory/"+t)}}(this),window.App.Inventory.fetch=function(t){return function(t){return $.get(App.Inventory.url()+".json",t)}}(this)}.call(this),function(){window.App.InventoryPool.url="/manage",window.App.InventoryPool.prototype.isOwnerOrResponsibleFor=function(t){return this.id===t.owner_id||this.id===t.inventory_pool_id}}.call(this),function(){_.invoke([window.App.Item,window.App.License],function(){return this.url=function(){return"/manage/"+App.InventoryPool.current.id+"/items"}}),_.invoke([window.App.Item,window.App.License],function(){return this.prototype.updateWithFieldData=function(t){return $.ajax({url:this.url(),data:t,type:"PUT"})}}),_.invoke([window.App.Item,window.App.License],function(){return this.prototype.inspect=function(t){var e,n;for(e in t)n=t[e],this[e]=n;return App.Item.addRecord(this),App.Item.trigger("refresh"),$.post(window.App.Item.url()+"/"+this.id+"/inspect",t)}})}.call(this),function(){_.invoke([window.App.Model,window.App.Software],function(){return this.url=function(){return"/manage/"+App.InventoryPool.current.id+"/models"}})}.call(this),function(){window.App.ModelLink.url=function(t){return function(){return"/manage/"+App.InventoryPool.current.id+"/model_links"}}(this)}.call(this),function(){window.App.Option.url=function(t){return function(){return"/manage/"+App.InventoryPool.current.id+"/options"}}(this)}.call(this),function(){window.App.Partition.url=function(t){return function(){return"/manage/"+App.InventoryPool.current.id+"/partitions"}}(this)}.call(this),function(){window.App.Purpose.url=function(t){return function(){return"/manage/"+App.InventoryPool.current.id+"/purposes"}}(this)}.call(this),function(){window.App.Reservation.url=function(t){return function(){return"/manage/"+App.InventoryPool.current.id+"/reservations"}}(this),window.App.Reservation.createOne=function(t){return $.post("/manage/"+App.InventoryPool.current.id+"/reservations",t).done(function(t){return App.Reservation.addRecord(new App.Reservation(t)),App.Contract.trigger("refresh")})},window.App.Reservation.createForTemplate=function(t){return $.post("/manage/"+App.InventoryPool.current.id+"/reservations/for_template",t).done(function(e){var n,i;return n=function(){var t,n,r;for(r=[],t=0,n=e.length;n>t;t++)i=e[t],r.push(App.Reservation.addRecord(new App.Reservation(i)));return r}(),App.Model.ajaxFetch({data:$.param({template_id:t.template_id,paginate:!1})}).done(function(t){return function(){return App.Contract.trigger("refresh")}}(this))})},window.App.Reservation.destroyMultiple=function(t){var e,n,i;for(e=0,i=t.length;i>e;e++)n=t[e],App.Reservation.find(n).remove();return $.ajax({url:"/manage/"+App.InventoryPool.current.id+"/reservations/",type:"post",data:{line_ids:t,_method:"delete"}}),App.Reservation.trigger("destroy",t)},window.App.Reservation.changeTimeRange=function(t){return function(t,e,n){return e&&(e=moment(e).format("YYYY-MM-DD")),n=moment(n).format("YYYY-MM-DD"),$.post("/manage/"+App.InventoryPool.current.id+"/reservations/change_time_range",{line_ids:_.map(t,function(t){return t.id}),start_date:e,end_date:n}).done(function(){var i,r,o,s;for(r=0,o=t.length;o>r;r++)s=t[r],i={end_date:n},e&&(i.start_date=e),s.refresh(i);return App.Contract.trigger("refresh")})}}(this),window.App.Reservation.assignOrCreate=function(t){return $.post("/manage/"+App.InventoryPool.current.id+"/reservations/assign_or_create",t)},window.App.Reservation.takeBack=function(t,e){var n;return $.post("/manage/"+App.InventoryPool.current.id+"/reservations/take_back",{ids:function(){var e,i,r;for(r=[],e=0,i=t.length;i>e;e++)n=t[e],r.push(n.id);return r}(),returned_quantity:e})},window.App.Reservation.swapUser=function(t,e){var n;return $.post("/manage/"+App.InventoryPool.current.id+"/reservations/swap_user",{line_ids:function(){var e,i,r;for(r=[],e=0,i=t.length;i>e;e++)n=t[e],r.push(n.id);return r}(),user_id:e})},Spine.Model.include.call(App.Reservation,App.Modules.LineProblems),window.App.Reservation.prototype.assign=function(t,e){return null==e&&(e=null),$.post("/manage/"+App.InventoryPool.current.id+"/reservations/"+this.id+"/assign",{inventory_code:t.inventory_code}).fail(function(t){return function(t){return App.Flash({type:"error",message:t.responseText})}}(this)).done(function(n){return function(i){var r;return n.refresh(i),App.Reservation.trigger("update",n),App.Flash({type:"success",message:_jed("%s assigned to %s",[t.inventory_code,(null!=(r=t.model())?r:t.software()).name()])}),"function"==typeof e?e():void 0}}(this))},window.App.Reservation.prototype.removeAssignment=function(){return $.post("/manage/"+App.InventoryPool.current.id+"/reservations/"+this.id+"/remove_assignment"),this.refresh({item_id:null}),App.Reservation.trigger("update",this)}}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;window.App.Role=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.configure("Role","id","name"),n.extend(Spine.Model.Ajax),n.url=function(){return"/manage/roles"},n}(Spine.Model)}.call(this),function(){window.App.Template.url=function(t){return function(){return"/manage/"+App.InventoryPool.current.id+"/templates"}}(this)}.call(this),function(){window.App.User.url=function(t){return function(){return null!=App.InventoryPool.current?"/manage/"+App.InventoryPool.current.id+"/users":"/admin/users"}}(this),window.App.User.prototype.isSuspended=function(){return _.include(App.InventoryPool.current.suspended_user_ids,this.id)}}.call(this),function(){window.App.Workday.url=function(t){return function(){return"/manage/"+App.InventoryPool.current.id+"/workdays"}}(this)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.CategoriesFilterController=function(n){function i(){this.search=t(this.search,this),this.goBack=t(this.goBack,this),this.goRoot=t(this.goRoot,this),this.select=t(this.select,this),this.getCurrent=t(this.getCurrent,this),this.getRoot=t(this.getRoot,this),this.clickCategory=t(this.clickCategory,this),this.renderSearch=t(this.renderSearch,this),this.renderLast=t(this.renderLast,this),this.renderRoot=t(this.renderRoot,this),this.renderList=t(this.renderList,this),this.render=t(this.render,this),this.fetchCategoryLinks=t(this.fetchCategoryLinks,this),this.fetchCategories=t(this.fetchCategories,this),i.__super__.constructor.apply(this,arguments),this.categoryPath=[],this.searchTerm="",this.fetchCategories().done(function(t){return function(){return t.render()}}(this)),this.fetchCategoryLinks().done(function(t){return function(){return t.render()}}(this)),this.input.preChange()}return e(i,n),i.prototype.elements={"#category-list":"list","#category-root":"rootContainer","#category-current":"currentContainer","#category-search":"input"},i.prototype.events={"click [data-type='category-filter']":"clickCategory","click [data-type='category-root']":"goRoot","click [data-type='category-current']":"goBack","preChange #category-search":"search"},i.prototype.fetchCategories=function(){return App.Category.ajaxFetch().done(function(t){return function(e){var n;return t.categories=function(){var t,i,r;for(r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push(App.Category.find(n.id));return r}()}}(this))},i.prototype.fetchCategoryLinks=function(){return App.CategoryLink.ajaxFetch().done(function(t){return function(e){var n;return t.categoryLinks=function(){var t,i,r;for(r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push(App.CategoryLink.find(n.id));return r}()}}(this))},i.prototype.render=function(t){var e;return e=null!=t?t.children():null!=this.categories&&null!=this.categoryLinks?null!=this.roots?this.roots:this.roots=App.Category.roots():void 0,null!=e&&this.renderList(e),this.renderRoot(),this.renderLast()},i.prototype.renderList=function(t){return this.list.html(App.Render("manage/views/categories/filter_list_entry",t))},i.prototype.renderRoot=function(){return this.searchTerm.length?!1:null!=this.getRoot()?this.rootContainer.html(App.Render("manage/views/categories/filter_list_root",this.getRoot())):this.rootContainer.html("")},i.prototype.renderLast=function(){return null!=this.getCurrent()?this.currentContainer.html(App.Render("manage/views/categories/filter_list_current",this.getCurrent())):this.currentContainer.html("")},i.prototype.renderSearch=function(t,e){return this.rootContainer.html(App.Render("manage/views/categories/filter_list_search",{search_term:this.input.val()})),this.currentContainer.html(""),e.length?this.list.html(App.Render("manage/views/categories/filter_list_entry",e)):this.list.html("")},i.prototype.clickCategory=function(t){var e,n;return n=$(t.currentTarget),e=App.Category.find(n.data("id")),this.select(e)},i.prototype.getRoot=function(){return this.categoryPath.length>1?_.first(this.categoryPath):void 0},i.prototype.getCurrent=function(){return this.categoryPath.length>0?_.last(this.categoryPath):void 0},i.prototype.select=function(t){return this.categoryPath.push(t),this.render(t),null!=this.filter?this.filter():void 0},i.prototype.goRoot=function(t){return this.categoryPath=this.categoryPath.splice(0,1),this.render(this.categoryPath[0]),null!=this.filter?this.filter():void 0},i.prototype.goBack=function(t){var e;return this.categoryPath=this.categoryPath.length>1?this.categoryPath.splice(0,this.categoryPath.length-1):this.categoryPath=[],this.categoryPath.length>1&&(e=_.last(this.categoryPath)),this.searchTerm.length&&0===this.categoryPath.length?this.search():this.render(e),null!=this.filter?this.filter():void 0},i.prototype.search=function(){var t;return this.searchTerm!==this.input.val()?(this.searchTerm=this.input.val(),this.searchTerm.length?(t=_.filter(App.Category.all(),function(t){return function(e){return e.name.match(RegExp(t.searchTerm,"i"))}}(this)),this.renderSearch(this.searchTerm,t)):this.render()):void 0},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.CategoriesIndexController=function(n){function i(){this.renderList=t(this.renderList,this),this.fetchCategoryLinks=t(this.fetchCategoryLinks,this),this.fetchCategories=t(this.fetchCategories,this),this.showLoading=t(this.showLoading,this),this.localSearch=t(this.localSearch,this),this.resetAndRender=t(this.resetAndRender,this),i.__super__.constructor.apply(this,arguments),this.showLoading(),this.fetchCategories().done(function(t){return function(){return t.fetchCategoryLinks().done(function(){return t.renderList(App.Category.roots())})}}(this)),new App.CategoriesIndexExpandController({el:this.el.find("#list")}),this.search=new App.ListSearchController({el:this.el.find("#list-search"),reset:this.resetAndRender})}return e(i,n),i.prototype.elements={"#list":"list"},i.prototype.resetAndRender=function(){var t;return this.categories={},this.showLoading(),(t=this.search.term())?this.localSearch(t):this.renderList(App.Category.roots())},i.prototype.localSearch=function(t){var e;return e=new RegExp(t,"i"),this.categories=_.filter(App.Category.all(),function(t){return t.name.match(e)}),this.renderList(this.categories)},i.prototype.showLoading=function(){return this.list.html(App.Render("manage/views/lists/loading"))},i.prototype.fetchCategories=function(){return App.Category.ajaxFetch({data:$.param({include:{"used?":!0}})}).done(function(t){return function(e){var n;return t.categories=function(){var t,i,r;for(r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push(App.Category.find(n.id));return r}()}}(this))},i.prototype.fetchCategoryLinks=function(){return App.CategoryLink.ajaxFetch().done(function(t){return function(e){var n;return t.categoryLinks=function(){var t,i,r;for(r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push(App.CategoryLink.find(n.id));return r}()}}(this))},i.prototype.renderList=function(t){return this.list.html(App.Render("manage/views/categories/line",t))},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.CategoriesIndexExpandController=function(n){function i(){return this.close=t(this.close,this),this.open=t(this.open,this),this.toggle=t(this.toggle,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"click [data-type='expander']":"toggle"},i.prototype.toggle=function(t){var e;return e=$(t.currentTarget),null!=e.data("_expanded")&&e.data("_expanded")===!0?this.close(e):this.open(e)},i.prototype.open=function(t){var e,n,i;return t.data("_expanded",!0),t.find(".arrow").removeClass("down right").addClass("down"),i=t.closest("[data-id]"),null!=i.data("childrenContainer")?n=i.data("childrenContainer"):(e=_(App.Category.find(i.data("id")).children()).sortBy(function(t){return function(t){return t.name}}(this)),n=$("<div class='group-of-lines level-padding'></div>"),n.append(App.Render("manage/views/categories/line",e)),i.data("childrenContainer",n)),i.after(n)},i.prototype.close=function(t){var e,n;return t.data("_expanded",!1),t.find(".arrow").removeClass("down right").addClass("right"),n=t.closest("[data-id]"),e=n.next(),e.detach()},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.AddInlineEntryController=function(n){function i(){return this.select=t(this.select,this),this.fetch=t(this.fetch,this),this.source=t(this.source,this),this.setupAutocomplete=t(this.setupAutocomplete,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"focus input[data-type='autocomplete']":"setupAutocomplete"},i.prototype.elements={"input[data-type='autocomplete']":"input",".list-of-lines":"list"},i.prototype.setupAutocomplete=function(t){return this.input.autocomplete({source:this.source,focus:function(t){return function(){return!1}}(this),select:this.select,minLength:0}).data("uiAutocomplete")._renderItem=function(t){return function(t,e){return $(App.Render("views/autocomplete/element",e)).data("value",e).appendTo(t)}}(this),this.input.autocomplete("search")},i.prototype.source=function(t,e){return this.fetch(t.term).done(function(t){return function(n){return n=_.map(n,function(e){var n;return{label:null!=(n="function"==typeof t.customLabelFn?t.customLabelFn(e):void 0)?n:e.name,record:App[t.model].find(e.id)}}),t.input.is(":focus")?e(n):void 0}}(this))},i.prototype.fetch=function(t){return App[this.model].ajaxFetch({data:$.param({search_term:t})})},i.prototype.select=function(t,e){var n;return n=e.item.record,this.input.val("").blur(),this.input.autocomplete("destroy"),this.list.find(this.getExistingEntry(n)).length||this.list.prepend(App.Render(this.templatePath,n,{uid:App[this.model].uid("uid")})),t.preventDefault(),!1},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.CategoriesLinksController=function(n){function i(){this.select=t(this.select,this),this.source=t(this.source,this),this.getExistingEntry=t(this.getExistingEntry,this),i.__super__.constructor.apply(this,arguments),this.model="Category",this.templatePath="manage/views/categories/category_link_inline_entry"}return e(i,n),i.prototype.getExistingEntry=function(t){return this.list.find("input[name*='parent_id'][value='"+t.id+"']")},i.prototype.source=function(t,e){return this.fetch(t.term).done(function(t){return function(n){return t.category&&(n=_.filter(n,function(e){return e.id!==t.category.id})),n=_.map(n,function(e){return{label:e.name,record:App[t.model].find(e.id)}}),e(n)}}(this))},i.prototype.select=function(t,e){var n;return n=e.item.record,this.input.autocomplete("destroy"),this.input.val("").blur(),this.list.find(this.getExistingEntry(n)).length||this.list.prepend(App.Render(this.templatePath,n,{uid:App[this.model].uid("uid"),label:this.labelInput.val()})),!1},i}(App.AddInlineEntryController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.FormWithUploadController=function(n){function i(){return this.setupErrorModal=t(this.setupErrorModal,this),this.collectErrorMessages=t(this.collectErrorMessages,this),this.showError=t(this.showError,this),this.hideLoading=t(this.hideLoading,this),
this.showLoading=t(this.showLoading,this),this.save=t(this.save,this),this.done=t(this.done,this),this.errorHandler=t(this.errorHandler,this),this.submit=t(this.submit,this),this.preventDefaultSubmit=t(this.preventDefaultSubmit,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.elements={"#form":"form","#save":"saveButton"},i.prototype.events={"click #save":"submit","submit #form":"preventDefaultSubmit"},i.prototype.preventDefaultSubmit=function(t){return t.preventDefault()},i.prototype.submit=function(t,e,n){var i;return null==e&&(e=this.save),null==n&&(n=this.errorHandler),this.showLoading(),(i=e())?i.fail(function(t){return function(t){return n(t)}}(this)).done(function(t){return function(e){return t.done(e)}}(this)):void 0},i.prototype.errorHandler=function(t){return this.showError(t.responseText),this.hideLoading()},i.prototype.done=function(){},i.prototype.save=function(){},i.prototype.showLoading=function(){var t;return t=$(App.Render("views/loading",{size:"micro"})),this.saveButton.data("origin",this.saveButton.html()),this.saveButton.html(t),this.saveButton.prop("disabled",!0)},i.prototype.hideLoading=function(){return this.saveButton.html(this.saveButton.data("origin")),this.saveButton.prop("disabled",!1)},i.prototype.showError=function(t){return App.Flash({type:"error",message:t})},i.prototype.collectErrorMessages=function(){},i.prototype.setupErrorModal=function(t){var e,n,i;return e=this.collectErrorMessages(),i=App.Render("manage/views/templates/upload/upload_errors_dialog",{errors:e,url:t.url("edit"),headlineMessage:_jed("%s was saved, but there were problems uploading files",_jed(t.constructor.name)),buttonLabel:_jed("Edit %s",_jed(t.constructor.name))}),n=new App.Modal(i),n.undestroyable()},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.CategoryController=function(n){function i(){this.collectErrorMessages=t(this.collectErrorMessages,this),this.finish=t(this.finish,this),this.done=t(this.done,this),i.__super__.constructor.apply(this,arguments),this.imagesController=new App.ImagesController({el:this.el.find("#images"),url:this.category.url("upload/image"),click:function(){return this.list.find(".line:not(.striked)").length||this.uploadList.length?alert(_jed("Category can have only one image.")):this.el.find("input[type='file']").trigger("click")}}),new App.InlineEntryRemoveController({el:this.el}),new App.CategoriesLinksController({el:this.el.find("#categories"),labelInput:this.el.find("#name-input"),category:this.category})}return e(i,n),i.prototype.done=function(){return this.imagesController.upload(function(t){return function(){return t.finish()}}(this))},i.prototype.finish=function(){return this.imagesController.uploadErrors.length?this.setupErrorModal(this.category):window.location=App.Category.url()+("?flash[success]="+_jed("Category saved"))},i.prototype.collectErrorMessages=function(){return this.imagesController.uploadErrors.join(", ")},i}(App.FormWithUploadController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.EditCategoryController=function(n){function i(){return this.save=t(this.save,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.save=function(){return $.ajax({url:this.category.url(),data:this.form.serializeArray(),type:"PUT"})},i}(App.CategoryController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.NewCategoryController=function(n){function i(){return this.updateUploadURL=t(this.updateUploadURL,this),this.save=t(this.save,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.save=function(){return $.post(App.Category.url(),this.form.serializeArray()).done(function(t){return function(e){return t.category.id=e.id,t.updateUploadURL()}}(this))},i.prototype.updateUploadURL=function(){return this.imagesController.url=this.category.url("upload/image")},i}(App.CategoryController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ContractsApproveController=function(n){function i(){return this.fetchOptions=t(this.fetchOptions,this),this.fetchModels=t(this.fetchModels,this),this.fetchData=t(this.fetchData,this),this.approve=t(this.approve,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"click [data-order-approve]":"approve"},i.prototype.approve=function(t){var e,n,i,r,o,s,a,l;return l=$(t.currentTarget),App.Button.disable(l),r=null!=(o=this.order)?o:App.Contract.findOrBuild(l.closest("[data-id]").data()),n=null!=(s=this.done)?s:function(t){return function(){var t;return t=l.closest(".line"),null!=t?t.html(App.Render("manage/views/contracts/line_approved",r,{accessRight:App.AccessRight,currentUserRole:App.User.current.role})):void 0}}(this),i=null!=(a=this.fail)?a:function(t){return function(e){var n;return n=function(){var n;return n=l.closest(".line"),new App.ContractsApproveFailedController({order:r,line:n,trigger:l,error:e.responseText,done:t.done}),App.Button.enable(l)},t.fetchData(r,n)}}(this),e=null!=this.comment?"function"==typeof this.comment?this.comment():this.comment:void 0,r.approve(e).done(n).fail(i)},i.prototype.fetchData=function(t,e){var n,i,r,o,s,a;for(o=[],s=[],a=t.reservations().all(),n=0,i=a.length;i>n;n++)r=a[n],null!=r.model_id?null==App.Model.exists(r.model_id)&&o.push(r.model_id):null!=r.option_id&&null==App.Option.exists(r.option_id)&&s.push(r.option_id);return this.fetchModels(o).done(function(t){return function(){return t.fetchOptions(s).done(function(){return e()})}}(this))},i.prototype.fetchModels=function(t){return t.length?App.Model.ajaxFetch({data:$.param({ids:t})}):{done:function(t){return t()}}},i.prototype.fetchOptions=function(t){return t.length?App.Option.ajaxFetch({data:$.param({ids:t})}):{done:function(t){return t()}}},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ContractsApproveFailedController=function(n){function i(e){this.approveAnyway=t(this.approveAnyway,this);var n;this.trigger=$(e.trigger),this.order=e.order,this.order.error=e.error,n=App.Render("manage/views/contracts/approval_failed_modal",this.order,{comment:e.comment,accessRight:App.AccessRight,currentUserRole:App.User.current.role}),this.modal=new App.Modal(n),this.el=this.modal.el,i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.elements={"#comment":"commentEl"},i.prototype.events={"click [data-approve-anyway]":"approveAnyway"},i.prototype.approveAnyway=function(){var t;return t=this.commentEl.val().length?this.commentEl.val():void 0,this.modal.destroy(!1),this.modal.undestroyable(),this.order.approve_anyway(t).done(function(t){return function(){return t.modal.destroyable().destroy(!0),t.done?t.done():t.line.html(App.Render("manage/views/contracts/line_approved",t.order,{accessRight:App.AccessRight,currentUserRole:App.User.current.role}))}}(this))},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ContractsApproveWithCommentController=function(n){function i(e){this.approved=t(this.approved,this);var n;this.trigger=e.trigger,this.contract=e.contract,n=App.Render("manage/views/contracts/approve_with_comment_modal",this.contract),this.modal=new App.Modal(n),this.el=this.modal.el,i.__super__.constructor.apply(this,arguments),new App.ContractsApproveController({el:this.el,done:this.approved,comment:function(t){return function(){return t.comment.val()}}(this)})}return e(i,n),i.prototype.elements={"#comment":"comment"},i.prototype.approved=function(){return window.location="/manage/"+App.InventoryPool.current.id+"/daily?flash[success]="+_jed("Order approved")},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ContractsEditController=function(n){function i(){this.contractApproved=t(this.contractApproved,this),this.approveContractWithComment=t(this.approveContractWithComment,this),this.renderPurpose=t(this.renderPurpose,this),this.swapUser=t(this.swapUser,this),this.editPurpose=t(this.editPurpose,this),this.render=t(this.render,this),this.fetchAvailability=t(this.fetchAvailability,this),this.validateLineDeletion=t(this.validateLineDeletion,this),this.setupLineSelection=t(this.setupLineSelection,this),this.setupAddLine=t(this.setupAddLine,this),this.delegateEvents=t(this.delegateEvents,this),i.__super__.constructor.apply(this,arguments),this.setupLineSelection(),this.fetchAvailability(),this.setupAddLine(),new App.SwapModelController({el:this.el}),new App.TimeLineController({el:this.el}),new App.ContractsApproveController({el:this.el,done:this.contractApproved}),new App.ContractsRejectController({el:this.el,async:!1}),new App.ReservationsDestroyController({el:this.el}),new App.ReservationsEditController({el:this.el,user:this.contract.user(),contract:this.contract}),new App.ModelCellTooltipController({el:this.el})}return e(i,n),i.prototype.elements={"#status":"status","#lines":"reservationsContainer","#purpose":"purposeContainer","#reject-contract":"rejectButton","#approve-contract":"approveButton"},i.prototype.events={"click #edit-purpose.button":"editPurpose","click #swap-user":"swapUser","click #approve-with-comment":"approveContractWithComment","click [data-destroy-line]":"validateLineDeletion","click [data-destroy-lines]":"validateLineDeletion","click [data-destroy-selected-lines]":"validateLineDeletion"},i.prototype.delegateEvents=function(){return i.__super__.delegateEvents.apply(this,arguments),App.Purpose.on("update",this.renderPurpose),App.Reservation.on("change destroy",this.fetchAvailability),App.Contract.on("refresh",this.fetchAvailability)},i.prototype.setupAddLine=function(){var t,e,n,i;return i=this,n=new App.ReservationsAddController({el:this.el.find("#add"),user:this.contract.user(),status:this.status,contract:this.contract,purpose:this.purpose,modelsPerPage:20}),t=function(t){return console.log("onChangeCallback"),i.inputValue=t,i.autocompleteController.setProps({isLoading:!0}),n.search(t,function(t){return i.autocompleteController.setProps({searchResults:t,isLoading:!1})})},e={onChange:_.debounce(t,300),onSelect:n.select,isLoading:!1,placeholder:_jed("Inventory code, model name, search term")},this.autocompleteController=new App.HandOverAutocompleteController(e,this.el.find("#add-input")[0]),this.autocompleteController._render(),window.autocompleteController=this.autocompleteController,n.setupAutocomplete(this.autocompleteController)},i.prototype.setupLineSelection=function(){return this.lineSelection=new App.LineSelectionController({el:this.el})},i.prototype.validateLineDeletion=function(t){var e;return e=$(t.currentTarget).closest("[data-id]").length?[$(t.currentTarget).closest("[data-id]").data("id")]:null!=$(t.currentTarget).data("ids")?$(t.currentTarget).data("ids"):App.LineSelectionController.selected,this.contract.reservations().all().length<=e.length?(App.Flash({type:"error",message:_jed("You cannot delete all reservations of an contract. Perhaps you want to reject it instead?")}),t.stopImmediatePropagation(),!1):void 0},i.prototype.fetchAvailability=function(){return this.render(!1),this.status.html(App.Render("manage/views/availabilities/loading")),App.Availability.ajaxFetch({data:$.param({model_ids:_.uniq(_.map(this.contract.reservations().all(),function(t){return t.model().id})),user_id:this.contract.user_id})}).done(function(t){return function(e){return t.status.html(App.Render("manage/views/availabilities/loaded")),t.render(!0)}}(this))},i.prototype.render=function(t){return this.reservationsContainer.html(App.Render("manage/views/reservations/grouped_lines",this.contract.groupedLinesByDateRange(!0),{linePartial:"manage/views/reservations/order_line",renderAvailability:t})),this.lineSelection.restore()},i.prototype.editPurpose=function(){return new App.ContractsEditPurposeController({purpose:this.purpose})},i.prototype.swapUser=function(){return new App.SwapUsersController({contract:this.contract,manageContactPerson:!0})},i.prototype.renderPurpose=function(){return this.purposeContainer.html(this.purpose.description)},i.prototype.approveContractWithComment=function(){return new App.ContractsApproveWithCommentController({trigger:this.approveButton,contract:this.contract})},i.prototype.contractApproved=function(){return window.location="/manage/"+App.InventoryPool.current.id+"/daily?flash[success]="+_jed("Order approved")},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ContractsEditPurposeController=function(n){function i(e){this.delegateEvents=t(this.delegateEvents,this),this.modal=new App.Modal(App.Render("manage/views/contracts/edit/purpose_modal",e.purpose)),this.el=this.modal.el,i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.elements={textarea:"textarea","#errors":"errorsContainer"},i.prototype.events={"submit form":"submit"},i.prototype.delegateEvents=function(){return i.__super__.delegateEvents.apply(this,arguments)},i.prototype.submit=function(t){return t.preventDefault(),this.purpose.description=_.string.clean(this.textarea.val()),this.errorsContainer.addClass("hidden"),this.purpose.save()?this.modal.destroy(!0):(this.errorsContainer.removeClass("hidden"),this.errorsContainer.find("strong").text(this.purpose.validate()))},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ContractsIndexController=function(n){function i(){this.render=t(this.render,this),this.fetchPurposes=t(this.fetchPurposes,this),this.fetchUsers=t(this.fetchUsers,this),this.fetchReservations=t(this.fetchReservations,this),this.fetchContracts=t(this.fetchContracts,this),this.fetch=t(this.fetch,this),this.reset=t(this.reset,this),i.__super__.constructor.apply(this,arguments),new App.LinesCellTooltipController({el:this.el}),new App.UserCellTooltipController({el:this.el}),new App.ContractsApproveController({el:this.el}),new App.ContractsRejectController({el:this.el,async:!0,callback:this.orderRejected}),this.pagination=new App.ListPaginationController({el:this.list,fetch:this.fetch}),this.search=new App.ListSearchController({el:this.el.find("#list-search"),reset:this.reset}),this.filter=new App.ListFiltersController({el:this.el.find("#list-filters"),reset:this.reset}),this.range=new App.ListRangeController({el:this.el.find("#list-range"),reset:this.reset}),this.tabs=new App.ListTabsController({el:this.el.find("#list-tabs"),reset:this.reset,data:{status:this.status}}),this.reset()}return e(i,n),i.prototype.elements={"#contracts":"list"},i.prototype.reset=function(){return this.contracts={},this.list.html(App.Render("manage/views/lists/loading")),this.fetch(1,this.list),this.pagination.page=1},i.prototype.fetch=function(t,e){return this.fetchContracts(t).done(function(n){return function(){return n.fetchUsers(t).done(function(){return n.fetchReservations(t,function(){return n.fetchPurposes(t,function(){return n.render(e,n.contracts[t],t)})})})}}(this))},i.prototype.fetchContracts=function(t){var e;return e=$.extend(this.tabs.getData(),$.extend(this.filter.getData(),{search_term:this.search.term(),page:t,range:this.range.get()})),"group_manager"===App.User.current.role&&(e=$.extend(e,{from_verifiable_users:!0})),App.Contract.ajaxFetch({data:$.param(e)}).done(function(e){return function(n,i,r){var o,s;return e.pagination.set(JSON.parse(r.getResponseHeader("X-Pagination"))),o=function(){var t,e,i;for(i=[],t=0,e=n.length;e>t;t++)s=n[t],i.push(App.Contract.find(s.id));return i}(),e.contracts[t]=o}}(this))},i.prototype.fetchReservations=function(t,e){var n,i;return i=_.map(this.contracts[t],function(t){return t.id}),i.length||e(),n=_.after(Math.ceil(i.length/50),e),_(i).each_slice(50,function(t){return function(t){return App.Reservation.ajaxFetch({data:$.param({contract_ids:t})}).done(n)}}(this))},i.prototype.fetchUsers=function(t){var e;return e=_.filter(_.map(this.contracts[t],function(t){return t.user_id}),function(t){return null==App.User.exists(t)}),e.length?App.User.ajaxFetch({data:$.param({ids:_.uniq(e),all:!0})}).done(function(t){return function(t){var e,n;return n=function(){var n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(App.User.find(e.id));return r}(),App.User.fetchDelegators(n)}}(this)):{done:function(t){return function(t){return t()}}(this)}},i.prototype.fetchPurposes=function(t,e){var n,i;return i=_.compact(_.filter(_.map(_.flatten(_.map(this.contracts[t],function(t){return t.reservations().all()})),function(t){return t.purpose_id}),function(t){return null==App.Purpose.exists(t)})),i.length||e(),n=_.after(Math.ceil(i.length/50),e),_(i).each_slice(50,function(t){return function(t){return App.Purpose.ajaxFetch({data:$.param({purpose_ids:_.uniq(t)})}).done(n)}}(this))},i.prototype.render=function(t,e,n){return t.html(App.Render("manage/views/contracts/line",e,{accessRight:App.AccessRight,currentUserRole:App.User.current.role})),1===n?this.pagination.renderPlaceholders():void 0},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ContractsRejectController=function(n){function i(){return this.fetchOptions=t(this.fetchOptions,this),this.fetchModels=t(this.fetchModels,this),this.fetchData=t(this.fetchData,this),this.reject=t(this.reject,this),this.setupModal=t(this.setupModal,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"click [data-order-reject]":"setupModal"},i.prototype.setupModal=function(t){var e;return this.trigger=$(t.currentTarget),this.order=App.Contract.findOrBuild(this.trigger.closest("[data-id]").data()),e=function(t){return function(){return t.modal=new App.Modal(App.Render("manage/views/contracts/reject_modal",t.order)),t.async?t.modal.el.on("submit","form",t.reject):void 0}}(this),this.fetchData(this.order,e)},i.prototype.reject=function(t){var e,n,i;return t.preventDefault(),n=this.modal.el.find("#rejection-comment").val(),this.order.reject(n),this.modal.destroy(!0),e=null!=(i=this.callback)?i:function(t){return function(){var e;return e=$(t.trigger).closest(".multibutton").length?$(t.trigger).closest(".multibutton").find(".button:first"):$(t.trigger),e.html(App.Render("manage/views/contracts/rejected_button")),App.Button.disable(e)}}(this),e.call(this)},i.prototype.fetchData=function(t,e){var n,i,r,o,s,a;for(o=[],s=[],a=t.reservations().all(),n=0,i=a.length;i>n;n++)r=a[n],null!=r.model_id?null==App.Model.exists(r.model_id)&&o.push(r.model_id):null!=r.option_id&&null==App.Option.exists(r.option_id)&&s.push(r.option_id);return this.fetchModels(o).done(function(t){return function(){return t.fetchOptions(s).done(function(){return e()})}}(this))},i.prototype.fetchModels=function(t){return t.length?App.Model.ajaxFetch({data:$.param({ids:t})}):{done:function(t){return t()}}},i.prototype.fetchOptions=function(t){return t.length?App.Option.ajaxFetch({data:$.param({ids:t})}):{done:function(t){return t()}}},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.DocumentsAfterHandOverController=function(n){function i(){this.printContract=t(this.printContract,this),this.setupModal=t(this.setupModal,this),i.__super__.constructor.apply(this,arguments),this.setupModal(),this.printContract()}return e(i,n),i.prototype.setupModal=function(){var t,e;return e=App.Render("manage/views/users/hand_over_documents_dialog",{contract:this.contract,itemsCount:this.itemsCount}),t=new App.Modal(e),t.undestroyable(),this.el=t.el},i.prototype.printContract=function(){return App.InventoryPool.current.print_contracts?window.open(this.contract.url()+"?print=true"):void 0},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.HandOverController=function(n){function i(){this.validate=t(this.validate,this),this.swapUser=t(this.swapUser,this),this.handOver=t(this.handOver,this),this.render=t(this.render,this),this.fetchFunctionsSetup=t(this.fetchFunctionsSetup,this),this.getLines=t(this.getLines,this),this.fetchAvailability=t(this.fetchAvailability,this),this.initalFetch=t(this.initalFetch,this),this.delegateEvents=t(this.delegateEvents,this),i.__super__.constructor.apply(this,arguments),this.lineSelection=new App.LineSelectionController({el:this.el,markVisitLinesController:new App.MarkVisitLinesController({el:this.el})}),this.fetchFunctionsSetup({Model:"Item",Software:"License"}),this.initalFetch(),new App.SwapModelController({el:this.el}),new App.ReservationsDestroyController({el:this.el}),new App.ReservationAssignItemController({el:this.el}),new App.TimeLineController({el:this.el}),new App.ReservationAssignOrCreateController({el:this.el.find("#assign-or-add"),user:this.user,contract:this.contract}),new App.ReservationsEditController({el:this.el,user:this.user,contract:this.contract}),new App.OptionLineChangeController({el:this.el}),new App.ModelCellTooltipController({el:this.el})}return e(i,n),i.prototype.elements={"#status":"status","#lines":"reservationsContainer"},i.prototype.events={"click [data-hand-over-selection]":"handOver","click #swap-user":"swapUser"},i.prototype.delegateEvents=function(){return i.__super__.delegateEvents.apply(this,arguments),App.Reservation.on("change destroy",function(t){return function(e){return null!=e.option_id?t.render(!0):t.fetchAvailability()}}(this)),App.Contract.on("refresh",this.fetchAvailability),App.Reservation.on("update",function(t){return function(e){var n,i;return t.notFetchedItemIds().length&&(n=t.fetchItems()),t.notFetchedLicenseIds().length&&(i=t.fetchLicenses()),n||i?$.when(n,i).done(function(){return t.render(null!=t.initialAvailabilityFetched)}):t.render(null!=t.initialAvailabilityFetched)}}(this))},i.prototype.initalFetch=function(){var t,e;return this.getLines().length?(this.notFetchedItemIds().length&&(t=$.Deferred(this.fetchItems)),this.notFetchedLicenseIds().length&&(e=$.Deferred(this.fetchLicenses)),null!=t||null!=e?$.when(t,e).done(this.fetchAvailability):this.fetchAvailability()):void 0},i.prototype.fetchAvailability=function(){var t;return this.render(!1),t=_.uniq(_.map(_.filter(this.getLines(),function(t){return null!=t.model_id}),function(t){return t.model().id})),t.length?(this.status.html(App.Render("manage/views/availabilities/loading")),App.Availability.ajaxFetch({data:$.param({model_ids:t,user_id:this.user.id})}).done(function(t){return function(e){return t.initialAvailabilityFetched=!0,t.status.html(App.Render("manage/views/availabilities/loaded")),t.render(!0)}}(this))):this.status.html(App.Render("manage/views/users/hand_over/no_handover_found"))},i.prototype.getLines=function(){return _.flatten(_.map(this.user.contracts().all(),function(t){return t.reservations().all()}))},i.prototype.fetchFunctionsSetup=function(t){var e,n;return n=function(t){return function(e,n){return _.filter(_.compact(_.map(t.getLines(),function(t){return t.model().constructor.name===e?t.item_id:null})),function(t){return null==App[n].exists(t)})}}(this),e=function(t){return function(t,e){return App[t].ajaxFetch({data:$.param({ids:e,paginate:"false"})})}}(this),_.each(t,function(t){return function(i,r){var o;return o="notFetched"+i+"Ids",t[o]=function(){return n(r,i)},t["fetch"+i+"s"]=function(){return e(i,t[o]())}}}(this))},i.prototype.render=function(t){return this.reservationsContainer.html(App.Render("manage/views/reservations/grouped_lines_with_action_date",App.Modules.HasLines.groupByDateRange(this.getLines(),!1,"start_date"),{linePartial:"manage/views/reservations/hand_over_line",renderAvailability:t})),this.lineSelection.restore()},i.prototype.handOver=function(){return this.validate()?new App.HandOverDialogController({user:this.user,contract:this.contract}):App.Flash({type:"error",message:_jed("End Date cannot be in the past")})},i.prototype.swapUser=function(){var t,e;return e=function(){var e,n,i,r;for(i=App.LineSelectionController.selected,r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push(App.Reservation.find(t));return r}(),new App.SwapUsersController({reservations:e})},i.prototype.validate=function(){var t,e;return e=function(){var e,n,i,r;for(i=App.LineSelectionController.selected,r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push(App.Reservation.find(t));return r}(),_.all(e,function(t){return!moment(t.end_date).isBefore(moment().format("YYYY-MM-DD"))})},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.HandOverDialogController=function(n){function i(e){this.validateDelegatedUser=t(this.validateDelegatedUser,this),this.toggleAddPurpose=t(this.toggleAddPurpose,this),this.validatePurpose=t(this.validatePurpose,this),this.handOver=t(this.handOver,this),this.setupModal=t(this.setupModal,this),this.validateAssignment=t(this.validateAssignment,this),this.validateEndDate=t(this.validateEndDate,this),this.validateStartDate=t(this.validateStartDate,this),this.validateDialog=t(this.validateDialog,this),this.autoFocus=t(this.autoFocus,this);var n;return this.user=e.user,this.reservations=function(){var t,e,i,r;for(i=App.LineSelectionController.selected,r=[],t=0,e=i.length;e>t;t++)n=i[t],r.push(App.Reservation.find(n));return r}(),this.purpose=_.uniq(_.map(this.reservations,function(t){return t.purpose().description})).join(", "),this.validateDialog()?(this.setupModal(),this.user.isDelegation()&&App.User.ajaxFetch({data:$.param({delegation_id:this.user.id})}).done(function(t){return function(e){var n;return t.searchSetContactPersonController=new App.SearchSetUserController({el:t.el.find("#contact-person"),localSearch:!0,customAutocompleteOptions:{source:function(){var t,i,r;for(r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push($.extend(App.User.find(n.id),{label:n.name}));return r}(),minLength:0},selectCallback:function(){return t.contract.delegated_user_id=t.searchSetContactPersonController.selectedUserId}})}}(this)),i.__super__.constructor.apply(this,arguments),this.contract.delegated_user_id=null,this.autoFocus(),void 0):!1}return e(i,n),i.prototype.events={"click [data-hand-over]":"handOver"},i.prototype.elements={"#purpose":"purposeTextArea","#note":"noteTextArea","#error":"errorContainer"},i.prototype.autoFocus=function(){var t;return(null!=(t=this.searchSetContactPersonController)?t.input.length:void 0)?this.searchSetContactPersonController.input.focus():this.purposeTextArea.length?this.purposeTextArea.focus():this.noteTextArea.focus()},i.prototype.validateDialog=function(){return this.validateStartDate()&&this.validateEndDate()&&this.validateAssignment()},i.prototype.validateStartDate=function(){return _.any(this.reservations,function(t){return moment(t.start_date).endOf("day").diff(moment().startOf("day"),"days")>0})?(App.Flash({type:"error",message:_jed("you cannot hand out reservations which are starting in the future")}),!1):!0},i.prototype.validateEndDate=function(){return _.any(this.reservations,function(t){return moment(t.end_date).endOf("day").diff(moment().startOf("day"),"days")<0})?(App.Flash({type:"error",message:_jed("you cannot hand out reservations which are ending in the past")}),!1):!0},i.prototype.validateAssignment=function(){return _.any(this.reservations,function(t){return null===t.item_id&&null===t.option_id})?(App.Flash({type:"error",message:_jed("you cannot hand out reservations with unassigned inventory codes")}),!1):!0},i.prototype.setupModal=function(){var t,e,n;return e=_.map(this.reservations,function(t){return t.start_date=moment().format("YYYY-MM-DD"),t}),this.itemsCount=_.reduce(e,function(t,e){return e.quantity+t},0),t={groupedLines:App.Modules.HasLines.groupByDateRange(e,!0),user:this.user,itemsCount:this.itemsCount,purpose:this.purpose},n=$(App.Render("manage/views/users/hand_over_dialog",t,{showAddPurpose:_.any(this.reservations,function(t){return null==t.purpose_id}),currentInventoryPool:App.InventoryPool.current})),n.find("#add-purpose").on("click",function(t){return function(t){return $(t.currentTarget).remove()&&n.find("#purpose-input").removeClass("hidden")}}(this)),this.modal=new App.Modal(n),this.el=this.modal.el},i.prototype.handOver=function(){var t;return this.purpose.length||(this.purpose=this.purposeTextArea.val()),this.validatePurpose()&&this.validateDelegatedUser()?this.contract.sign({line_ids:_.map(this.reservations,function(t){return t.id}),purpose:this.purposeTextArea.val(),note:this.noteTextArea.val(),delegated_user_id:null!=(t=this.contract.delegatedUser())?t.id:void 0}).fail(function(t){return function(e){return t.errorContainer.find("strong").html(e.responseText),t.errorContainer.removeClass("hidden")}}(this)).done(function(t){return function(e){return t.modal.undestroyable(),t.modal.el.detach(),new App.DocumentsAfterHandOverController({contract:new App.Contract(e),itemsCount:t.itemsCount})}}(this)):void 0},i.prototype.validatePurpose=function(){return App.InventoryPool.current.required_purpose&&!this.purpose.length?(this.errorContainer.find("strong").html(_jed("Specification of the purpose is required")),this.errorContainer.removeClass("hidden"),this.purposeTextArea.focus(),!1):!0},i.prototype.toggleAddPurpose=function(){},i.prototype.validateDelegatedUser=function(){return this.contract.user().isDelegation()&&!this.contract.delegatedUser()?(this.errorContainer.find("strong").html(_jed("Specification of the contact person is required")),this.errorContainer.removeClass("hidden"),this.searchSetContactPersonController.input.focus(),!1):!0},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.HandOversDeleteController=function(n){function i(){return this.onClick=t(this.onClick,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"click [data-hand-over-delete]":"onClick"},i.prototype.onClick=function(t){var e,n;return n=$(t.currentTarget),e=n.closest("[data-id]").data("id"),$.ajax({url:"/manage/"+App.InventoryPool.current.id+"/visits/"+e,type:"post",
data:{_method:"delete"},success:function(t){return function(t){var e;return e=n.closest(".line-actions"),e.html(App.Render("manage/views/hand_overs/deleted"))}}(this)})},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.OptionLineChangeController=function(n){function i(){this.change=t(this.change,this),this.focus=t(this.focus,this),i.__super__.constructor.apply(this,arguments),new PreChange("[data-line-type='option_line'] [data-line-quantity]")}return e(i,n),i.prototype.events={"change [data-line-type='option_line'] [data-line-quantity]":"change","focus [data-line-type='option_line'] [data-line-quantity]":"focus"},i.prototype.focus=function(t){var e;return e=$(t.currentTarget),e.select()},i.prototype.change=function(t){var e,n,i;return i=$(t.currentTarget),n=App.Reservation.find(i.closest("[data-id]").data("id")),e=parseInt(i.val()),e>0&&e!==n.quantity?(n.updateAttributes({quantity:e}),"preChange"===t.type?$("[data-line-type='option_line'][data-id='"+n.id+"'] [data-line-quantity]:first").focus():void 0):i.val(n.quantity)},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ReservationAssignOrCreateController=function(n){function i(){this.assignedOrCreated=t(this.assignedOrCreated,this),this.submit=t(this.submit,this),this.getEndDate=t(this.getEndDate,this),this.getStartDate=t(this.getStartDate,this);var e,n,r,o;i.__super__.constructor.apply(this,arguments),o=this,r=new App.ReservationsAddController({el:this.el,user:this.user,status:this.status,contract:this.contract,optionsEnabled:!0,modelsPerPage:30,optionsPerPage:100,onSubmitInventoryCode:this.submit,addModelForHandOver:!0}),e=function(t){return o.inputValue=t,o.autocompleteController.setProps({isLoading:!0}),r.search(t,function(t){return o.autocompleteController.setProps({searchResults:t,isLoading:!1})})},n={onChange:_.debounce(e,300),onSelect:r.select,isLoading:!1,placeholder:_jed("Inventory code, model name, search term")},this.autocompleteController=new App.HandOverAutocompleteController(n,this.el.find("#assign-or-add-input")[0]),this.autocompleteController._render(),window.autocompleteController=this.autocompleteController,r.setupAutocomplete(this.autocompleteController)}return e(i,n),i.prototype.elements={"#add-start-date":"addStartDate","#add-end-date":"addEndDate"},i.prototype.getStartDate=function(){return moment(this.addStartDate.val(),i18n.date.L)},i.prototype.getEndDate=function(){return moment(this.addEndDate.val(),i18n.date.L)},i.prototype.submit=function(t){return console.log("TEST",t),(null!=t?t.length:void 0)?(App.Reservation.assignOrCreate({start_date:this.getStartDate().format("YYYY-MM-DD"),end_date:this.getEndDate().format("YYYY-MM-DD"),code:t,contract_id:this.contract.id}).done(function(e){return function(n){return console.log(n),e.assignedOrCreated(t,n)}}(this)).error(function(t){return function(t){return App.Flash({type:"error",message:t.responseText})}}(this)),this.autocompleteController.getInstance().resetInput()):!1},i.prototype.assignedOrCreated=function(t,e){var n;return console.log("assignedOrCreated",{inventoryCode:t,data:e},App.Reservation.exists(e.id)),n=function(n){return function(){var i;return App.Reservation.exists(e.id)?(i=App.Reservation.update(e.id,e),null!=i.model_id?App.Flash({type:"success",message:_jed("%s assigned to %s",[t,i.model().name()])}):null!=i.option_id&&App.Flash({type:"notice",message:_jed("%s quantity increased to %s",[i.option().name(),i.quantity])})):(i=App.Reservation.addRecord(new App.Reservation(e)),App.Contract.trigger("refresh",n.contract),App.Flash({type:"success",message:_jed("Added %s",i.model().name())})),App.LineSelectionController.add(i.id)}}(this),null!=e.model_id?App.Item.ajaxFetch({data:$.param({ids:[e.item_id]})}).done(function(t){return function(){return App.Model.ajaxFetch({data:$.param({ids:[e.model_id]})}).done(n)}}(this)):null!=e.option_id?App.Option.ajaxFetch({data:$.param({ids:[e.option_id]})}).done(n):void 0},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ReturnedQuantityController=function(n){function i(){return this.updateWith=t(this.updateWith,this),this.restore=t(this.restore,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.returnedQuantities=[],i.prototype.restore=function(){return _.each(this.returnedQuantities,function(t){return function(e){var n;return null!=(n=t.el.find(".line[data-id='"+e.id+"'] [data-quantity-returned]"))?n.val(e.quantity):void 0}}(this))},i.prototype.updateWith=function(t,e){return this.returnedQuantities=_.reject(this.returnedQuantities,function(e){return e.id===t}),this.returnedQuantities.push({id:t,quantity:e})},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.SearchSetUserController=function(n){function i(e){this.removeUser=t(this.removeUser,this),i.__super__.constructor.apply(this,arguments),this.localSearch===!0?(this.setupAutocomplete(),this.input.on("focus",function(){return $(this).autocomplete("search")}),this.input.autocomplete("search")):this.input.preChange({delay:200})}return e(i,n),i.prototype.events={"preChange #user-id":"searchUser","click #remove-user":"removeUser"},i.prototype.elements={"#user-id":"input","#selected-user":"selectedUser"},i.prototype.setupAutocomplete=function(t){var e;return e={appendTo:this.el,source:function(e){return function(e,n){var i;return i=_.map(t,function(t){return t.value=t.id,t}),n(i)}}(this),focus:function(t){return function(){return!1}}(this),select:function(t){return function(e,n){return t.selectUser(n.item),!1}}(this)},$.extend(e,this.customAutocompleteOptions),this.input.autocomplete(e).data("uiAutocomplete")._renderItem=function(t){return function(t,e){return $(App.Render("manage/views/users/autocomplete_element",e)).data("value",e).appendTo(t)}}(this)},i.prototype.searchUser=function(){var t,e;return e=this.input.val(),0===e.length?!1:(t={search_term:e},$.extend(t,this.additionalSearchParams),App.User.ajaxFetch({data:$.param(t)}).done(function(t){return function(e){var n;return t.setupAutocomplete(function(){var t,i,r;for(r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push(App.User.find(n.id));return r}()),t.input.autocomplete("search")}}(this)))},i.prototype.selectUser=function(t){return this.input.hide().autocomplete("disable").attr("value",t.id),this.selectedUserId=t.id,this.selectedUser.html(App.Render("manage/views/contracts/edit/swapped_user",t)),"function"==typeof this.selectCallback?this.selectCallback():void 0},i.prototype.removeUser=function(){return this.input.show().autocomplete("enable").val("").focus(),this.selectedUserId=null,this.selectedUser.html("")},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.SwapUsersController=function(n){function i(e){this.setupContactPerson=t(this.setupContactPerson,this),this.renderContactPerson=t(this.renderContactPerson,this),this.swapReservations=t(this.swapReservations,this),this.swapContract=t(this.swapContract,this),this.delegateEvents=t(this.delegateEvents,this),this.contract=null!=e.reservations?e.reservations[0].contract():e.contract,this.modal=new App.Modal(App.Render("manage/views/contracts/edit/swap_user_modal",this.contract)),this.el=this.modal.el,i.__super__.constructor.apply(this,arguments),this.searchSetUserController=new App.SearchSetUserController({el:this.el.find("#user #swapped-person"),selectCallback:this.manageContactPerson?function(t){return function(){return t.setupContactPerson()}}(this):null}),this.manageContactPerson&&this.setupContactPerson()}return e(i,n),i.prototype.events={"submit form":"submit"},i.prototype.elements={form:"form","#errors":"errorsContainer","button[type='submit']":"submitButton"},i.prototype.delegateEvents=function(){return i.__super__.delegateEvents.apply(this,arguments)},i.prototype.submit=function(t){return t.preventDefault(),this.errorsContainer.addClass("hidden"),App.Button.disable(this.submitButton),null!=this.reservations?this.swapReservations():this.swapContract()},i.prototype.swapContract=function(){var t,e,n;return n=null!=(t=this.searchSetUserController.selectedUserId)?t:this.contract.user().id,this.contract.swapUser(n,null!=(e=this.searchSetContactPersonController)?e.selectedUserId:void 0).done(function(t){return function(t){var e;return e=new App.Contract(t),window.location=e.editPath()}}(this)).fail(function(t){return function(e){return t.errorsContainer.removeClass("hidden"),App.Button.enable(t.submitButton),t.errorsContainer.find("strong").text(e.responseText)}}(this))},i.prototype.swapReservations=function(){return App.Reservation.swapUser(this.reservations,this.searchSetUserController.selectedUserId).done(function(t){return function(){return window.location=App.User.find(t.searchSetUserController.selectedUserId).url("hand_over")}}(this)).fail(function(t){return function(){return t.errorsContainer.removeClass("hidden"),App.Button.enable(t.submitButton),t.errorsContainer.find("strong").text(_jed("Invalid data"))}}(this))},i.prototype.renderContactPerson=function(){return this.form.append(App.Render("manage/views/contracts/edit/contact_person",this.contract))},i.prototype.setupContactPerson=function(){var t,e;return this.el.find("#contact-person").remove(),this.searchSetContactPersonController=null,e=null!=(t=this.searchSetUserController.selectedUserId)?t:this.contract.user().id,App.User.find(e).isDelegation()?(this.renderContactPerson(),App.User.ajaxFetch({data:$.param({delegation_id:e})}).done(function(t){return function(e){var n;return t.searchSetContactPersonController=new App.SearchSetUserController({el:t.el.find("#contact-person #swapped-person"),localSearch:!0,customAutocompleteOptions:{source:function(){var t,i,r;for(r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push($.extend(App.User.find(n.id),{label:n.name}));return r}(),minLength:0}})}}(this))):void 0},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.TakeBackController=function(n){function i(){this.inspectItem=t(this.inspectItem,this),this.changeQuantity=t(this.changeQuantity,this),this.showAutocomplete=t(this.showAutocomplete,this),this.select=t(this.select,this),this.setupAutocomplete=t(this.setupAutocomplete,this),this.increaseOption=t(this.increaseOption,this),this.getQuantity=t(this.getQuantity,this),this.getCheckLineFunction=t(this.getCheckLineFunction,this),this.assign=t(this.assign,this),this.takeBack=t(this.takeBack,this),this.render=t(this.render,this),this.getLines=t(this.getLines,this),this.fetchAvailability=t(this.fetchAvailability,this),this.delegateEvents=t(this.delegateEvents,this),i.__super__.constructor.apply(this,arguments),App.TakeBackController.readyForTakeBack=[],this.lineSelection=new App.LineSelectionController({el:this.el,markVisitLinesController:new App.MarkVisitLinesController({el:this.el})}),this.returnedQuantitiesController=new App.ReturnedQuantityController({el:this.el}),this.getLines().length&&this.fetchAvailability(),this.setupAutocomplete(),new App.TimeLineController({el:this.el}),new App.ReservationsEditController({el:this.el,user:this.user,contract:this.contract,startDateDisabled:!0,quantityDisabled:!0}),new PreChange("[data-quantity-returned]"),new App.ModelCellTooltipController({el:this.el})}return e(i,n),i.prototype.elements={"#status":"status","#lines":"reservationsContainer","form#assign":"form","#assign-input":"input"},i.prototype.events={"click [data-take-back-selection]":"takeBack","click [data-inspect-item]":"inspectItem","submit form#assign":"assign","focus #assign-input":"showAutocomplete","change [data-quantity-returned]":"changeQuantity","preChange [data-quantity-returned]":"changeQuantity"},i.prototype.delegateEvents=function(){return i.__super__.delegateEvents.apply(this,arguments),App.Reservation.on("refresh",this.fetchAvailability),App.Item.on("refresh",function(t){return function(){return t.render(!0)}}(this))},i.prototype.fetchAvailability=function(){var t,e;return this.render(!1),e=_.uniq(_.map(_.filter(this.getLines(),function(t){return null!=t.model_id}),function(t){return t.model().id})),t=function(t){return function(e){return t.initalAvailabilityFetched=!0,t.status.html(App.Render("manage/views/availabilities/loaded")),t.render(!0)}}(this),e.length?(this.status.html(App.Render("manage/views/availabilities/loading")),App.Availability.ajaxFetch({data:$.param({model_ids:e,user_id:this.user.id})}).done(t)):t()},i.prototype.getLines=function(){return _.flatten(_.map(this.user.contracts().all(),function(t){return t.reservations().all()}))},i.prototype.render=function(t){return this.reservationsContainer.html(App.Render("manage/views/reservations/grouped_lines_with_action_date",App.Modules.HasLines.groupByDateRange(this.getLines(),!1,"end_date"),{linePartial:"manage/views/reservations/take_back_line",renderAvailability:t})),this.returnedQuantitiesController.restore(),this.lineSelection.restore()},i.prototype.takeBack=function(){var t,e,n,i,r,o,s;for(s={},o=function(){var t,n,i,r;for(i=App.LineSelectionController.selected,r=[],t=0,n=i.length;n>t;t++)e=i[t],r.push(App.Reservation.find(e));return r}(),t=0,n=o.length;n>t;t++)if(i=o[t],null!=i.option_id){if(r=this.getQuantity(i),0===r)return App.Flash({type:"error",message:_jed("You have to provide the quantity for the things you want to return")}),!1;s[i.id]=this.getQuantity(i)}return new App.TakeBackDialogController({user:this.user,reservations:o,returnedQuantity:s})},i.prototype.assign=function(t){var e,n,i;return null!=t&&t.preventDefault(),e=this.input.val(),n=_.find(this.getLines(),this.getCheckLineFunction(e)),n?(App.Flash({type:"success",message:_jed("%s selected for take back",n.model().name())}),App.LineSelectionController.add(n.id),n.option_id&&this.increaseOption(n)):App.Reservation.findByAttribute("option_id",null!=(i=App.Option.findByAttribute("inventory_code",e))?i.id:void 0)?App.Flash({type:"error",message:_jed("You can not take back more options then you handed over")}):App.Flash({type:"error",message:_jed("%s was not found for this take back",e)}),this.input.val("").blur()},i.prototype.getCheckLineFunction=function(t){var e;return e=this.el,function(n){return n.inventoryCode().toLowerCase()===t.toLowerCase()&&(n.option()?e.find(".line[data-id='"+n.id+"'] input[data-quantity-returned]").val()<n.quantity:!0)}},i.prototype.getQuantity=function(t){var e,n;return e=this.el.find(".line[data-id='"+t.id+"'] input[data-quantity-returned]"),n=e.val().length?parseInt(e.val()):0,_.isNaN(n)&&(n=1),n},i.prototype.increaseOption=function(t){var e,n;return n=this.getQuantity(t)+1,e=this.el.find(".line[data-id='"+t.id+"'] input[data-quantity-returned]"),e.val(n),App.Flash({type:"success",message:_jed("%s quantity increased to %s",[t.model().name(),n])}),this.changeQuantity({currentTarget:e})},i.prototype.setupAutocomplete=function(){return this.input.autocomplete({appendTo:this.el,source:function(t){return function(e,n){var i,r,o;return i=function(){var t,e,n,i;for(n=this.getLines(),i=[],t=0,e=n.length;e>t;t++)r=n[t],i.push({name:r.model().name(),inventoryCode:r.inventoryCode(),record:r});return i}.call(t),o=RegExp(e.term,"i"),i=_.filter(i,function(t){var e;return t.name.match(o)||(null!=(e=t.inventoryCode)?e.match(o):void 0)}),n(i)}}(this),focus:function(t){return function(){return!1}}(this),select:this.select}).data("uiAutocomplete")._renderItem=function(t){return function(t,e){return $(App.Render("manage/views/reservations/assign/autocomplete_element",e)).data("value",e).appendTo(t)}}(this)},i.prototype.select=function(t,e){return this.input.val(e.item.record.inventoryCode()),this.assign()},i.prototype.showAutocomplete=function(){return this.input.autocomplete("search")},i.prototype.changeQuantity=function(t){var e,n,i,r,o;return o=$(t.currentTarget),e=App.Reservation.find(o.closest("[data-id]").data("id")),App.LineSelectionController.add(e.id),null!=(i=this.lineSelection.markVisitLinesController)&&i.update(App.LineSelectionController.selected),n=parseInt(o.val()),_.isNaN(n)&&o.val(0),0>n&&o.val(0),e.quantity<n?(App.Flash({type:"error",message:_jed("You can not take back more items then you handed over")}),o.val(e.quantity),null!=(r=this.lineSelection.markVisitLinesController)?r.update(App.LineSelectionController.selected):void 0):this.returnedQuantitiesController.updateWith(e.id,n)},i.prototype.inspectItem=function(t){var e;return e=App.Item.find($(t.currentTarget).data("item-id")),new App.ItemInspectDialogController({item:e})},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.TakeBackDialogController=function(n){function i(){this.showDocuments=t(this.showDocuments,this),this.takeBack=t(this.takeBack,this),this.getItemsCount=t(this.getItemsCount,this),this.setupModal=t(this.setupModal,this),i.__super__.constructor.apply(this,arguments),this.setupModal(),this.el.on("click","[data-take-back]",this.takeBack)}return e(i,n),i.prototype.setupModal=function(){var t,e,n;return n=_.map(this.reservations,function(t){return t.end_date=moment().format("YYYY-MM-DD"),t}),t={groupedLines:App.Modules.HasLines.groupByDateRange(n,!0),user:this.user,itemsCount:this.getItemsCount()},e={returnedQuantity:this.returnedQuantity},this.modal=new App.Modal(App.Render("manage/views/users/take_back_dialog",t,e)),this.el=this.modal.el},i.prototype.getItemsCount=function(){return _.reduce(this.reservations,function(t){return function(e,n){return(t.returnedQuantity[n.id]||n.quantity)+e}}(this),0)},i.prototype.takeBack=function(){return this.modal.undestroyable(),this.modal.el.detach(),App.Reservation.takeBack(this.reservations,this.returnedQuantity).done(function(t){return function(e){return t.showDocuments(t.reservations)}}(this))},i.prototype.showDocuments=function(t){var e,n,i;return e=_.uniq(_.map(t,function(t){return t.contract()}),function(t){return t.id}),i=App.Render("manage/views/users/take_back_documents_dialog",{user:this.user,contracts:e,itemsCount:this.getItemsCount()}),n=new App.Modal(i),n.undestroyable()},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.TakeBacksSendReminderController=function(n){function i(){return this.send=t(this.send,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"click [data-send-takeback-reminder]":"send"},i.prototype.send=function(t){var e,n,i;return i=$(t.currentTarget),n=App.Visit.findOrBuild(i.closest("[data-id]").data()),n.remind(),e=i.closest(".line"),e.length&&e.find(".latest-reminder-cell").html(App.Render("manage/views/take_backs/reminder_send")),i.closest(".dropdown").hide()},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.VisitsIndexController=function(n){function i(){this.render=t(this.render,this),this.fetchPurposes=t(this.fetchPurposes,this),this.fetchUsers=t(this.fetchUsers,this),this.fetchReservations=t(this.fetchReservations,this),this.fetchVisits=t(this.fetchVisits,this),this.fetch=t(this.fetch,this),this.reset=t(this.reset,this),i.__super__.constructor.apply(this,arguments),new App.LinesCellTooltipController({el:this.el}),new App.UserCellTooltipController({el:this.el}),new App.LatestReminderTooltipController({el:this.el}),new App.HandOversDeleteController({el:this.el}),new App.TakeBacksSendReminderController({el:this.el}),this.pagination=new App.ListPaginationController({el:this.list,fetch:this.fetch}),this.search=new App.ListSearchController({el:this.el.find("#list-search"),reset:this.reset}),this.range=new App.ListRangeController({el:this.el.find("#list-range"),reset:this.reset}),this.tabs=new App.ListTabsController({el:this.el.find("#list-tabs"),reset:this.reset,data:{status:["approved","signed"]}}),this.reset()}return e(i,n),i.prototype.elements={"#visits":"list"},i.prototype.reset=function(){return this.visits={},this.list.html(App.Render("manage/views/lists/loading")),this.fetch(1,this.list)},i.prototype.fetch=function(t,e){return this.fetchVisits(t).done(function(n){return function(){return n.fetchReservations(t,function(){return n.fetchUsers(t).done(function(){return n.fetchPurposes(t,function(){return n.render(e,n.visits[t],t)})})})}}(this))},i.prototype.fetchVisits=function(t){return App.Visit.ajaxFetch({data:$.param($.extend(this.tabs.getData(),{search_term:this.search.term(),page:t,range:this.range.get()}))}).done(function(e){return function(n,i,r){var o,s;return e.pagination.set(JSON.parse(r.getResponseHeader("X-Pagination"))),s=function(){var t,e,i;for(i=[],t=0,e=n.length;e>t;t++)o=n[t],i.push(App.Visit.find(o.id));return i}(),e.visits[t]=s}}(this))},i.prototype.fetchReservations=function(t,e){var n,i;return i=_.flatten(_.map(this.visits[t],function(t){return t.reservation_ids})),i.length||e(),n=_.after(Math.ceil(i.length/50),e),_(i).each_slice(50,function(t){return function(t){return App.Reservation.ajaxFetch({data:$.param({ids:t})}).done(n)}}(this))},i.prototype.fetchUsers=function(t){var e;return e=_.filter(_.map(this.visits[t],function(t){return t.user_id}),function(t){return null==App.User.exists(t)}),e.length?App.User.ajaxFetch({data:$.param({ids:e})}).done(function(t){return function(t){var e,n;return n=function(){var n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(App.User.find(e.id));return r}(),App.User.fetchDelegators(n)}}(this)):{done:function(t){return function(t){return t()}}(this)}},i.prototype.fetchPurposes=function(t,e){var n,i;return i=_.compact(_.filter(_.map(_.flatten(_.map(this.visits[t],function(t){return t.reservations().all()})),function(t){return t.purpose_id}),function(t){return null==App.Purpose.exists(t)})),i.length||e(),n=_.after(Math.ceil(i.length/50),e),_(i).each_slice(50,function(t){return function(t){return App.Purpose.ajaxFetch({data:$.param({purpose_ids:t})}).done(n)}}(this))},i.prototype.render=function(t,e,n){return t.html(App.Render("manage/views/visits/line",e)),1===n?this.pagination.renderPlaceholders():void 0},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.SearchOverviewController=function(n){function i(){this.searchOptions=t(this.searchOptions,this),this.fetchPurposes=t(this.fetchPurposes,this),this.searchOrders=t(this.searchOrders,this),this.fetchReservations=t(this.fetchReservations,this),this.fetchUsers=t(this.fetchUsers,this),this.searchContracts=t(this.searchContracts,this),this.searchUsers=t(this.searchUsers,this),this.searchDelegations=t(this.searchDelegations,this),this.fetchModels=t(this.fetchModels,this),this.searchLicenses=t(this.searchLicenses,this),this.searchItems=t(this.searchItems,this),this.fetchAvailability=t(this.fetchAvailability,this),this.render=t(this.render,this),this.searchSoftware=t(this.searchSoftware,this),this.searchModels=t(this.searchModels,this),i.__super__.constructor.apply(this,arguments),this.previewAmount=5,this.searchModels(),this.searchSoftware(),this.searchItems(),this.searchLicenses(),this.searchOptions(),this.searchUsers(),this.searchDelegations(),this.searchContracts(),this.searchOrders(),new App.LatestReminderTooltipController({el:this.el}),new App.LinesCellTooltipController({el:this.el}),new App.UserCellTooltipController({el:this.el}),new App.HandOversDeleteController({el:this.el}),new App.ContractsApproveController({el:this.el}),new App.TakeBacksSendReminderController({el:this.el}),new App.ContractsRejectController({el:this.el,async:!0,callback:this.orderRejected}),new App.TimeLineController({el:this.el})}return e(i,n),i.prototype.elements={"#models":"models","#software":"software","#items":"items","#licenses":"licenses","#users":"users","#delegations":"delegations","#contracts":"contracts","#orders":"orders","#options":"options","#loading":"loading"},i.prototype.removeLoading=_.after(5,function(){return this.loading.remove()}),i.prototype.searchModels=function(){return App.Model.ajaxFetch({data:$.param({type:"model",per_page:this.previewAmount,search_term:this.searchTerm})}).done(function(t){return function(e,n,i){var r,o;return o=function(){var t,n,i;for(i=[],t=0,n=e.length;n>t;t++)r=e[t],i.push(App.Model.find(r.id));return i}(),t.fetchAvailability(o).done(function(){return t.render(t.models,"manage/views/models/line",o,i)})}}(this))},i.prototype.searchSoftware=function(){return App.Software.ajaxFetch({data:$.param({type:"software",per_page:this.previewAmount,search_term:this.searchTerm})}).done(function(t){return function(e,n,i){var r,o;return o=function(){var t,n,i;for(i=[],t=0,n=e.length;n>t;t++)r=e[t],i.push(App.Software.find(r.id));return i}(),t.fetchAvailability(o).done(function(){return t.render(t.software,"manage/views/software/line",o,i)})}}(this))},i.prototype.render=function(t,e,n,i){var r;return r=JSON.parse(i.getResponseHeader("X-Pagination")).total_count,this.removeLoading(),n.length&&(t.find(".list-of-lines").html(App.Render(e,n,{currentInventoryPool:App.InventoryPool.current,accessRight:App.AccessRight,currentUserRole:App.User.current.role})),t.removeClass("hidden")),r>this.previewAmount?t.find("[data-type='show-all']").removeClass("hidden").append($("<span class='badge margin-left-s'>"+r+"</span>")):void 0},i.prototype.fetchAvailability=function(t){var e;return e=_.map(t,function(t){return t.id}),e.length?App.Availability.ajaxFetch({url:App.Availability.url()+"/in_stock",data:$.param({model_ids:e})}):{done:function(t){return t()}}},i.prototype.searchItems=function(){return App.Item.ajaxFetch({data:$.param({type:"item",per_page:this.previewAmount,search_term:this.searchTerm,current_inventory_pool:!1})}).done(function(t){return function(e,n,i){var r,o;return o=function(){var t,n,i;for(i=[],t=0,n=e.length;n>t;t++)r=e[t],i.push(App.Item.find(r.id));return i}(),t.fetchModels(o).done(function(){return t.render(t.items,"manage/views/items/line",o,i)})}}(this))},i.prototype.searchLicenses=function(){return App.License.ajaxFetch({data:$.param({type:"license",per_page:this.previewAmount,search_term:this.searchTerm,current_inventory_pool:!1})}).done(function(t){return function(e,n,i){var r,o;return o=function(){var t,n,i;for(i=[],t=0,n=e.length;n>t;t++)r=e[t],i.push(App.License.find(r.id));return i}(),t.fetchModels(o).done(function(){return t.render(t.licenses,"manage/views/licenses/line",o,i)})}}(this))},i.prototype.fetchModels=function(t){var e;return e=_.uniq(_.map(t,function(t){return t.model_id})),e.length?App.Model.ajaxFetch({data:$.param({ids:e,paginate:!1,include_package_models:!0})}):{done:function(t){return t()}}},i.prototype.searchDelegations=function(){return App.User.ajaxFetch({data:$.param({per_page:this.previewAmount,search_term:this.searchTerm,type:"delegation"})}).done(function(t){return function(e,n,i){var r,o;return o=function(){var t,n,i;for(i=[],t=0,n=e.length;n>t;t++)r=e[t],i.push(App.User.find(r.id));return i}(),App.User.fetchDelegators(o,function(){return t.render(t.delegations,"manage/views/users/search_result_line",o,i)})}}(this))},i.prototype.searchUsers=function(){return App.User.ajaxFetch({data:$.param({per_page:this.previewAmount,search_term:this.searchTerm,type:"user"})}).done(function(t){return function(e,n,i){var r,o;return o=function(){var t,n,i;for(i=[],t=0,n=e.length;n>t;t++)r=e[t],i.push(App.User.find(r.id));return i}(),t.render(t.users,"manage/views/users/search_result_line",o,i)}}(this))},i.prototype.searchContracts=function(){return App.Contract.ajaxFetch({data:$.param({per_page:this.previewAmount,global_contracts_search:!0,search_term:this.searchTerm,status:["signed","closed"]})}).done(function(t){return function(e,n,i){var r,o;return r=function(){var t,n,i;for(i=[],t=0,n=e.length;n>t;t++)o=e[t],i.push(App.Contract.find(o.id));return i}(),t.fetchUsers(r,"all").done(function(){return t.fetchReservations(r).done(function(){return t.render(t.contracts,"manage/views/contracts/line",r,i)})})}}(this))},i.prototype.fetchUsers=function(t,e){var n,i;return null==e&&(e=!1),i=_.uniq(_.map(t,function(t){return t.user_id})),i.length?(n={ids:i,paginate:!1},"all"===e&&$.extend(n,{all:!0}),App.User.ajaxFetch({data:$.param(n)}).done(function(t){return function(t){var e,n;return n=function(){var n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(App.User.find(e.id));return r}(),App.User.fetchDelegators(n)}}(this))):{done:function(t){return t()}}},i.prototype.fetchReservations=function(t){var e;return e=_.flatten(_.map(t,function(t){return t.id})),e.length?App.Reservation.ajaxFetch({data:$.param({contract_ids:e,paginate:!1})}):{done:function(t){return t()}}},i.prototype.searchOrders=function(){return App.Contract.ajaxFetch({data:$.param({per_page:this.previewAmount,search_term:this.searchTerm,status:["approved","submitted","rejected"]})}).done(function(t){return function(e,n,i){var r,o;return r=function(){var t,n,i;for(i=[],t=0,n=e.length;n>t;t++)o=e[t],i.push(App.Contract.find(o.id));return i}(),t.fetchUsers(r).done(function(){return t.fetchReservations(r).done(function(){return t.fetchPurposes(r).done(function(){return t.render(t.orders,"manage/views/contracts/line",r,i)})})})}}(this))},i.prototype.fetchPurposes=function(t){var e;return e=_.compact(_.filter(_.map(_.flatten(_.map(t,function(t){return t.reservations().all()})),function(t){return t.purpose_id}),function(t){return null==App.Purpose.exists(t)})),e.length?App.Purpose.ajaxFetch({data:$.param({purpose_ids:e,paginate:!1})}):{done:function(t){return function(t){return t()}}(this)}},i.prototype.searchOptions=function(){return App.Option.ajaxFetch({data:$.param({per_page:this.previewAmount,search_term:this.searchTerm})}).done(function(t){return function(e,n,i){var r,o;return o=function(){var t,n,i;for(i=[],t=0,n=e.length;n>t;t++)r=e[t],i.push(App.Option.find(r.id));return i}(),t.render(t.options,"manage/views/options/line",o,i)}}(this))},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.SearchResultsController=function(n){function i(){this.render=t(this.render,this),this._fetch=t(this._fetch,this),this.reset=t(this.reset,this),i.__super__.constructor.apply(this,arguments),this.additionalData={accessRight:App.AccessRight,currentUserRole:App.User.current.role,currentInventoryPool:App.InventoryPool.current},this.pagination=new App.ListPaginationController({el:this.list,fetch:this._fetch}),this.reset()}return e(i,n),i.prototype.elements={".list-of-lines":"list"},i.prototype.reset=function(){return this.records={},this.list.html(App.Render("manage/views/lists/loading")),this._fetch(1,this.list)},i.prototype._fetch=function(t,e){
var n;return n=_.after(2,function(n){return function(){return n.render(e,n.records[t],t,n.additionalData)}}(this)),this.fetch(t,e,n).done(function(e){return function(i,r,o){var s,a;return e.pagination.set(JSON.parse(o.getResponseHeader("X-Pagination"))),a=function(){var t,e,n;for(n=[],t=0,e=i.length;e>t;t++)s=i[t],n.push(App[this.model].find(s.id));return n}.call(e),e.records[t]=a,n()}}(this))},i.prototype.render=function(t,e,n,i){return 1!==n||null!=e&&0!==e.length?(t.html(App.Render(this.templatePath,e,i)),1===n?this.pagination.renderPlaceholders():void 0):t.html(App.Render("manage/views/lists/no_results"))},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.SearchResultsContractsController=function(n){function i(){this.fetchReservations=t(this.fetchReservations,this),this.fetchUsers=t(this.fetchUsers,this),this.fetchContracts=t(this.fetchContracts,this),this.fetch=t(this.fetch,this),i.__super__.constructor.apply(this,arguments),new App.LinesCellTooltipController({el:this.el}),new App.UserCellTooltipController({el:this.el}),new App.TakeBacksSendReminderController({el:this.el})}return e(i,n),i.prototype.model="Contract",i.prototype.templatePath="manage/views/contracts/line",i.prototype.fetch=function(t,e,n){return this.fetchContracts(t).done(function(t){return function(e){var i,r;return i=function(){var t,n,i;for(i=[],t=0,n=e.length;n>t;t++)r=e[t],i.push(App.Contract.find(r.id));return i}(),t.fetchUsers(i).done(function(){return t.fetchReservations(i).done(function(){return n()})})}}(this))},i.prototype.fetchContracts=function(t){return App.Contract.ajaxFetch({data:$.param({search_term:this.searchTerm,global_contracts_search:!0,page:t,status:["signed","closed"]})})},i.prototype.fetchUsers=function(t){var e;return e=_.uniq(_.map(t,function(t){return t.user_id})),e.length?App.User.ajaxFetch({data:$.param({ids:e,all:!0,paginate:!1})}).done(function(t){return function(t){var e,n;return n=function(){var n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(App.User.find(e.id));return r}(),App.User.fetchDelegators(n)}}(this)):{done:function(t){return t()}}},i.prototype.fetchReservations=function(t){var e;return e=_.flatten(_.map(t,function(t){return t.id})),e.length?App.Reservation.ajaxFetch({data:$.param({contract_ids:e})}):{done:function(t){return t()}}},i}(App.SearchResultsController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.SearchResultsItemsController=function(n){function i(){return this.fetchModels=t(this.fetchModels,this),this.fetchItems=t(this.fetchItems,this),this.fetch=t(this.fetch,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.model="Item",i.prototype.dependingOnModel="Model",i.prototype.templatePath="manage/views/items/line",i.prototype.type="item",i.prototype.fetch=function(t,e,n){return this.fetchItems(t).done(function(t){return function(e){var i,r;return r=function(){var t,n,r;for(r=[],t=0,n=e.length;n>t;t++)i=e[t],r.push(App[this.model].find(i.id));return r}.call(t),t.fetchModels(r).done(function(){return n()})}}(this))},i.prototype.fetchItems=function(t){return App[this.model].ajaxFetch({data:$.param({search_term:this.searchTerm,type:this.type,page:t,current_inventory_pool:!1})})},i.prototype.fetchModels=function(t){var e;return e=_.uniq(_.map(t,function(t){return t.model_id})),e.length?App[this.dependingOnModel].ajaxFetch({data:$.param({ids:e,paginate:!1,include_package_models:!0})}):{done:function(t){return t()}}},i}(App.SearchResultsController)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;window.App.SearchResultsLicensesController=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.model="License",n.prototype.templatePath="manage/views/licenses/line",n.prototype.type="license",n}(App.SearchResultsItemsController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.SearchResultsModelsController=function(n){function i(){this.fetchAvailability=t(this.fetchAvailability,this),this.fetchModels=t(this.fetchModels,this),this.fetch=t(this.fetch,this),i.__super__.constructor.apply(this,arguments),new App.TimeLineController({el:this.el})}return e(i,n),i.prototype.model="Model",i.prototype.templatePath="manage/views/models/line",i.prototype.type="model",i.prototype.fetch=function(t,e,n){return this.fetchModels(t).done(function(t){return function(e){var i,r;return r=function(){var t,n,r;for(r=[],t=0,n=e.length;n>t;t++)i=e[t],r.push(App[this.model].find(i.id));return r}.call(t),t.fetchAvailability(r).done(function(){return n()})}}(this))},i.prototype.fetchModels=function(t){return App[this.model].ajaxFetch({data:$.param({search_term:this.searchTerm,type:this.type,page:t})})},i.prototype.fetchAvailability=function(t){var e;return e=_.map(t,function(t){return t.id}),e.length?App.Availability.ajaxFetch({url:App.Availability.url()+"/in_stock",data:$.param({model_ids:e})}):{done:function(t){return t()}}},i}(App.SearchResultsController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.SearchResultsOptionsController=function(n){function i(){this.fetchOptions=t(this.fetchOptions,this),this.fetch=t(this.fetch,this),i.__super__.constructor.apply(this,arguments),new App.TimeLineController({el:this.el})}return e(i,n),i.prototype.model="Option",i.prototype.templatePath="manage/views/options/line",i.prototype.fetch=function(t,e,n){return this.fetchOptions(t).done(function(t){return function(t){var e,i;return i=function(){var n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(App.Option.find(e.id));return r}(),n()}}(this))},i.prototype.fetchOptions=function(t){return App.Option.ajaxFetch({data:$.param({search_term:this.searchTerm,page:t})})},i}(App.SearchResultsController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.SearchResultsOrdersController=function(n){function i(){this.fetchPurposes=t(this.fetchPurposes,this),this.fetchReservations=t(this.fetchReservations,this),this.fetchUsers=t(this.fetchUsers,this),this.fetchOrders=t(this.fetchOrders,this),this.fetch=t(this.fetch,this),i.__super__.constructor.apply(this,arguments),new App.LinesCellTooltipController({el:this.el}),new App.UserCellTooltipController({el:this.el}),new App.ContractsApproveController({el:this.el}),new App.ContractsRejectController({el:this.el,async:!0,callback:this.orderRejected})}return e(i,n),i.prototype.model="Contract",i.prototype.templatePath="manage/views/contracts/line",i.prototype.fetch=function(t,e,n){return this.fetchOrders(t).done(function(t){return function(e){var i,r;return r=function(){var t,n,r;for(r=[],t=0,n=e.length;n>t;t++)i=e[t],r.push(App.Contract.find(i.id));return r}(),t.fetchUsers(r).done(function(){return t.fetchReservations(r).done(function(){return t.fetchPurposes(r).done(function(){return n()})})})}}(this))},i.prototype.fetchOrders=function(t){return App.Contract.ajaxFetch({data:$.param({page:t,search_term:this.searchTerm,status:["approved","submitted","rejected"]})})},i.prototype.fetchUsers=function(t){var e;return e=_.uniq(_.map(t,function(t){return t.user_id})),e.length?App.User.ajaxFetch({data:$.param({ids:e,paginate:!1})}).done(function(t){return function(t){var e,n;return n=function(){var n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(App.User.find(e.id));return r}(),App.User.fetchDelegators(n)}}(this)):{done:function(t){return t()}}},i.prototype.fetchReservations=function(t){var e;return e=_.flatten(_.map(t,function(t){return t.id})),e.length?App.Reservation.ajaxFetch({data:$.param({contract_ids:e})}):{done:function(t){return t()}}},i.prototype.fetchPurposes=function(t){var e;return e=_.compact(_.filter(_.map(_.flatten(_.map(t,function(t){return t.reservations().all()})),function(t){return t.purpose_id}),function(t){return null==App.Purpose.exists(t)})),e.length?App.Purpose.ajaxFetch({data:$.param({purpose_ids:e,paginate:!1})}):{done:function(t){return function(t){return t()}}(this)}},i}(App.SearchResultsController)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;window.App.SearchResultsSoftwareController=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.model="Software",n.prototype.templatePath="manage/views/software/line",n.prototype.type="software",n}(App.SearchResultsModelsController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.SearchResultsUsersController=function(n){function i(){return this.fetchUsers=t(this.fetchUsers,this),this.fetch=t(this.fetch,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.model="User",i.prototype.templatePath="manage/views/users/search_result_line",i.prototype.fetch=function(t,e,n){return this.fetchUsers(t).done(function(t){return function(){return n()}}(this))},i.prototype.fetchUsers=function(t){return App.User.ajaxFetch({data:$.param({search_term:this.searchTerm,page:t})}).done(function(t){return function(t){var e,n;return n=function(){var n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(App.User.find(e.id));return r}(),App.User.fetchDelegators(n)}}(this))},i}(App.SearchResultsController)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;window.App.GroupController=function(e){function n(){n.__super__.constructor.apply(this,arguments),new App.GroupPartitionsController({el:this.el.find("#models-allocations"),removeHandler:this.removePartitionHandler}),new App.ManageUsersViaAutocompleteController({el:this.el.find("#users"),removeHandler:this.removeUserHandler,paramName:"group[users][][id]"})}return t(n,e),n.removeHandler=function(t){return t.preventDefault(),$(t.currentTarget).closest(".line").remove()},n.prototype.removeUserHandler=n.removeHandler,n.prototype.removePartitionHandler=n.removeHandler,n}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.GroupEditController=function(n){function i(){return this.removePartitionHandler=t(this.removePartitionHandler,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.include(App.Modules.InlineEntryHandlers),i.prototype.removeUserHandler=i.prototype.strikeRemoveUserHandler,i.prototype.removePartitionHandler=function(t){var e,n,i;return t.preventDefault(),i=$(t.currentTarget),e=i.closest(".line"),n=e.find("[data-model-name]"),n.hasClass("striked")?(n.removeClass("striked"),e.find("[data-quantities]").removeClass("hidden"),i.text(_jed("Remove")),e.find("[name*='_destroy']").val(null)):(n.addClass("striked"),e.find("[data-quantities]").addClass("hidden"),i.text(_jed("undo")),e.find("[name*='_destroy']").val(1))},i}(App.GroupController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.GroupPartitionsController=function(n){function i(){this.select=t(this.select,this),this.setupAutocomplete=t(this.setupAutocomplete,this),this.fetchModels=t(this.fetchModels,this),this.search=t(this.search,this),i.__super__.constructor.apply(this,arguments),this.input.preChange()}return e(i,n),i.prototype.elements={"input[data-search-models]":"input","[data-models-list]":"modelsList"},i.prototype.events={"preChange input[data-search-models]":"search","click [data-remove-group]":"removeHandler"},i.prototype.search=function(){return this.input.val().length?this.fetchModels().done(function(t){return function(e){var n;return t.setupAutocomplete(function(){var t,i,r;for(r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push(App.Model.find(n.id));return r}())}}(this)):!1},i.prototype.fetchModels=function(){return App.Model.ajaxFetch({data:$.param({search_term:this.input.val(),borrowable:!0,per_page:5})})},i.prototype.setupAutocomplete=function(t){return this.input.autocomplete({source:function(e){return function(e,n){return n(t)}}(this),focus:function(t){return function(){return!1}}(this),select:this.select}).data("uiAutocomplete")._renderItem=function(t){return function(t,e){return $(App.Render("manage/views/groups/partitions/autocomplete_element",e)).data("value",e).appendTo(t)}}(this),this.input.autocomplete("search")},i.prototype.select=function(t,e){return App.Availability.ajaxFetch({url:App.Availability.url()+"/in_stock",data:$.param({model_ids:e.item.id})}).done(function(t){return function(n){var i;return i=t.modelsList.find("input[name='group[partitions_attributes][][model_id]'][value='"+e.item.id+"']").closest(".line"),i.length?t.modelsList.prepend(i):t.modelsList.prepend(App.Render("manage/views/groups/partitions/model_allocation_entry",App.Model.find(e.item.id),{currentInventoryPool:App.InventoryPool.current}))}}(this))},i}(Spine.Controller)}.call(this),function(){window.App.HandOverAutocompleteController=function(){function t(t,e,n){this.props=t,this.container=e,this.opts=n}return t.prototype._render=function(){return this.instance=ReactDOM.render(React.createElement(HandoverAutocomplete,this.props),this.container),window.reactBarcodeScannerTarget=this.instance},t.prototype.setProps=function(t){return _.extend(this.props,t),this._render()},t.prototype.getInstance=function(){return this.instance},t}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.InventoryExpandController=function(n){function i(){return this.renderChildren=t(this.renderChildren,this),this.updateChildren=t(this.updateChildren,this),this.setupChildren=t(this.setupChildren,this),this.fetchPackageModels=t(this.fetchPackageModels,this),this.fetchPackageItems=t(this.fetchPackageItems,this),this.fetchData=t(this.fetchData,this),this.open=t(this.open,this),this.close=t(this.close,this),this.toggle=t(this.toggle,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"click [data-type='inventory-expander']":"toggle"},i.prototype.toggle=function(t){var e;return e=$(t.currentTarget),null!=e.data("_expanded")&&e.data("_expanded")===!0?this.close(e):this.open(e)},i.prototype.close=function(t){var e;return t.data("_expanded",!1),t.find(".arrow").removeClass("down right").addClass("right"),e=t.closest("[data-id]"),e.data("_children").detach()},i.prototype.open=function(t){var e;return t.data("_expanded",!0),t.find(".arrow").removeClass("down right").addClass("down"),e=t.closest("[data-id]"),_.contains(["model","software"],e.data("type"))&&null==e.data("_children")&&this.fetchData(e,this.updateChildren),this.setupChildren(e)},i.prototype.fetchData=function(t,e){var n,i,r,o;return"model"===t.data("type")&&(i=App.Model.find(t.data("id"))),"software"===t.data("type")&&(o=App.Software.find(t.data("id"))),n=_.map((null!=(r=null!=i?i.items():void 0)?r:null!=o?o.licenses():void 0).all(),function(t){return t.id}),this.fetchPackageItems(t,n).done(function(i){return function(r){return i.fetchPackageModels(t,n).done(function(){return e(t)})}}(this))},i.prototype.fetchPackageItems=function(t,e){return t.data("is_package")===!0?App.Item.ajaxFetch({data:$.param({package_ids:e,paginate:!1})}):{done:function(t){return t()}}},i.prototype.fetchPackageModels=function(t,e){var n,i,r,o;return t.data("is_package")===!0?(r=function(){var t,n,r;for(r=[],t=0,n=e.length;n>t;t++)i=e[t],r.push(App.Item.find(i));return r}(),n=_.flatten(_.map(r,function(t){return t.children().all()})),o=_.uniq(_.map(n,function(t){return t.model_id})),App.Model.ajaxFetch({data:$.param({ids:o,paginate:!1,include_package_models:!0})})):{done:function(t){return t()}}},i.prototype.setupChildren=function(t){return null==t.data("_children")&&this.renderChildren(t),t.after(t.data("_children"))},i.prototype.updateChildren=function(t){var e;return e=t.data("_children"),this.renderChildren(t,"additionalDataFetched"),null!=e?e.replaceWith(t.data("_children")):void 0},i.prototype.renderChildren=function(t,e){var n,i,r;return null==e&&(e=!1),r=App[_.string.classify(t.data("type"))].find(t.data("id")),i=function(){switch(t.data("type")){case"model":return r.items().all();case"software":return r.licenses().all();case"item":return r.children().all()}}(),n=$("<div class='group-of-lines'></div>"),n.html($(App.Render("manage/views/inventory/line",i,{additionalDataFetched:e,accessRight:App.AccessRight,currentUserRole:App.User.current.role}))),t.data("_children",n)},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;App.InventoryHelperController=function(n){function i(){this.showOwnerChangeNotification=t(this.showOwnerChangeNotification,this),this.disableFlexibleFields=t(this.disableFlexibleFields,this),this.setupSavedItem=t(this.setupSavedItem,this),this.saveItem=t(this.saveItem,this),this.cancelEdit=t(this.cancelEdit,this),this.editItem=t(this.editItem,this),this.updateItem=t(this.updateItem,this),this.fetchItemWithFlexibleFields=t(this.fetchItemWithFlexibleFields,this),this.fetchItem=t(this.fetchItem,this),this.setupItemEdit=t(this.setupItemEdit,this),this.highlightChangedFields=t(this.highlightChangedFields,this),this.setupAppliedItem=t(this.setupAppliedItem,this),this.prepareRequestData=t(this.prepareRequestData,this),this.applyFields=t(this.applyFields,this),this.addField=t(this.addField,this),this.fetchItems=t(this.fetchItems,this),this.setupItemAutocomplete=t(this.setupItemAutocomplete,this),this.toggleChildren=t(this.toggleChildren,this),this.removeField=t(this.removeField,this),this.selectField=t(this.selectField,this),this.getFields=t(this.getFields,this),this.fetchFields=t(this.fetchFields,this),this.delegateEvents=t(this.delegateEvents,this),i.__super__.constructor.apply(this,arguments),this.fetchFields().done(function(t){return function(){return t.fieldInput.is(":focus")?t.setupFieldAutocomplete():void 0}}(this)),this.setupItemAutocomplete()}return e(i,n),i.prototype.elements={"#field-selection":"fieldSelection","#field-input":"fieldInput","#item-selection":"itemSelection","#flexible-fields":"flexibleFields","#item-section":"itemSection","#item-input":"itemInput","#item-edit":"editButton","#save-edit":"saveButton","#cancel-edit":"cancelButton","#notifications":"notifications","#no-fields-message":"noFieldsMessage","#field-form-left-side":"formLeftSide","#field-form-right-side":"formRightSide"},i.prototype.events={"focus #field-input":"setupFieldAutocomplete","click [data-type='remove-field']":"removeField","change #field-selection [data-type='field']":"toggleChildren","submit #item-selection":"applyFields","click #item-edit":"editItem","click #cancel-edit":"cancelEdit","click #save-edit":"saveItem","change #field-selection input[name='item[owner][id]']":"showOwnerChangeNotification"},i.prototype.delegateEvents=function(){return i.__super__.delegateEvents.apply(this,arguments),this.el.on("submit","form",function(t){return function(t){return t.preventDefault()}}(this))},i.prototype.fetchFields=function(){return App.Field.ajaxFetch({data:$.param({target_type:"item"})})},i.prototype.setupFieldAutocomplete=function(){return this.fieldInput.autocomplete({source:this.getFields,focus:function(t){return function(){return!1}}(this),select:this.selectField,minLength:0}).data("uiAutocomplete")._renderItem=function(t){return function(t,e){return $(App.Render("views/autocomplete/element",e)).data("value",e).appendTo(t)}}(this),this.fieldInput.autocomplete("search")},i.prototype.getFields=function(t,e){var n;return n=_.filter(App.Field.all(),function(e){return function(n){return null!=n.getLabel().match(new RegExp(t.term,"i"))&&!App.Field.isPresent(n,e.fieldSelection)&&null==n.visibility_dependency_field_id&&null==n.values_dependency_field_id&&"attachments"!==n.id}}(this)),e(_.map(_.sortBy(n,function(t){return t.getLabel()}),function(t){return{label:t.getLabel(),value:t.value,field:t}}))},i.prototype.selectField=function(t,e){var n,i,r,o;for(this.addField(e.item.field),this.fieldInput.val("").autocomplete("destroy").blur(),n=_.filter(App.Field.all(),function(t){return t.values_dependency_field_id===e.item.field.id}),r=0,o=n.length;o>r;r++)i=n[r],new App.ValuesDependencyFieldController({el:this.el,renderData:{writeable:!0,removeable:!0,fieldColor:"white"},parentField:e.item.field,childField:i});return!1},i.prototype.removeField=function(t){var e,n,i,r,o,s,a,l,d,p;for(p=$(t.currentTarget).closest("[data-type='field']"),n=App.Field.find(p.data("id")),l=n.children(),i=0,o=l.length;o>i;i++)e=l[i],this.fieldSelection.find("[name='"+e.getFormName()+"']").closest("#"+e.id).remove();for(d=n.childrenWithValueDependency(),r=0,s=d.length;s>r;r++)e=d[r],this.fieldSelection.find("[name='"+e.getFormName()+"']").closest("#"+e.id).remove();return(a=n.parentWithValueDependency())&&this.fieldSelection.find("[name='"+a.getFormName()+"']").closest("#"+a.id).remove(),p.closest("#"+n.id).remove(),this.fieldSelection.find("[data-type='field']").length?void 0:this.noFieldsMessage.removeClass("hidden")},i.prototype.toggleChildren=function(t){var e,n;return e=null!=(n=t.field)?n:$(t.currentTarget).closest("[data-type='field']"),App.Field.toggleChildren(e,this.fieldSelection,{writeable:!0,removeable:!0,fieldColor:"white"})},i.prototype.setupItemAutocomplete=function(){return this.itemInput.autocomplete({source:function(t){return function(e,n){return t.fetchItems(e.term).done(function(t){var e,i;return i=function(){var n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(App.Item.find(e.id));return r}(),n(i)})}}(this),focus:function(t){return function(){return!1}}(this),select:function(t){return function(e,n){return t.itemInput.val(n.item.inventory_code),t.applyFields()}}(this),minLength:0}).data("uiAutocomplete")._renderItem=function(t){return function(t,e){return $(App.Render("manage/views/inventory/helper/item_autocomplete_element",e)).data("value",e).appendTo(t)}}(this)},i.prototype.fetchItems=function(t){return App.Item.ajaxFetch({data:$.param({search_term:t})})},i.prototype.addField=function(t){var e,n;return App.Field.isPresent(t,this.fieldSelection)?!0:(this.fieldSelection.find("[data-type='field']").length||this.noFieldsMessage.addClass("hidden"),e=this.formLeftSide.find("[data-type='field']").length<=this.formRightSide.find("[data-type='field']").length?this.formLeftSide:this.formRightSide,n=$(App.Render("manage/views/items/field",{},{field:t,writeable:!0,removeable:!0,fieldColor:"white"})),e.append(n),this.toggleChildren({field:e.find("[data-type='field']")}))},i.prototype.applyFields=function(){var t,e;return this.resetNotifications(),e=this.itemInput.val(),this.itemInput.val("").blur(),App.Flash.reset(),e.length?App.Field.validate(this.fieldSelection)?(t=this.prepareRequestData(),this.fetchItem(e,function(e){return function(n){return e.updateItem(n,t).fail(function(t,i){return e.fetchItemWithFlexibleFields(n).done(function(t){return e.currentItemData=t,e.setupAppliedItem("error")})}).done(function(t){return e.currentItemData=t,e.setupAppliedItem("success")})}}(this))):App.Flash({type:"error",message:_jed("Please provide all required fields")}):App.Flash({type:"error",message:_jed("Please provide an inventory code")})},i.prototype.prepareRequestData=function(){var t,e,n,i,r;for(r=this.fieldSelection.serializeArray(),i=_.filter(App.Field.all(),function(t){return t.exclude_from_submit}),e=0,n=i.length;n>e;e++)t=i[e],r=_.reject(r,function(e){return e.name===t.getFormName()});return r.concat([{name:"item[skip_serial_number_validation]",value:!0}])},i.prototype.setupAppliedItem=function(t){var e;return e=function(e){return function(){return(e.currentItemData.owner_id===App.InventoryPool.current.id||e.currentItemData.inventory_pool_id===App.InventoryPool.current.id)&&(e.editButton.removeClass("hidden"),e.saveButton.addClass("hidden"),e.cancelButton.addClass("hidden")),e.highlightChangedFields(e.fieldSelection.find(".field"),t),$(document).scrollTop(e.itemSection.offset().top)}}(this),this.setupItemEdit(!1,e)},i.prototype.highlightChangedFields=function(t,e){var n,i,r,o;for(o=[],i=0,r=t.length;r>i;i++)n=t[i],o.push(this.flexibleFields.find(".field[data-id='"+$(n).data("id")+"']").addClass(e));return o},i.prototype.setupItemEdit=function(t,e){var n;return null!=this.flexibleFieldsController&&(n=this.flexibleFields.clone(!1),this.flexibleFields.replaceWith(n),this.flexibleFieldsController.release(),this.flexibleFields=n),this.flexibleFieldsController=new App.ItemFlexibleFieldsController({el:this.flexibleFields,itemData:this.currentItemData,writeable:t,hideable:!0,excludeIds:["attachments"],callback:e,showInitialFlashNotice:!0})},i.prototype.fetchItem=function(t,e){return App.Item.ajaxFetch({data:$.param({inventory_code:t})}).done(function(n){return function(n){return n.length?e(App.Item.find(n[0].id)):App.Flash({type:"error",message:_jed("The Inventory Code %s was not found.",t)})}}(this))},i.prototype.fetchItemWithFlexibleFields=function(t){return App.Item.ajax().find(t.id,{data:$.param({"for":"flexibleFields"})})},i.prototype.updateItem=function(t,e){var n;return e.length?t.updateWithFieldData(e).fail(function(t){return function(e){return t.setNotification(e.responseJSON.message,"error")}}(this)):n={always:function(t){return t()},fail:function(t){return t()},done:function(t){return t()}}},i.prototype.setNotification=function(t,e){return this.notifications.html(App.Render("manage/views/inventory/helper/"+e,{text:t}))},i.prototype.resetNotifications=function(){return this.notifications.html(""),App.Flash.reset()},i.prototype.editItem=function(){return this.editButton.addClass("hidden"),this.saveButton.removeClass("hidden"),this.cancelButton.removeClass("hidden"),this.setupItemEdit(!0),this.resetNotifications(),this.currentItemData.owner_id!==App.InventoryPool.current.id?this.setNotification(_jed("You are not the owner of this item")+" "+_jed("therefore you may not be able to change some of these fields"),"error"):void 0},i.prototype.cancelEdit=function(){return this.editButton.removeClass("hidden"),this.saveButton.addClass("hidden"),this.cancelButton.addClass("hidden"),this.setupItemEdit(!1),this.resetNotifications(),this.resetNotifications()},i.prototype.saveItem=function(){var t;return this.flexibleFieldsController.validate()?(t=App.Item.find(this.currentItemData.id),this.updateItem(t,this.prepareRequestData()).done(function(e){return function(){return e.fetchItemWithFlexibleFields(t).done(function(t){return e.currentItemData=t,e.setupSavedItem()})}}(this)),this.disableFlexibleFields()):void 0},i.prototype.setupSavedItem=function(){return this.setupItemEdit(!1),this.editButton.removeClass("hidden"),this.saveButton.addClass("hidden"),this.cancelButton.addClass("hidden"),this.resetNotifications(),this.setNotification(_jed("%s successfully saved",_jed("Item")),"success")},i.prototype.disableFlexibleFields=function(){return this.flexibleFields.find("input,textarea,select").prop("disabled",!0)},i.prototype.showOwnerChangeNotification=function(){return App.Flash({type:"notice",message:_jed("If you transfer an item to a different inventory pool it's not visible for you anymore.")})},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.InventoryIndexController=function(n){function i(){this.toggleFiltersVisibility=t(this.toggleFiltersVisibility,this),this.closeCategories=t(this.closeCategories,this),this.openCategories=t(this.openCategories,this),this.toggleCategories=t(this.toggleCategories,this),this.render=t(this.render,this),this.getData=t(this.getData,this),this.fetchLicenses=t(this.fetchLicenses,this),this.fetchItems=t(this.fetchItems,this),this.fetchAvailability=t(this.fetchAvailability,this),this.fetchInventory=t(this.fetchInventory,this),this.fetch=t(this.fetch,this),this.updateExportButtons=t(this.updateExportButtons,this),this.reset=t(this.reset,this),i.__super__.constructor.apply(this,arguments),this.pagination=new App.ListPaginationController({el:this.list,fetch:this.fetch}),this.search=new App.ListSearchController({el:this.el.find("#list-search"),reset:this.reset}),this.tabs=new App.ListTabsController({el:this.el.find("#list-tabs"),reset:this.reset}),this.filter=new App.ListFiltersController({el:this.filterElement,reset:this.reset}),this.range=new App.ListRangeController({el:this.filterElement,reset:this.reset}),new App.TimeLineController({el:this.el}),new App.InventoryExpandController({el:this.el}),[this.csvExportButton,this.excelExportButton].map(function(t){return t.data("href",t.attr("href"))}),this.reset()}return e(i,n),i.prototype.elements={"#inventory":"list","#csv-export":"csvExportButton","#excel-export":"excelExportButton","#categories":"categoriesContainer","[data-filter]":"filterElement"},i.prototype.events={"click #categories-toggle":"toggleCategories"},i.prototype.reset=function(){return this.toggleFiltersVisibility(),this.inventory={},_.invoke([App.Item,App.License,App.Model,App.Software,App.Option],function(){return this.deleteAll()}),this.updateExportButtons(),this.list.html(App.Render("manage/views/lists/loading")),this.fetch(1,this.list)},i.prototype.updateExportButtons=function(){var t,e;return t=this.getData(),t.software&&(t.type="license"),(null!=(e=this.search.term())?e.length:void 0)&&(t.search_term=this.search.term()),[this.csvExportButton,this.excelExportButton].map(function(e){return e.attr("href",URI(e.data("href")).query(t).toString())})},i.prototype.fetch=function(t,e){return this.fetchInventory(t).done(function(n){return function(){return n.fetchAvailability(t).done(function(){return n.fetchItems(t).done(function(){return n.fetchLicenses(t).done(function(){return n.render(e,n.inventory[t],t)})})})}}(this))},i.prototype.fetchInventory=function(t){var e,n;return App.Inventory.fetch($.extend(this.getData(),{page:t,search_term:this.search.term(),category_id:null!=(e=this.categoriesFilter)&&null!=(n=e.getCurrent())?n.id:void 0,include_package_models:!0,sort:"name",order:"ASC"})).done(function(e){return function(n,i,r){var o,s,a,l;for(e.pagination.set(JSON.parse(r.getResponseHeader("X-Pagination"))),s=[],a=0,l=n.length;l>a;a++)o=n[a],s.push(new App.Inventory.findOrCreate(o));return e.inventory[t]=s}}(this))},i.prototype.fetchAvailability=function(t){var e,n;return n=_.filter(this.inventory[t],function(t){return _.contains(["Model","Software"],t.constructor.className)}),e=_.map(n,function(t){
return t.id}),e.length?App.Availability.ajaxFetch({url:App.Availability.url()+"/in_stock",data:$.param({model_ids:e})}):{done:function(t){return t()}}},i.prototype.fetchItems=function(t){var e,n;return n=_.filter(this.inventory[t],function(t){return"Model"===t.constructor.className}),e=_.map(n,function(t){return t.id}),e.length?App.Item.ajaxFetch({data:$.param($.extend(this.getData(),{model_ids:e,paginate:!1,search_term:this.search.term(),all:!0}))}):{done:function(t){return t()}}},i.prototype.fetchLicenses=function(t){var e,n;return n=_.filter(this.inventory[t],function(t){return"Software"===t.constructor.className}),e=_.map(n,function(t){return t.id}),e.length?App.License.ajaxFetch({data:$.param($.extend(this.getData(),{model_ids:e,paginate:!1,search_term:this.search.term(),all:!0}))}):{done:function(t){return t()}}},i.prototype.getData=function(){return _.clone($.extend(this.tabs.getData(),this.filter.getData()))},i.prototype.render=function(t,e,n){if(null!=e){if(!e.length)return t.html(App.Render("manage/views/lists/no_results"));if(t.html(App.Render("manage/views/inventory/line",e,{accessRight:App.AccessRight,currentUserRole:App.User.current.role})),1===n)return this.pagination.renderPlaceholders()}},i.prototype.toggleCategories=function(){return null==this.categoriesFilter&&(this.categoriesFilter=new App.CategoriesFilterController({el:this.categoriesContainer,filter:this.reset})),this.categoriesContainer.hasClass("hidden")?this.openCategories():this.closeCategories()},i.prototype.openCategories=function(){return this.list.addClass("col4of5"),this.categoriesContainer.addClass("col1of5").removeClass("hidden")},i.prototype.closeCategories=function(){return this.list.removeClass("col4of5"),this.categoriesContainer.removeClass("col1of5").addClass("hidden")},i.prototype.toggleFiltersVisibility=function(){var t;return"option"===this.tabs.getData().type?this.filterElement.addClass("hidden"):(this.filterElement.removeClass("hidden"),"false"===this.filterElement.find("select[name='used']").val()?this.filterElement.find("select[name!='used'], label.button:has(input[type='checkbox'])").hide():(this.filterElement.find("select[name!='used'], label.button:has(input[type='checkbox'])").show(),t=this.filterElement.find("select[name!='used'], input[type='checkbox']").serializeArray(),_.any(t,function(t){return""!==t.value})?this.filterElement.find("select[name='used']").hide():this.filterElement.find("select[name='used']").show()))},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.InventoryPoolDailyController=function(n){function i(){this.updateNavigationLinks=t(this.updateNavigationLinks,this),this.toggleDatepicker=t(this.toggleDatepicker,this),this.renderWorkload=t(this.renderWorkload,this),this.fetchWorkload=t(this.fetchWorkload,this),this.fetchData=t(this.fetchData,this),i.__super__.constructor.apply(this,arguments),this.visits=[],this.datepickerOpen=!1,this.fetchData()}return e(i,n),i.prototype.events={"click #datepicker":"toggleDatepicker"},i.prototype.elements={"#datepicker-input":"datepickerInput","#daily-navigation":"dailyNavigation","#workload":"workloadContainer"},i.prototype.fetchData=function(){return this.fetchWorkload()},i.prototype.fetchWorkload=function(){return null!=this.workload?!0:App.Workload.ajaxFetch({data:$.param({date:this.date})}).done(function(t){return function(e){return t.workload=new App.Workload(e),t.renderWorkload()}}(this))},i.prototype.renderWorkload=function(){return this.workloadContainer.html(App.Render("manage/views/inventory_pools/daily/workload")),this.workloadContainer.find(".bar-chart").jqBarGraph({data:this.workload.data,colors:["#999999","#cccccc"],gridColors:["#bbbbbb","#dddddd"],width:960,height:300,barSpace:105,animate:!1,interGrids:0})},i.prototype.toggleDatepicker=function(){return null==this.datepicker&&(this.datepicker=this.datepickerInput.datepicker({defaultDate:moment(this.date).toDate(),onSelect:function(t){return function(t,e){var n;return n=URI(window.location.href).removeQuery("date").addQuery("date",moment(t,i18n.date.L).format("YYYY-MM-DD")),window.location=n}}(this)})),this.datepickerOpen=!this.datepickerOpen,this.datepickerOpen?this.datepickerInput.focus():this.datepickerInput.datepicker("hide")},i.prototype.updateNavigationLinks=function(t,e){var n,i,r,o,s,a;for(o=this.dailyNavigation.find("a[href]"),s=[],i=0,r=o.length;r>i;i++)n=o[i],n=$(n),a=URI(n.attr("href")).removeQuery("tab").addQuery("tab",e),s.push(n.attr("href",a));return s},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.InventoryPoolHolidaysController=function(n){function i(){this.removeHoliday=t(this.removeHoliday,this),this.addHoliday=t(this.addHoliday,this),this.setupHolidaysDatepickers=t(this.setupHolidaysDatepickers,this),i.__super__.constructor.apply(this,arguments),this.setupHolidaysDatepickers()}return e(i,n),i.prototype.events={"click [data-add-holiday]":"addHoliday","click [data-remove-holiday]":"removeHoliday"},i.prototype.elements={"[data-holidays-list]":"holidaysList"},i.prototype.setupHolidaysDatepickers=function(){return this.el.find("#holiday-start-date, #holiday-end-date").datepicker()},i.prototype.addHoliday=function(t){var e,n,i,r;return t.preventDefault(),r=moment(this.el.find("#holiday-start-date").val(),i18n.date.L).format("DD.MM.YYYY"),e=moment(this.el.find("#holiday-end-date").val(),i18n.date.L).format("DD.MM.YYYY"),i=this.el.find("#holiday-name").val(),n=_.last(_.sortBy(_.map(this.holidaysList.find(".line"),function(t){return $(t).data("index")}),function(t){return Number(t)})),$("[data-holidays-list]").append(App.Render("manage/views/inventory_pools/admin/holiday_entry",{start_date:r,end_date:e,name:i,i:null!=n?n+1:0}))},i.prototype.removeHoliday=function(t){var e,n;return t.preventDefault(),n=$(t.currentTarget).closest(".line"),e=n.data("index"),n.find("input[name='inventory_pool[holidays_attributes]["+e+"][_destroy]']").length?(n.find(".line-col").removeClass("striked"),n.find("input[name='inventory_pool[holidays_attributes]["+e+"][_destroy]']").remove()):(n.find(".line-col").addClass("striked"),n.prepend("<input type='hidden' name='inventory_pool[holidays_attributes]["+e+"][_destroy]' value='1' />"))},i}(Spine.Controller)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;window.App.CompositeFieldController=function(e){function n(){n.__super__.constructor.apply(this,arguments),"Quantity allocations"===this.data.field.label&&new App.LicenseQuantityPartitionsController({el:this.el,data:this.data})}return t(n,e),n}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.UploadController=function(n){function i(){this.remove=t(this.remove,this),this.showUploading=t(this.showUploading,this),this.upload=t(this.upload,this),this.setupPreviewImage=t(this.setupPreviewImage,this),this.renderFile=t(this.renderFile,this),this.processNewFile=t(this.processNewFile,this),this.add=t(this.add,this),this.click=t(this.click,this),i.__super__.constructor.apply(this,arguments),this.uploadList=[],this.uploadErrors=[],this.el.fileupload({autoUpload:!1})}return e(i,n),i.prototype.elements={".list-of-lines":"list"},i.prototype.events={"click [data-type='select']":"click",fileuploadadd:"add","click [data-type='inline-entry'][data-new] [data-remove]":"remove"},i.prototype.click=function(){return this.el.find("input[type='file']").trigger("click")},i.prototype.add=function(t,e){var n,i,r,o,s;for(this.uploadList.push(e),o=e.files,s=[],i=0,r=o.length;r>i;i++)n=o[i],s.push(this.processNewFile(this.renderFile(n,e),n));return s},i.prototype.processNewFile=function(t,e){},i.prototype.renderFile=function(t,e){var n;return n=$(App.Render(this.templatePath,t)),n.data("uploadData",e),this.list.prepend(n),n},i.prototype.setupPreviewImage=function(t,e){var n;return n=new FileReader,n.onload=function(e){return function(e){return t.find("img").attr("src",e.target.result)}}(this),n.readAsDataURL(e)},i.prototype.upload=function(t){var e,n,i,r,o,s,a;if(!this.uploadList.length)return void t();for(this.showUploading(),this.el.data("blueimpFileupload").options.url=this.url,e=_.after(this.uploadList.length,function(e){return function(){return t()}}(this)),n=function(t){return function(e){return t.uploadErrors.push(e.responseText)}}(this),o=this.uploadList,s=[],i=0,r=o.length;r>i;i++)a=o[i],s.push(a.submit().fail(n).always(e));return s},i.prototype.showUploading=function(){return null!=this.modal?!0:(this.modal=new App.Modal($("<div></div>")),this.modal.undestroyable(),App.Flash({type:"notice",message:_jed("Uploading files - please wait"),loading:!0},9999))},i.prototype.remove=function(t){var e;return e=$(t.currentTarget).closest("[data-type='inline-entry']"),this.uploadList=_.filter(this.uploadList,function(t){return t!==e.data("uploadData")})},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ItemAttachmentsController=function(n){function i(){this.setUrl=t(this.setUrl,this),i.__super__.constructor.apply(this,arguments),this.type="attachment",this.templatePath="manage/views/items/fields/writeable/partials/attachment_inline_entry",new App.InlineEntryRemoveController({el:this.el})}return e(i,n),i.prototype.setUrl=function(t){return this.url=t.url("upload/"+this.type)},i}(App.UploadController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ItemEditController=function(n){function i(){this.removeField=t(this.removeField,this),this.saveAndCopy=t(this.saveAndCopy,this),this.submitCopy=t(this.submitCopy,this),this.submit=t(this.submit,this),this.errorHandler=t(this.errorHandler,this),this.finish=t(this.finish,this),this.done=t(this.done,this),this.prepareRequestData=t(this.prepareRequestData,this),this.save=t(this.save,this),i.__super__.constructor.apply(this,arguments),this.flexibleFieldsController=new App.ItemFlexibleFieldsController({el:this.flexibleFields,itemData:this.itemData,itemType:this.itemType,writeable:!0,hideable:!0,callback:function(t){return function(){return t.attachmentsController=new App.ItemAttachmentsController({el:t.el.find("#attachments")})}}(this)})}return e(i,n),i.prototype.elements={"#flexible-fields":"flexibleFields","#form":"itemForm","input[name='copy']":"copyInput"},i.prototype.events={"click #item-save-and-copy":"submitCopy","click #show-all-fields":"showAllFields","click [data-type='remove-field']":"removeField"},i.prototype.save=function(t){var e,n;return n=null!=(e=(null!=t?t:{}).skipSerialNumberValidation)?e:!1,this.flexibleFieldsController.validate()?$.ajax({url:this.url,data:this.prepareRequestData(n),type:this.method}):(this.hideLoading(),!1)},i.prototype.prepareRequestData=function(t){var e,n,i,r,o;for(null==t&&(t=!1),o=this.itemForm.serializeArray(),r=_.filter(App.Field.all(),function(t){return t.exclude_from_submit}),n=0,i=r.length;i>n;n++)e=r[n],o=_.reject(o,function(t){return t.name===e.getFormName()});return o.concat([{name:"item[skip_serial_number_validation]",value:t}])},i.prototype.done=function(t){return null==this.item&&(this.item=new App.Item({id:t.id})),this.attachmentsController.setUrl(this.item),this.attachmentsController.upload(function(e){return function(){return e.finish(t.redirect_url)}}(this))},i.prototype.finish=function(t){var e;return null==t&&(t=null),this.attachmentsController.uploadErrors.length?this.setupErrorModal(this.item):(e=null!=t?t:App.Inventory.url(),window.location=e+"?flash[success]="+_jed("Item saved"))},i.prototype.errorHandler=function(t){var e;return t.responseJSON.can_bypass_unique_serial_number_validation?(e=confirm(t.responseJSON.message+" "+_jed("Save anyway")+"?"),e?this.submit(t,function(t){return function(){return t.save({skipSerialNumberValidation:!0})}}(this)):this.hideLoading()):(this.showError(t.responseJSON.message),this.hideLoading())},i.prototype.submit=function(t,e,n){return null==e&&(e=this.save),null==n&&(n=this.errorHandler),i.__super__.submit.call(this,t,e,n)},i.prototype.submitCopy=function(t){return this.submit(t,this.saveAndCopy)},i.prototype.saveAndCopy=function(){return this.flexibleFieldsController.validate()?(this.copyInput.prop("disabled",!1),$.ajax({url:this.url,data:this.prepareRequestData(),type:this.method})):this.hideLoading()},i.prototype.showAllFields=function(){return $.ajax({url:"/manage/"+App.InventoryPool.current.id+"/fields",type:"post",data:{_method:"delete"},success:function(t){return function(t){return $(".hidden.field").removeClass("hidden"),$("#show-all-fields").hide()}}(this)})},i.prototype.removeField=function(t){var e;return e=$(t.currentTarget).closest("[data-type='field']"),$.ajax({url:"/manage/"+App.InventoryPool.current.id+"/fields/"+e.data("id"),type:"post",success:function(t){return function(t){var n,i,r,o,s;for(i=App.Field.find(e.data("id")),s=i.children(),r=0,o=s.length;o>r;r++)n=s[r],e.closest("form").find("[name='"+n.getFormName()+"']").closest("[data-type='field']").addClass("hidden");return e.addClass("hidden"),$("#show-all-fields").show()}}(this)})},i}(App.FormWithUploadController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ItemFlexibleFieldsController=function(n){function i(){this.toggleChildren=t(this.toggleChildren,this),this.validate=t(this.validate,this),this.showOwnerChangeNotification=t(this.showOwnerChangeNotification,this),this.setupFieldsWithValuesDependency=t(this.setupFieldsWithValuesDependency,this),this.setupFields=t(this.setupFields,this),this.renderForm=t(this.renderForm,this),this.fetchFields=t(this.fetchFields,this),this.getFieldsWithValuesDependency=t(this.getFieldsWithValuesDependency,this),this.setupInitialFlashNotice=t(this.setupInitialFlashNotice,this),i.__super__.constructor.apply(this,arguments),this.fetchFields().done(function(t){return function(){var e,n,i,r;for(t.renderForm(),t.setupFields(),r=t.el.find("[data-type='field']"),n=0,i=r.length;i>n;n++)e=r[n],t.toggleChildren({currentTarget:e});return $(".hidden.field").length&&$("#show-all-fields").show(),t.getFieldsWithValuesDependency().length>0?t.setupFieldsWithValuesDependency(t.callback):"function"==typeof t.callback?t.callback():void 0}}(this)),this.setupInitialFlashNotice()}return e(i,n),i.prototype.events={"change input[name='item[owner][id]']":"showOwnerChangeNotification",submit:"validate","change [data-type='field']":"toggleChildren"},i.prototype.setupInitialFlashNotice=function(){return this.showInitialFlashNotice&&!this.itemData["unique_serial_number?"]?App.Flash({type:"notice",message:_jed("Same or similar serial number already exists.")}):void 0},i.prototype.getFieldsWithValuesDependency=function(){return _.filter(App.Field.all(),function(t){return t.values_dependency_field_id})},i.prototype.fetchFields=function(){return App.Field.all().length?{done:function(t){return t()}}:App.Field.ajaxFetch({data:$.param({target_type:this.itemType})})},i.prototype.renderForm=function(){return this.el.html(App.Render("manage/views/items/form")),this.formLeftSide=this.el.find("#item-form-left-side"),this.formRightSide=this.el.find("#item-form-right-side")},i.prototype.setupFields=function(){var t,e,n,i,r,o,s,a,l,d;e=_.filter(App.Field.all(),function(t){return function(e){return!_.contains(t.excludeIds,e.id)}}(this)),e=_.filter(e,function(t){return null==t.visibility_dependency_field_id}),this.forPackage&&(e=_.filter(e,function(t){return t.forPackage})),s=App.Field.grouped(e),a=[];for(i in s){for(e=s[i],d=$(App.Render("manage/views/items/group_of_fields",{name:i})),n=d.find(".group-of-fields"),r=0,o=e.length;o>r;r++)t=e[r],n.append(App.Render("manage/views/items/field",{},{field:t,itemData:this.itemData,writeable:this.writeable,hideable:this.hideable}));l=this.formLeftSide.find("[data-type='field']").length<=this.formRightSide.find("[data-type='field']").length?this.formLeftSide:this.formRightSide,a.push(l.append(d))}return a},i.prototype.setupFieldsWithValuesDependency=function(t){var e,n,i,r,o;for(r=this.getFieldsWithValuesDependency(),o=[],n=0,i=r.length;i>n;n++)e=r[n],o.push(new App.ValuesDependencyFieldController({el:this.el,renderData:{itemData:this.itemData,writeable:this.writeable,hideable:this.hideable},parentField:App.Field.find(e.values_dependency_field_id),childField:e,callback:t}));return o},i.prototype.showOwnerChangeNotification=function(){return App.Flash({type:"notice",message:_jed("If you transfer an item to a different inventory pool it's not visible for you anymore.")})},i.prototype.validate=function(t){return App.Field.validate(this.el)?!0:(App.Flash({type:"error",message:_jed("Please provide all required fields")}),null!=t&&t.preventDefault(),!1)},i.prototype.toggleChildren=function(t){return App.Field.toggleChildren($(t.currentTarget),this.el,{itemData:this.itemData,writeable:this.writeable},this.forPackage)},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ItemInspectDialogController=function(n){function i(e){this.submit=t(this.submit,this),this.setupModal=t(this.setupModal,this),this.setupModal(e.item),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"submit form":"submit"},i.prototype.elements={form:"form"},i.prototype.setupModal=function(t){return this.el=$(App.Render("manage/views/items/inspect_dialog",t)),this.modal=new App.Modal(this.el)},i.prototype.submit=function(t){var e,n,i,r,o;for(t.preventDefault(),e={},o=this.form.serializeArray(),i=0,r=o.length;r>i;i++)n=o[i],e[n.name]="true"===n.value||"false"===n.value?JSON.parse(n.value):n.value;return this.item.inspect(e).done(function(t){return function(){return t.modal.destroy(!0)}}(this))},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.LicenseQuantityPartitionsController=function(n){function i(){this.updateRemainingQuantity=t(this.updateRemainingQuantity,this),this.getRemainingQuantity=t(this.getRemainingQuantity,this),this.render=t(this.render,this),this.add=t(this.add,this),this.registerEventHandlers=t(this.registerEventHandlers,this),i.__super__.constructor.apply(this,arguments),this.el.append("<div class='row list-of-lines even'></div>"),this.list=this.el.find(".list-of-lines"),this.dataSourceElement=$(".field[data-id='"+this.data.field.data_dependency_field_id+"'] [data-type='value'] input").preChange(),this.dataSourceElement.on("preChange",this.updateRemainingQuantity),this.allocations=this.data.itemData.properties.quantity_allocations,this.render(this.allocations),this.allocationElements=this.el.find("[data-quantity-allocation]").preChange(),this.updateRemainingQuantity(),new App.InlineEntryRemoveController({el:this.list,removeCallback:function(t){return function(e){return t.allocationElements=_.reject(_.map(t.allocationElements,$),function(t){return t.get(0)===e.find("[data-quantity-allocation]").get(0)}),t.updateRemainingQuantity()}}(this),strikeCallback:function(t){return this.removeCallback(t)},unstrikeCallback:function(t){return function(e){return t.allocationElements.push(e.find("[data-quantity-allocation]")),t.updateRemainingQuantity()}}(this)})}return e(i,n),i.prototype.events={"click #add-inline-entry":"add","preChange [data-quantity-allocation]":"updateRemainingQuantity"},i.prototype.elements={"#remaining-total-quantity":"remainingQuantityElement"},i.prototype.registerEventHandlers=function(){},i.prototype.add=function(t){var e;return t.preventDefault(),e=$(App.Render("manage/views/items/fields/writeable/composite_partials/license_quantity_allocation",{field:this.data.field})),this.list.prepend(e),e.data("new",!0),this.allocationElements.push(e.find("[data-quantity-allocation]").preChange())},i.prototype.render=function(t){var e,n,i,r;if(t){for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(this.list.append(App.Render("manage/views/items/fields/writeable/composite_partials/license_quantity_allocation",{field:this.data.field,allocation:e})));return r}},i.prototype.getRemainingQuantity=function(){var t;return t=parseInt(this.dataSourceElement.val()),(_.isNaN(t)?0:t)-_.reduce(_.map(this.allocationElements,function(t){var e;return e=parseInt($(t).val()),_.isNaN(e)?0:e}),function(t,e){return t+e},0)},i.prototype.updateRemainingQuantity=function(){return this.remainingQuantityElement.text(_jed("remaining")+" "+this.getRemainingQuantity())},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ValuesDependencyFieldController=function(n){function i(){this.transformResponseData=t(this.transformResponseData,this),this.updateChildValues=t(this.updateChildValues,this),this.renderChildElement=t(this.renderChildElement,this),this.removeChildElement=t(this.removeChildElement,this),this.rerenderChildElement=t(this.rerenderChildElement,this),i.__super__.constructor.apply(this,arguments),this.parentElement=this.el.find("#"+this.parentField.id),this.renderData.itemData||(this.renderData.itemData={}),this.rerenderChildElement(),this.parentElement.change(function(t){return function(){return t.renderData.itemData[t.childField.id]=null,t.rerenderChildElement()}}(this))}return e(i,n),i.prototype.rerenderChildElement=function(){return this.removeChildElement(),this.renderChildElement()},i.prototype.removeChildElement=function(){return this.el.find("#"+this.childField.id).remove()},i.prototype.renderChildElement=function(){return this.updateChildValues({callback:function(t){return function(){return t.parentElement.after(App.Render("manage/views/items/field",{},$.extend(t.renderData,{field:t.childField})))}}(this)})},i.prototype.updateChildValues=function(t){var e,n,i;return e=t.callback,n=App.Field.getValue(this.parentElement.find(".field[data-id]")),n?(i=this.childField.values_url.replace("$$$parent_value$$$",n),$.ajax({url:i,success:function(t){return function(n){return t.childField.values=t.transformResponseData(n),e(),"function"==typeof t.callback?t.callback():void 0}}(this)})):void 0},i.prototype.transformResponseData=function(t){return _.map(t,function(t){return function(e){return{value:e.id,label:e[t.childField.values_label_method]}}}(this))},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ModelCellTooltipController=function(n){function i(){return this.onEnter=t(this.onEnter,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"mouseenter [data-type='model-cell']":"onEnter"},i.prototype.onEnter=function(t){var e;return e=$(t.currentTarget),new App.Tooltip({el:e.closest("[data-type='model-cell']"),content:App.Render("manage/views/models/tooltip",App.Model.findOrBuild(e.data()))})},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ModelsAccessoriesController=function(n){function i(){return this.add=t(this.add,this),this.enter=t(this.enter,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"click #add-accessory":"add","keypress #accessory-name":"enter"},i.prototype.elements={"input#accessory-name":"input",".list-of-lines":"list"},i.prototype.enter=function(t){return t.keyCode===$.ui.keyCode.ENTER?(t.preventDefault(),this.add({preventDefault:function(){return null}})):void 0},i.prototype.add=function(t){var e;return t.preventDefault(),e=this.input.val(),this.list.find("[data-name='"+e+"']").length||this.list.prepend(App.Render("manage/views/models/form/accessory_inline_entry",{name:e},{uid:App.Model.uid("uid")})),this.input.val("").blur()},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ModelsAllocationsController=function(n){function i(){this.getExistingEntry=t(this.getExistingEntry,this),i.__super__.constructor.apply(this,arguments),this.model="Group",this.templatePath="manage/views/models/form/allocation_inline_entry"}return e(i,n),i.prototype.getExistingEntry=function(t){return this.list.find("input[name*='[group_id]'][value='"+t.id+"']")},i}(App.AddInlineEntryController)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;window.App.ModelsAttachmentsController=function(e){function n(){n.__super__.constructor.apply(this,arguments),this.type="attachment",this.templatePath="manage/views/models/form/attachment_inline_entry",this.url=this.model.url("upload/"+this.type)}return t(n,e),n}(App.UploadController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ModelsCategoriesController=function(n){function i(){this.getExistingEntry=t(this.getExistingEntry,this),i.__super__.constructor.apply(this,arguments),this.model="Category",this.templatePath="manage/views/models/form/category_inline_entry"}return e(i,n),i.prototype.getExistingEntry=function(t){return this.list.find("input[name='model[category_ids][]'][value='"+t.id+"']")},i}(App.AddInlineEntryController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ModelsCompatiblesController=function(n){function i(){this.getExistingEntry=t(this.getExistingEntry,this),i.__super__.constructor.apply(this,arguments),this.model="Model",this.templatePath="manage/views/models/form/compatible_inline_entry"}return e(i,n),i.prototype.getExistingEntry=function(t){return this.list.find("input[name*='[compatible_ids]'][value='"+t.id+"']")},i}(App.AddInlineEntryController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ModelsEditController=function(n){function i(){this.collectErrorMessages=t(this.collectErrorMessages,this),this.save=t(this.save,this),this.finish=t(this.finish,this),this.done=t(this.done,this),this.setupManufacturer=t(this.setupManufacturer,this),i.__super__.constructor.apply(this,arguments),new App.ModelsAllocationsController({el:this.el.find("#allocations")}),new App.ModelsCategoriesController({el:this.el.find("#categories")}),new App.ModelsAccessoriesController({el:this.el.find("#accessories")}),new App.ModelsCompatiblesController({el:this.el.find("#compatibles"),customLabelFn:function(t){var e;return e=t.product,t.version&&(e=[e,t.version].join(" ")),e}}),new App.ModelsPropertiesController({el:this.el.find("#properties")}),this.el.find("#packages").length&&new App.ModelsPackagesController({el:this.el.find("#packages")}),this.imagesController=new App.ImagesController({el:this.el.find("#images"),url:this.model.url("upload/image")}),this.attachmentsController=new App.ModelsAttachmentsController({el:this.el.find("#attachments"),model:this.model}),new App.InlineEntryRemoveController({el:this.el}),this.setupManufacturer()}return e(i,n),i.prototype.elements={"input[name='model[manufacturer]']":"manufacturer"},i.prototype.setupManufacturer=function(){return this.manufacturer.autocomplete({source:this.manufacturers,minLength:0,delay:0}).data("uiAutocomplete")._renderItem=function(t){return function(t,e){return $(App.Render("views/autocomplete/element",e)).data("value",e).appendTo(t)}}(this),this.manufacturer.focus(function(){return $(this).autocomplete("search")})},i.prototype.done=function(){return this.imagesController.upload(function(t){return function(){return t.attachmentsController.upload(function(){return t.finish()})}}(this))},i.prototype.finish=function(){return this.imagesController.uploadErrors.length||this.attachmentsController.uploadErrors.length?this.setupErrorModal(this.model):window.location=App.Inventory.url()+("?flash[success]="+_jed("Model saved"))},i.prototype.save=function(){return $.ajax({url:this.model.url(),data:this.form.serializeArray(),type:"PUT"})},i.prototype.collectErrorMessages=function(){return this.imagesController.uploadErrors.concat(this.attachmentsController.uploadErrors).join(", ")},i}(App.FormWithUploadController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ModelsNewController=function(n){function i(){return this.updateUploadURL=t(this.updateUploadURL,this),this.save=t(this.save,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.save=function(){return $.post(App.Model.url(),this.form.serializeArray()).done(function(t){return function(e){return t.model.id=e.id,t.updateUploadURL()}}(this))},i.prototype.updateUploadURL=function(){return this.imagesController.url=this.model.url("upload/image")},i}(App.ModelsEditController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ModelsPackageDialogController=function(n){function i(){this.save=t(this.save,this),this.prepareRequestData=t(this.prepareRequestData,this),this.removeItem=t(this.removeItem,this),this.addItem=t(this.addItem,this),this.select=t(this.select,this),this.fetchModels=t(this.fetchModels,this),this.fetchItems=t(this.fetchItems,this),this.setupAutocomplete=t(this.setupAutocomplete,this),this.setupFlexibleFields=t(this.setupFlexibleFields,this),this.el=$(App.Render("manage/views/models/packages/package_dialog")),i.__super__.constructor.apply(this,arguments),this.searchItemInput.preChange(),this.childrenContainer.html(App.Render("manage/views/models/packages/item",this.children)),
this.modal=new App.Modal(this.el),new App.InlineEntryRemoveController({el:this.el}),this.setupFlexibleFields()}return e(i,n),i.prototype.elements={"#notifications":"notifications","#item-form":"itemForm","#search-item":"searchItemInput","#items":"childrenContainer"},i.prototype.events={"focus #search-item":"setupAutocomplete","inline-entry-remove [data-type='inline-entry']":"removeItem","click #save-package":"save"},i.prototype.setupFlexibleFields=function(){return this.flexibleFieldsController=new App.ItemFlexibleFieldsController({el:this.itemForm.find("#flexible-fields"),itemData:this.item,itemType:"item",forPackage:!0,writeable:!0,hideable:!1})},i.prototype.setupAutocomplete=function(t){var e;return e=$(t.currentTarget),e.autocomplete({source:function(t){return function(n,i){return i([]),t.fetchItems(n.term).done(function(n){var r,o;return o=function(){var t,e,i;for(i=[],t=0,e=n.length;e>t;t++)r=n[t],i.push(App.Item.find(r.id));return i}(),t.fetchModels(o).done(function(){return e.is(":focus")?i(o):void 0})})}}(this),focus:function(t){return function(){return!1}}(this),select:function(t){return function(n,i){return t.select(n,i)&&e.val("")&&e.blur()}}(this),appendTo:this.modal.el,minLength:1}).data("uiAutocomplete")._renderItem=function(t){return function(t,e){return $(App.Render("manage/views/models/packages/item_autocomplete_element",e)).data("value",e).appendTo(t)}}(this),e.autocomplete("search")},i.prototype.fetchItems=function(t){return App.Item.ajaxFetch({data:$.param({search_term:t,not_packaged:!0,packages:!1,retired:!1})})},i.prototype.fetchModels=function(t){var e;return e=_.uniq(_.map(t,function(t){return t.model_id})),e.length?App.Model.ajaxFetch({data:$.param({ids:e,paginate:!1})}):{done:function(t){return t()}}},i.prototype.select=function(t,e){return this.addItem(e.item)},i.prototype.addItem=function(t){return _.find(this.children,function(e){return e.id===t.id})?!0:(this.children.push(t),this.modal.el.find("#items").append(App.Render("manage/views/models/packages/item",t)))},i.prototype.removeItem=function(t){var e;return e=$(t.currentTarget).closest("[data-type='inline-entry']"),this.children=_.filter(this.children,function(t){return t.id!==e.data("id")})},i.prototype.prepareRequestData=function(){var t,e,n,i,r;for(r=this.itemForm.serializeArray(),i=_.filter(App.Field.all(),function(t){return t.exclude_from_submit}),e=0,n=i.length;n>e;e++)t=i[e],r=_.reject(r,function(e){return e.name===t.getFormName()});return _.map(r,function(t){return{name:t.name.replace(/item/,""),value:t.value}})},i.prototype.save=function(){return this.notifications.addClass("hidden").html(""),this.children.length?App.Field.validate(this.itemForm)?(this.modal.destroy(!0),this.done(this.prepareRequestData(),this.children,this.entry)):this.notifications.removeClass("hidden").html(App.Render("manage/views/models/packages/missing_data_error")):this.notifications.removeClass("hidden").html(App.Render("manage/views/models/packages/no_items_error"))},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ModelsPackagesController=function(n){function i(){this.editNewPackage=t(this.editNewPackage,this),this.saveExistingPackage=t(this.saveExistingPackage,this),this.fetchChildren=t(this.fetchChildren,this),this.fetchItem=t(this.fetchItem,this),this.fetchModels=t(this.fetchModels,this),this.getRemoteItemData=t(this.getRemoteItemData,this),this.editExistingPackage=t(this.editExistingPackage,this),this.editPackage=t(this.editPackage,this),this.saveNotExistingPackage=t(this.saveNotExistingPackage,this),this.createPackage=t(this.createPackage,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"click #add-package":"createPackage","click [data-edit-package]":"editPackage"},i.prototype.elements={".list-of-lines":"list","#add-package":"addPackageButton"},i.prototype.createPackage=function(){return new App.ModelsPackageDialogController({item:new App.Item($(this.addPackageButton).data()),done:this.saveNotExistingPackage,children:[]})},i.prototype.saveNotExistingPackage=function(t,e,n){return null!=n&&n.remove(),this.list.prepend(App.Render("manage/views/models/form/package_inline_entry",{children:e,data:t},{uid:App.Model.uid("uid")}))},i.prototype.editPackage=function(t){var e,n;return n=$(t.currentTarget),e=n.closest("[data-type='inline-entry']"),null!=e.data("id")?this.editExistingPackage(e):this.editNewPackage(e)},i.prototype.editExistingPackage=function(t){var e;return e=new App.Modal("<div>"),e.undestroyable(),this.getRemoteItemData(t,function(n){return function(i,r){return e.destroyable().destroy(),new App.ModelsPackageDialogController({item:i,children:r,done:n.saveExistingPackage,entry:t})}}(this))},i.prototype.getRemoteItemData=function(t,e){var n;return n=t.data("id"),this.fetchItem(n).done(function(t){return function(i){return t.fetchChildren(n).done(function(n){var r,o;return r=function(){var t,e,i;for(i=[],t=0,e=n.length;e>t;t++)o=n[t],i.push(App.Item.find(o.id));return i}(),t.fetchModels(r).done(function(){return e(i,r)})})}}(this))},i.prototype.fetchModels=function(t){var e,n;return e=function(){var e,i,r;for(r=[],e=0,i=t.length;i>e;e++)n=t[e],r.push(n.model_id);return r}(),e.length?App.Model.ajaxFetch({data:$.param({ids:e,paginate:!1,include_package_models:!0})}):{done:function(t){return t()}}},i.prototype.fetchItem=function(t){return $.get(App.Item.url()+("/"+t),{"for":"flexibleFields"})},i.prototype.fetchChildren=function(t){return App.Item.ajaxFetch({data:$.param({package_ids:[t],paginate:!1})})},i.prototype.saveExistingPackage=function(t,e,n){return this.list.prepend(n),n.find("[data-type='updated-text']").removeClass("hidden"),n.find("[data-type='form-data']").html(function(){return App.Render("manage/views/models/form/package_inline_entry/updated_package_form_data",{children:e,data:t},{uid:n.data("id")})})},i.prototype.editNewPackage=function(t){var e;return e=App.ElementFormDataAsObject(t),new App.ModelsPackageDialogController({item:e,done:this.saveNotExistingPackage,children:_.map(e.children,function(t){return App.Item.find(t.id)}),entry:t})},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ModelsPropertiesController=function(n){function i(){this.add=t(this.add,this),i.__super__.constructor.apply(this,arguments),this.list.sortable({handle:"[data-type='sort-handle']"})}return e(i,n),i.prototype.events={"click #add-property":"add"},i.prototype.elements={".list-of-lines":"list"},i.prototype.add=function(t){return t.preventDefault(),this.list.prepend(App.Render("manage/views/models/form/property_inline_entry",{},{uid:App.Model.uid("uid")})),this.list.find("input[type='text']:first").focus()},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ManageBookingCalendarDialogController=function(n){function i(){return this.store=t(this.store,this),this.valid=t(this.valid,this),this.validationAlerts=t(this.validationAlerts,this),this.getSelectedInventoryPool=t(this.getSelectedInventoryPool,this),this.calendarRendered=t(this.calendarRendered,this),this.setupBookingCalendar=t(this.setupBookingCalendar,this),this.setupPartitions=t(this.setupPartitions,this),this.initalizeDialog=t(this.initalizeDialog,this),this.fetchGroups=t(this.fetchGroups,this),this.fetchPartitions=t(this.fetchPartitions,this),this.fetchAvailability=t(this.fetchAvailability,this),this.fetchData=t(this.fetchData,this),this.setupDates=t(this.setupDates,this),this.setupModal=t(this.setupModal,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.setupModal=function(){return this.dialog=$(App.Render("manage/views/booking_calendar/calendar_dialog",{user:this.user},{startDateDisabled:this.startDateDisabled,quantityDisabled:this.quantityDisabled})),this.listOfLines=this.dialog.find("#booking-calendar-lines .list-of-lines"),this.partitionsEl=this.dialog.find("#booking-calendar-partitions"),i.__super__.setupModal.apply(this,arguments)},i.prototype.setupDates=function(){return this.startDateEl.val(_.min(this.reservations,function(t){return Date.parse(t.start_date)}).start_date),this.endDateEl.val(_.max(this.reservations,function(t){return Date.parse(t.end_date)}).end_date)},i.prototype.fetchData=function(){return this.fetchWorkdays().done(function(t){return function(){return t.initalizeDialog()}}(this)),this.fetchHolidays().done(function(t){return function(){return t.initalizeDialog()}}(this)),this.fetchPartitions().done(function(t){return function(){return t.fetchGroups().done(function(){return t.initalizeDialog()})}}(this)),_.any(this.models,function(t){return null==("function"==typeof t.availability?t.availability():void 0)})?this.fetchAvailability().done(function(t){return function(){return t.initalizeDialog()}}(this)):this.availabilities=!0},i.prototype.fetchAvailability=function(){return App.Availability.ajaxFetch({data:$.param({model_ids:_.map(this.models,function(t){return t.id}),user_id:this.user.id})}).done(function(t){return function(){return t.availabilities=!0}}(this))},i.prototype.fetchPartitions=function(){return App.Partition.ajaxFetch({data:$.param({model_ids:_.map(this.models,function(t){return t.id})})}).done(function(t){return function(e){var n;return t.partitions=function(){var t,i,r;for(r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push(App.Partition.find(""+n.model_id+n.inventory_pool_id+n.group_id));return r}()}}(this))},i.prototype.fetchGroups=function(){return App.Group.ajaxFetch({data:$.param({group_ids:_.compact(_.uniq(_.map(this.partitions,function(t){return t.group_id})))})}).done(function(t){return function(e){var n;return t.groups=function(){var t,i,r;for(r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push(App.Group.find(n.id));return r}(),t.setupPartitions()}}(this))},i.prototype.initalizeDialog=function(){return this.workdays&&this.holidays&&this.availabilities&&this.partitions&&this.groups?i.__super__.initalizeDialog.apply(this,arguments):!1},i.prototype.setupPartitions=function(){var t,e,n,i,r;for(t={user:[],userGroups:[],otherGroups:[]},t.user=this.user.groupIds,r=this.partitions,e=0,n=r.length;n>e;e++)i=r[e],null!=i.group_id&&(_.include(this.user.groupIds,i.group_id)?t.userGroups.push(i.group()):t.otherGroups.push(i.group()));return this.partitionsEl.html(App.Render("manage/views/booking_calendar/partitions",t))},i.prototype.setupBookingCalendar=function(){return new App.ManageBookingCalendar({calendarEl:this.dialog.find("#booking-calendar"),startDateEl:this.startDateEl,startDateDisabled:this.startDateDisabled,endDateEl:this.endDateEl,quantityEl:this.dialog.find("#booking-calendar-quantity"),groupIds:this.user.groupIds,partitions:this.partitions,reservations:this.reservations,models:this.models,renderFunctionCallback:this.calendarRendered})},i.prototype.calendarRendered=function(){var t;return t={groupIds:this.user.groupIds,start_date:moment(this.startDateEl.val(),i18n.date.L),end_date:moment(this.endDateEl.val(),i18n.date.L),quantity:this.getQuantity()},this.listOfLines.html(App.Render("manage/views/booking_calendar/line",this.mergedLines,t))},i.prototype.getSelectedInventoryPool=function(){return App.InventoryPool.current},i.prototype.validationAlerts=function(){var t,e;return e=this.getSelectedInventoryPool(),t=[],e.isVisitPossible(this.getStartDate())||t.push(_jed("Booking is no longer possible on this start date")),e.isVisitPossible(this.getEndDate())||t.push(_jed("Booking is no longer possible on this end date")),e.isClosedOn(this.getStartDate())&&t.push(_jed("Inventory pool is closed on start date")),e.isClosedOn(this.getEndDate())&&t.push(_jed("Inventory pool is closed on end date")),t.length?this.showError(t.join(", ")):this.errorsContainer.html("")},i.prototype.valid=function(){return!0},i.prototype.store=function(){},i}(App.BookingCalendarDialogController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ReservationsAddController=function(n){function i(e){this.onSubmitInventoryCode=e,this.showExplorativeSearch=t(this.showExplorativeSearch,this),this.addTemplate=t(this.addTemplate,this),this.addOption=t(this.addOption,this),this.addModel=t(this.addModel,this),this.add=t(this.add,this),this.addInventoryItem=t(this.addInventoryItem,this),this.submit=t(this.submit,this),this.getInputValue=t(this.getInputValue,this),this.fetchAvailabilities=t(this.fetchAvailabilities,this),this.searchTemplates=t(this.searchTemplates,this),this.searchOptions=t(this.searchOptions,this),this.searchModels=t(this.searchModels,this),this.pushOptionsTo=t(this.pushOptionsTo,this),this.pushTemplatesTo=t(this.pushTemplatesTo,this),this.pushModelsTo=t(this.pushModelsTo,this),this.getEndDate=t(this.getEndDate,this),this.getStartDate=t(this.getStartDate,this),this.setupDatepickers=t(this.setupDatepickers,this),this.select=t(this.select,this),this.search=t(this.search,this),this.setupAutocomplete=t(this.setupAutocomplete,this),this.handleEvents=t(this.handleEvents,this),i.__super__.constructor.apply(this,arguments),this.preventSubmit=!1,this.setupDatepickers()}return e(i,n),i.prototype.elements={"#add-start-date":"addStartDate","#add-end-date":"addEndDate"},i.prototype.events={"click [type='submit']":"handleEvents",submit:"handleEvents"},i.prototype.handleEvents=function(t){var e,n;return null!=t&&t.preventDefault(),e=document.querySelector(":focus"),n=this.getInputValue(),0!==n.length?this.submit(t):e&&"BUTTON"!==e.nodeName?"INPUT"===e.nodeName?this.submit(t):void 0:this.showExplorativeSearch(t)},i.prototype.setupAutocomplete=function(t){return this.autocompleteController=t},i.prototype.search=function(t,e){var n;return t.length?(this.models=this.options=this.templates=this.availabilities=this.options=null,n=function(t){return function(){var n;return null==t.models||null==t.templates||null==t.availabilities||(t.optionsEnabled?null==t.options:0)?void 0:(n=[],t.pushModelsTo(n),t.optionsEnabled&&t.pushOptionsTo(n),t.pushTemplatesTo(n),e(n))}}(this),this.searchModels(t,n),this.searchTemplates(t,n),this.optionsEnabled?this.searchOptions(t,n):void 0):!1},i.prototype.select=function(t){return this.add(t.record,this.getStartDate(),this.getEndDate()),this.autocompleteController._render()},i.prototype.setupDatepickers=function(){var t,e,n,i;for(i=[this.addStartDate,this.addEndDate],e=0,n=i.length;n>e;e++)t=i[e],$(t).datepicker();return this.addStartDate.datepicker("option","minDate",moment().startOf("day").toDate()),this.addEndDate.datepicker("option","minDate",{getTime:function(t){return function(){return moment(t.addStartDate.val(),i18n.date.L).startOf("day").toDate()}}(this)}),this.addStartDate.datepicker("option","onSelect",function(t){return function(e){var n;return e=moment(e,i18n.date.L).startOf("day"),n=moment(t.addEndDate.val(),i18n.date.L).startOf("day"),e.toDate()>n.toDate()?t.addEndDate.val(e.format(i18n.date.L)):void 0}}(this))},i.prototype.getStartDate=function(){return moment(this.addStartDate.val(),i18n.date.L)},i.prototype.getEndDate=function(){return moment(this.addEndDate.val(),i18n.date.L)},i.prototype.pushModelsTo=function(t){var e,n,i,r,o,s,a;for(s=this.models,a=[],e=0,n=s.length;n>e;e++)o=s[e],null!=o.availability()?(i=o.availability().maxAvailableForGroups(this.getStartDate(),this.getEndDate(),this.user.groupIds),r=o.availability().maxAvailableInTotal(this.getStartDate(),this.getEndDate()),a.push(t.push({name:o.name(),availability:i+"("+r+")/"+o.availability().total_rentable,available:i>0,type:_jed("Model"),record:o}))):a.push(void 0);return a},i.prototype.pushTemplatesTo=function(t){var e,n,i,r,o;for(i=this.templates,r=[],e=0,n=i.length;n>e;e++)o=i[e],r.push(t.push({name:o.name,available:!0,type:_jed("Template"),record:o}));return r},i.prototype.pushOptionsTo=function(t){var e,n,i,r,o;for(r=this.options,o=[],e=0,n=r.length;n>e;e++)i=r[e],o.push(t.push({name:i.name(),available:!0,type:_jed("Option"),record:i}));return o},i.prototype.searchModels=function(t,e){return App.Model.ajaxFetch({data:$.param({search_term:t,used:!0,as_responsible_only:!0,per_page:this.modelsPerPage||5})}).done(function(t){return function(n){var i;return t.models=function(){var t,e,r;for(r=[],t=0,e=n.length;e>t;t++)i=n[t],r.push(App.Model.find(i.id));return r}(),t.fetchAvailabilities(function(){return e()})}}(this))},i.prototype.searchOptions=function(t,e){return App.Option.ajaxFetch({data:$.param({search_term:t,per_page:this.optionsPerPage||5})}).done(function(t){return function(n){var i;return t.options=function(){var t,e,r;for(r=[],t=0,e=n.length;e>t;t++)i=n[t],r.push(App.Option.find(i.id));return r}(),e()}}(this))},i.prototype.searchTemplates=function(t,e){return App.Template.ajaxFetch({data:$.param({search_term:t,per_page:this.templatesPerPage||5})}).done(function(t){return function(n){var i;return t.templates=function(){var t,e,r;for(r=[],t=0,e=n.length;e>t;t++)i=n[t],r.push(App.Template.find(i.id));return r}(),e()}}(this))},i.prototype.fetchAvailabilities=function(t){return null!=this.models&&this.models.length?App.Availability.ajaxFetch({data:$.param({model_ids:_.map(this.models,function(t){return t.id}),user_id:this.user.id})}).done(function(e){return function(n){var i;return e.availabilities=function(){var t,e,r;for(r=[],t=0,e=n.length;e>t;t++)i=n[t],r.push(App.Availability.find(i.id));return r}(),t()}}(this)):(this.availabilities=[],t())},i.prototype.getInputValue=function(){return this.autocompleteController.getInstance().state.value},i.prototype.submit=function(t){var e;return this.preventSubmit?!1:(e=this.getInputValue(),e.length&&App.Inventory.findByInventoryCode(e).done(function(t){return function(n){return t.addInventoryItem(n,e)}}(this)),this.autocompleteController.getInstance().resetInput())},i.prototype.addInventoryItem=function(t,e){var n;return null!=t?null==t.error?null!=t.model_id?App.Model.ajaxFetch({id:t.model_id}).done(function(t){return function(n){return t.add(App.Model.find(n.id),t.getStartDate(),t.getEndDate(),e)}}(this)):(n=App.Option.addRecord(new App.Option(t)),this.add(n,this.getStartDate(),this.getEndDate())):App.Flash({type:"error",message:t.error}):App.Flash({type:"error",message:_jed("The Inventory Code %s was not found.",e)})},i.prototype.add=function(t,e,n,i){return t instanceof App.Model?this.addModel(t,e,n,i):t instanceof App.Option?this.addOption(t,e,n):t instanceof App.Template?this.addTemplate(t,e,n):void 0},i.prototype.addModel=function(t,e,n,i){var r;return this.addModelForHandOver&&i?"function"==typeof this.onSubmitInventoryCode?this.onSubmitInventoryCode(i):void 0:App.Reservation.createOne({inventory_pool_id:App.InventoryPool.current.id,start_date:moment(e).format("YYYY-MM-DD"),end_date:moment(n).format("YYYY-MM-DD"),contract_id:this.contract.id,purpose_id:null!=(r=this.purpose)?r.id:void 0,quantity:1,model_id:t.id}).done(function(e){return function(n){return App.LineSelectionController.add(n.id),"function"==typeof e.onSubmitInventoryCode&&e.onSubmitInventoryCode(i),App.Flash({type:"notice",message:_jed("Added %s",t.name())})}}(this)).fail(function(t){return App.Flash({type:"error",message:t.responseText})})},i.prototype.addOption=function(t,e,n){var i,r,o;return i=_.find(this.contract.reservations().all(),function(i){return i.option_id===t.id&&0===moment(i.start_date).diff(e,"days")&&0===moment(i.end_date).diff(n,"days")}),i?(r=i.quantity+1,i.updateAttributes({quantity:r}),App.Flash({type:"notice",message:_jed("%s quantity increased to %s",[t.name(),r])}),App.LineSelectionController.add(i.id)):App.Reservation.create({inventory_pool_id:App.InventoryPool.current.id,start_date:moment(e).format("YYYY-MM-DD"),end_date:moment(n).format("YYYY-MM-DD"),contract_id:this.contract.id,purpose_id:null!=(o=this.purpose)?o.id:void 0,quantity:1,option_id:t.id},{done:function(){return App.LineSelectionController.add(this.id),App.Flash({type:"notice",message:_jed("Added %s",t.name())})}})},i.prototype.addTemplate=function(t,e,n){var i;return App.Reservation.createForTemplate({inventory_pool_id:App.InventoryPool.current.id,start_date:moment(e).format("YYYY-MM-DD"),end_date:moment(n).format("YYYY-MM-DD"),contract_id:this.contract.id,purpose_id:null!=(i=this.purpose)?i.id:void 0,template_id:t.id}).done(function(e){return function(e){var n,i,r;for(n=0,i=e.length;i>n;n++)r=e[n],App.LineSelectionController.add(r.id);return App.Flash({type:"notice",message:_jed("Added %s",t.name)})}}(this))},i.prototype.showExplorativeSearch=function(t){return new App.ReservationsExplorativeAddController({contract:this.contract,startDate:this.getStartDate(),endDate:this.getEndDate(),addModel:this.addModel})},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ReservationAssignItemController=function(n){function i(){this.submitAssignment=t(this.submitAssignment,this),this.removeAssignment=t(this.removeAssignment,this),this.assignItem=t(this.assignItem,this),this.fetchWithIds=t(this.fetchWithIds,this),this.fetchItemsOrLicences=t(this.fetchItemsOrLicences,this),this.searchItems=t(this.searchItems,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"focus [data-assign-item]":"searchItems","submit [data-assign-item-form]":"submitAssignment","click [data-remove-assignment]":"removeAssignment"},i.prototype.searchItems=function(t){var e,n;return n=$(t.currentTarget),e=App.Reservation.find(n.closest("[data-id]").data("id")).model(),(e.constructor===App.Model?this.fetchItems(e):e.constructor===App.Software?this.fetchLicenses(e):void 0).done(function(t){return function(e){var i,r;return r=function(){var t,n,r,o;for(o=[],t=0,n=e.length;n>t;t++)i=e[t],o.push(null!=(r=App.Item.exists(i.id))?r:App.License.find(i.id));return o}(),r.length?t.setupAutocomplete(n,r):void 0}}(this))},i.prototype.setupAutocomplete=function(t,e){return!t.is(":focus")||t.is(":disabled")?!1:(t.autocomplete({appendTo:t.closest(".line"),source:function(t){return function(t,n){var i;return i=_.map(e,function(t){return t.value=t.id,t}),i=_.filter(i,function(e){return e.inventory_code.match(t.term)}),n(i)}}(this),focus:function(t){return function(){return!1}}(this),minLength:0,select:function(e){return function(n,i){return e.assignItem(t,i.item),!1}}(this)}).data("uiAutocomplete")._renderItem=function(t){return function(t,e){return $(App.Render("manage/views/items/autocomplete_element",e)).data("value",e).appendTo(t)}}(this),t.autocomplete("search",""))},i.prototype.fetchItemsOrLicences=function(t,e){return t.ajaxFetch({data:$.param({model_ids:[e.id],in_stock:!0,responsible_inventory_pool_id:App.InventoryPool.current.id,retired:!1})})},i.prototype.fetchItems=_.partial(i.prototype.fetchItemsOrLicences,App.Item),i.prototype.fetchLicenses=_.partial(i.prototype.fetchItemsOrLicences,App.License),i.prototype.fetchWithIds=function(t,e){return e.length?t.ajaxFetch({data:$.param({ids:e})}):{done:function(t){return t()}}},i.prototype.fetchBuildings=_.partial(i.prototype.fetchWithIds,App.Building),i.prototype.assignItem=function(t,e){var n;return t.blur(),t.autocomplete("destroy"),n=App.Reservation.find(t.closest("[data-id]").data("id")),n.assign(e,function(i){return function(){return t.val(e.inventory_code),t.prop("disabled",!0),App.LineSelectionController.add(n.id)}}(this))},i.prototype.removeAssignment=function(t){var e,n;return n=$(t.currentTarget),e=App.Reservation.find(n.closest("[data-id]").data("id")),e.removeAssignment(),App.Flash({type:"notice",message:_jed("The assignment for %s was removed",e.model().name())})},i.prototype.submitAssignment=function(t){var e,n,i,r,o;return t.preventDefault(),o=$(t.currentTarget).find("[data-assign-item]"),i=App.Reservation.find(o.closest("[data-id]").data("id")),e=o.val(),n=i.model(),r=n.constructor===App.Model?App.Item:n.constructor===App.Software?App.License:void 0,r.ajaxFetch({data:$.param({inventory_code:e})}).done(function(t){return function(n){return 1===n.length?t.assignItem(o,r.find(n[0].id)):App.Flash({type:"error",message:_jed("The Inventory Code %s was not found for %s",[e,i.model().name()])})}}(this))},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ReservationsChangeController=function(n){function i(){return this.changeRange=t(this.changeRange,this),this.storeOptionLine=t(this.storeOptionLine,this),this.storeItemLine=t(this.storeItemLine,this),this.store=t(this.store,this),this.done=t(this.done,this),this.createReservation=t(this.createReservation,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.createReservation=function(){var t;return App.Reservation.createOne({model_id:_.first(this.models).id,start_date:this.getStartDate().format("YYYY-MM-DD"),end_date:this.getEndDate().format("YYYY-MM-DD"),contract_id:null!=(t=this.contract)?t.id:void 0,purpose_id:_.first(this.reservations).purpose_id,quantity:1}).fail(function(t){return function(e){return t.fail(e)}}(this))},i.prototype.done=function(t){var e;return App.Reservation.trigger("refresh",function(){var n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(App.Reservation.find(e.id));return r}()),i.__super__.done.apply(this,arguments)},i.prototype.store=function(){return null!=this.contract?1===this.models.length?this.storeItemLine():0===this.models.length?this.storeOptionLine():this.changeRange():this.changeRange()},i.prototype.storeItemLine=function(){var t,e,n,i,r,o,s,a,l,d,p,u;if(e=this.getQuantity()-this.quantity,0>e){for(l=this.reservations.slice(0,+(Math.abs(e)-1)+1||9e9),t=_.after(l.length,this.changeRange),this.reservations=_.reject(this.reservations,function(t){return _.include(l,t)}),d=[],i=0,o=l.length;o>i;i++)s=l[i],d.push(function(e){return App.Reservation.ajaxChange(e,"destroy",{}).done(function(n){return function(){return e.remove(),t()}}(this))}(s));return d}if(e>0){for(n=_.after(e,this.changeRange),p=[],u=r=1,a=e;a>=1?a>=r:r>=a;u=a>=1?++r:--r)p.push(this.createReservation().done(function(t){return function(e){return t.reservations.push(App.Reservation.find(e.id)),n()}}(this)));return p}return this.changeRange()},i.prototype.storeOptionLine=function(){var t;return null!=this.getQuantity()?(t=_.first(this.reservations),t.updateAttributes({quantity:this.getQuantity(),start_date:this.getStartDate().format("YYYY-MM-DD"),end_date:this.getEndDate().format("YYYY-MM-DD")}),this.done(t.contract())):this.changeRange()},i.prototype.changeRange=function(){return this.getStartDate().format("YYYY-MM-DD")!==this.startDate||this.getEndDate().format("YYYY-MM-DD")!==this.endDate?App.Reservation.changeTimeRange(this.reservations,this.startDateDisabled?void 0:this.getStartDate(),this.getEndDate()).done(this.done).fail(this.fail):this.done()},i}(window.App.ManageBookingCalendarDialogController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ReservationsDestroyController=function(n){function i(){return this.destroyReservations=t(this.destroyReservations,this),this.destroySelectedLines=t(this.destroySelectedLines,this),this.destroyLines=t(this.destroyLines,this),this.destroyLine=t(this.destroyLine,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"click [data-destroy-line]":"destroyLine","click [data-destroy-lines]":"destroyLines","click [data-destroy-selected-lines]":"destroySelectedLines"},i.prototype.destroyLine=function(t){return this.destroyReservations($(t.currentTarget),[$(t.currentTarget).closest("[data-id]").data("id")])},i.prototype.destroyLines=function(t){return this.destroyReservations($(t.currentTarget),$(t.currentTarget).data("ids"))},i.prototype.destroySelectedLines=function(t){return this.destroyReservations($(t.currentTarget),App.LineSelectionController.selected)},i.prototype.destroyReservations=function(t,e){return App.LineSelectionController.selected=_.difference(App.LineSelectionController.selected,e),App.Reservation.destroyMultiple(e)},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ReservationsEditController=function(n){function i(){return this.editLines=t(this.editLines,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"click [data-edit-lines]":"editLines"},i.prototype.editLines=function(t){var e,n,i,r,o,s,a,l;return l=$(t.currentTarget),a="selected-lines"===l.data("edit-lines"),n=a?App.LineSelectionController.selected:l.data("ids"),s=function(){var t,i,r;for(r=[],t=0,i=n.length;i>t;t++)e=n[t],r.push(App.Reservation.find(e));return r}(),i=App.Modules.HasLines.mergeLinesByModel(s),o=a?null:_.reduce(i,function(t,e){return t+(null!=e.subreservations?_.reduce(e.subreservations,function(t,e){return t+e.quantity},0):e.quantity)},0),r=_.unique(_.map(_.filter(i,function(t){return null!=t.model_id}),function(t){return t.model()}),!1,function(t){return t.id}),new App.ReservationsChangeController({mergedLines:i,reservations:s,user:this.user,models:r,quantity:o,contract:this.contract,startDateDisabled:this.startDateDisabled,quantityDisabled:this.quantityDisabled})},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ReservationsExplorativeAddController=function(n){function i(e){this.select=t(this.select,this),this.render=t(this.render,this),this.fetchAvailability=t(this.fetchAvailability,this),this.fetchModels=t(this.fetchModels,this),this.fetch=t(this.fetch,this),this.reset=t(this.reset,this),this.setupModal=t(this.setupModal,this),this.startDate=e.startDate,this.endDate=e.endDate,this.setupModal(),i.__super__.constructor.apply(this,arguments),this.categoriesFilter=new App.CategoriesFilterController({el:this.categoriesContainer,filter:this.reset}),this.pagination=new App.ListPaginationController({el:this.list,fetch:this.fetch}),this.reset()}return e(i,n),i.prototype.elements={"#categories":"categoriesContainer","#models":"list"},i.prototype.events={"click [data-type='select']":"select"},i.prototype.setupModal=function(){return this.el=$(App.Render("manage/views/reservations/explorative_add_dialog",{startDate:this.startDate,endDate:this.endDate})),this.modal=new App.Modal(this.el)},i.prototype.reset=function(){return this.models={},this.list.html(App.Render("manage/views/lists/loading")),this.fetch(1,this.list)},i.prototype.fetch=function(t,e){return this.fetchModels(t).done(function(n){return function(){return n.fetchAvailability(t).done(function(){return n.render(e,n.models[t],t)})}}(this))},i.prototype.fetchModels=function(t){var e;return App.Model.ajaxFetch({data:$.param({page:t,category_id:null!=(e=this.categoriesFilter.getCurrent())?e.id:void 0,used:!0,borrowable:!0,responsible_inventory_pool_id:App.InventoryPool.current.id})}).done(function(e){return function(n,i,r){var o,s;return e.pagination.set(JSON.parse(r.getResponseHeader("X-Pagination"))),s=function(){var t,e,i;for(i=[],t=0,e=n.length;e>t;t++)o=n[t],i.push(App.Model.find(o.id));return i}(),e.models[t]=s}}(this))},i.prototype.fetchAvailability=function(t){var e,n;return n=_.filter(this.models[t],function(t){
return"Model"===t.constructor.className}),e=_.map(n,function(t){return t.id}),e.length?App.Availability.ajaxFetch({url:App.Availability.url(),data:$.param({model_ids:e,user_id:this.contract.user_id})}):{done:function(t){return t()}}},i.prototype.render=function(t,e,n){if(null!=e){if(!e.length)return t.html(App.Render("manage/views/lists/no_results"));if(t.html(App.Render("manage/views/models/explorative_add_line",e,{startDate:this.startDate,endDate:this.endDate,groupIds:this.contract.user().groupIds})),1===n)return this.pagination.renderPlaceholders()}},i.prototype.select=function(t){var e,n;return n=$(t.currentTarget),e=App.Model.find(n.closest("[data-id]").data("id")),this.addModel(e,this.startDate,this.endDate),this.modal.destroy(!0)},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.SwapModelController=function(n){function i(){return this.exploreModels=t(this.exploreModels,this),this.swapModel=t(this.swapModel,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"click [data-swap-model]":"exploreModels"},i.prototype.swapModel=function(t,e,n){var i;return $.post("/manage/"+App.InventoryPool.current.id+"/reservations/swap_model",{line_ids:function(){var t,e,n,r;for(n=this.reservations,r=[],t=0,e=n.length;e>t;t++)i=n[t],r.push(i.id);return r}.call(this),model_id:t.id},function(t){var e,n,r;for(r=[],e=0,n=t.length;n>e;e++)i=t[e],r.push(App.Reservation.update(i.id,i));return r})},i.prototype.exploreModels=function(t){var e;return this.reservations=$(t.currentTarget).closest("[data-ids]").length?_.map($(t.currentTarget).closest("[data-ids]").data("ids"),function(t){return App.Reservation.find(t)}):[App.Reservation.find($(t.currentTarget).closest("[data-id]").data("id"))],e=this.reservations[0],new App.ReservationsExplorativeAddController({contract:e.contract(),startDate:e.start_date,endDate:e.end_date,addModel:this.swapModel})},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ImagesController=function(n){function i(){this.processNewFile=t(this.processNewFile,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.templatePath="manage/views/templates/upload/image_inline_entry",i.prototype.processNewFile=function(t,e){var n;return n=new FileReader,n.onload=function(e){return function(e){return t.find("img").attr("src",e.target.result)}}(this),n.readAsDataURL(e)},i}(App.UploadController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.InlineEntryRemoveController=function(n){function i(){return this.toggleDestroy=t(this.toggleDestroy,this),this.remove=t(this.remove,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"click [data-type='inline-entry'] [data-remove]":"remove"},i.prototype.remove=function(t){var e;return t.preventDefault(),e=$(t.currentTarget).closest("[data-type='inline-entry']"),e.trigger("inline-entry-remove",e),null!=e.data("new")?(e.remove(),"function"==typeof this.removeCallback?this.removeCallback(e):void 0):this.toggleDestroy(e,$(t.currentTarget))},i.prototype.toggleDestroy=function(t,e){var n,i,r;return i=e,n=t.find("[name*='_destroy']"),null!=t.data("destroyOnSave")?(t.removeClass("striked"),t.find("input:visible").prop("disabled",!1),t.data("removedOnSaveInfo").remove(),t.find("[data-disable-on-remove]").prop("disabled",!1),n.length&&n.val(null),t.data("destroyOnSave",null),e.text(_jed("Remove")),"function"==typeof this.unstrikeCallback?this.unstrikeCallback(t):void 0):(t.addClass("striked"),t.find("input:visible").prop("disabled",!0),r=$(App.Render("manage/views/inline_entries/removed_on_save_info")),t.data("removedOnSaveInfo",r),t.prepend(r),t.find("[data-disable-on-remove]").prop("disabled",!0),n.length&&n.val(1),t.data("destroyOnSave",!0),e.text(_jed("undo")),"function"==typeof this.strikeCallback?this.strikeCallback(t):void 0)},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.LatestReminderTooltipController=function(n){function i(){return this.onEnter=t(this.onEnter,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"mouseenter .latest-reminder-cell":"onEnter"},i.prototype.onEnter=function(t){var e,n;return n=$(t.currentTarget),e=new App.Tooltip({el:n,content:App.Render("views/loading",{size:"micro"})}),App.LatestReminder.ajaxFetch({url:"/manage/"+App.InventoryPool.current.id+"/latest_reminder",data:$.param({user_id:n.data("user-id"),visit_id:n.data("visit-id")})}).done(function(t){return function(t){return t.length?e.update(App.Render("manage/views/inventory_pools/latest_reminder/tooltip",t)):e.update(_jed("No reminder yet"))}}(this))},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.LinesCellTooltipController=function(n){function i(){return this.fetchOptions=t(this.fetchOptions,this),this.fetchModels=t(this.fetchModels,this),this.sliceFetchOptions=t(this.sliceFetchOptions,this),this.sliceFetchModels=t(this.sliceFetchModels,this),this.fetchData=t(this.fetchData,this),this.onEnter=t(this.onEnter,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"mouseenter [data-type='lines-cell']":"onEnter"},i.prototype.onEnter=function(t){var e,n,i;return i=$(t.currentTarget),e=i.closest(".line[data-type='contract']").length?App.Contract.findOrBuild(i.closest(".line[data-type='contract']").data()):i.closest(".line[data-type='take_back']").length?App.Visit.findOrBuild(i.closest(".line[data-type='take_back']").data()):i.closest(".line[data-type='hand_over']").length?App.Visit.findOrBuild(i.closest(".line[data-type='hand_over']").data()):void 0,n=new App.Tooltip({el:i.closest(".line-col"),content:App.Render("views/loading",{size:"micro"})}),this.fetchData(e,function(t){return function(){return n.update(App.Render("manage/views/reservations/tooltip",e))}}(this))},i.prototype.fetchData=function(t,e){var n,i,r,o,s,a;for(o=[],s=[],a=t.reservations().all(),n=0,i=a.length;i>n;n++)r=a[n],null!=r.model_id?null==App.Model.exists(r.model_id)&&o.push(r.model_id):null!=r.option_id&&null==App.Option.exists(r.option_id)&&s.push(r.option_id);return o.length>0?this.sliceFetchModels(o,function(t){return function(){return s.length>0?t.sliceFetchOptions(s,e):t.fetchOptions(s).done(function(){return e()})}}(this)):this.fetchModels(o).done(function(t){return function(){return s.length>0?t.sliceFetchOptions(s,e):t.fetchOptions(s).done(function(){return e()})}}(this))},i.prototype.sliceFetchModels=function(t,e){var n;return n=_.after(Math.ceil(t.length/50),e),_(t).each_slice(50,function(t){return function(e){return t.fetchModels(e).done(n)}}(this))},i.prototype.sliceFetchOptions=function(t,e){var n;return n=_.after(Math.ceil(t.length/50),e),_(t).each_slice(50,function(t){return function(e){return t.fetchOptions(e).done(n)}}(this))},i.prototype.fetchModels=function(t){return t.length?App.Model.ajaxFetch({data:$.param({ids:t,paginate:!1})}):{done:function(t){return t()}}},i.prototype.fetchOptions=function(t){return t.length?App.Option.ajaxFetch({data:$.param({ids:t,paginate:!1})}):{done:function(t){return t()}}},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.LineSelectionController=function(n){function i(){this.storeIdsToInputValues=t(this.storeIdsToInputValues,this),this.storeIdsToHrefs=t(this.storeIdsToHrefs,this),this.storeIds=t(this.storeIds,this),this.disable=t(this.disable,this),this.enable=t(this.enable,this),this.restore=t(this.restore,this),this.update=t(this.update,this),this.blurLines=t(this.blurLines,this),this.focusLines=t(this.focusLines,this),this.toggleContainerAbove=t(this.toggleContainerAbove,this),this.toggleLinesIn=t(this.toggleLinesIn,this),this.toggleContainer=t(this.toggleContainer,this),this.toggleLine=t(this.toggleLine,this),this.delegateEvents=t(this.delegateEvents,this),i.__super__.constructor.apply(this,arguments),this.delegateEvents(),App.LineSelectionController.Singleton=this}return e(i,n),i.selected=[],i.Singleton=null,i.prototype.elements={"#line-selection-counter":"lineSelectionCounter"},i.prototype.delegateEvents=function(){return this.el.on("change","input[data-select-line]",this.toggleLine),this.el.on("change","input[data-select-lines]",this.toggleContainer),this.el.on("change","input[data-select-lines], input[data-select-line]",this.update),this.el.on("mouseenter","input[data-select-lines]",this.focusLines),this.el.on("mouseleave","input[data-select-lines]",this.blurLines),App.Reservation.on("destroy",this.update),App.Contract.on("refresh",this.update)},i.prototype.toggleLine=function(t){var e;return e=$(t.currentTarget).closest(".line"),this.toggleContainerAbove(e)},i.prototype.toggleContainer=function(t){var e;return e=$(t.currentTarget).closest("[data-selected-lines-container]"),this.toggleLinesIn(e)},i.prototype.toggleLinesIn=function(t){var e,n,i,r,o,s;for(e=t.find("[data-select-lines]").is(":checked"),o=t.find("[data-select-line]"),s=[],i=0,r=o.length;r>i;i++)n=o[i],s.push($(n).prop("checked",e));return s},i.prototype.toggleContainerAbove=function(t){var e;return e=t.closest("[data-selected-lines-container]"),e.find("[data-select-line]:not(:checked)").length?e.find("[data-select-lines]").prop("checked",!1):e.find("[data-select-lines]").prop("checked",!0)},i.prototype.focusLines=function(t){return $(t.currentTarget).closest(".emboss").addClass("focus-thin")},i.prototype.blurLines=function(t){return $(t.currentTarget).closest(".emboss").removeClass("focus-thin")},i.prototype.update=function(){var t,e;return e=$("[data-select-line]:checked").closest(".line"),this.store(e),null!=(t=this.markVisitLinesController)&&t.update(App.LineSelectionController.selected),this.lineSelectionCounter.html(e.length),e.length?this.enable():this.disable(),this.storeIds()},i.prototype.store=function(t){var e;return e=_.flatten(_.map(t,function(t){var e;return null!=(e=$(t).data("ids"))?e:[$(t).data("id")]})),App.LineSelectionController.selected=e},i.prototype.restore=function(){var t,e,n,i,r,o,s,a;for(o=$("[data-select-line]"),n=0,i=o.length;i>n;n++)e=o[n],e=$(e),r=e.closest(".line"),t=null!=(s=$(r).data("ids"))?s:[$(r).data("id")],t.length&&_.all(t,function(t){return _.include(App.LineSelectionController.selected,t)})&&(e.prop("checked",!0),this.toggleContainerAbove(r));return t=App.LineSelectionController.selected,null!=(a=this.markVisitLinesController)&&a.update(App.LineSelectionController.selected),this.lineSelectionCounter.html(t.length),t.length?this.enable():this.disable(),this.storeIds()},i.prototype.enable=function(){var t,e,n,i,r;for(i=$(".button[data-selection-enabled]"),r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push(App.Button.enable($(t)));return r},i.prototype.disable=function(){var t,e,n,i,r;for(i=$(".button[data-selection-enabled]"),r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push(App.Button.disable($(t)));return r},i.prototype.storeIds=function(){return this.storeIdsToHrefs(),this.storeIdsToInputValues()},i.prototype.storeIdsToHrefs=function(){var t,e,n,i,r,o;for(i=$("a[data-update-href]"),r=[],t=0,e=i.length;e>t;t++)n=i[t],n=$(n),o=URI(n.attr("href")).removeQuery("ids[]").addQuery("ids[]",App.LineSelectionController.selected),r.push(n.attr("href",o.toString()));return r},i.prototype.storeIdsToInputValues=function(){var t,e,n,i,r,o;for(this.el.find("[data-input-fields-container]").remove(),this.el.find("[data-insert-before]").before("<div data-input-fields-container></div>"),t=this.el.find("[data-input-fields-container]"),r=App.LineSelectionController.selected,o=[],n=0,i=r.length;i>n;n++)e=r[n],o.push(t.append("<input type='hidden' name='ids[]' data-store-id value='"+e+"'>"));return o},i.add=function(t){return _.find(i.selected,function(e){return e===t})?void 0:(i.selected.push(t),i.Singleton.restore())},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ListFiltersController=function(n){function i(){return this.getData=t(this.getData,this),this.reset=t(this.reset,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={change:"reset"},i.prototype.reset=function(){return this.reset()},i.prototype.getData=function(){var t,e,n,i,r;for(t={},r=$(":visible",this.el).serializeArray(),n=0,i=r.length;i>n;n++)e=r[n],e.value.length&&"0"!==e.value&&(t[e.name]=e.value);return t},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ListPaginationController=function(n){function i(){return this.inview=t(this.inview,this),this.renderPlaceholders=t(this.renderPlaceholders,this),this.totalPages=t(this.totalPages,this),this.set=t(this.set,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"inview .page:not(.fetched)":"inview"},i.prototype.set=function(t){return this.totalCount=t.total_count,this.perPage=t.per_page},i.prototype.totalPages=function(){return Math.ceil(this.totalCount/this.perPage)},i.prototype.renderPlaceholders=function(){var t;return t=this.totalPages()-1,t>0?_.each(_.range(1,t+1),function(t){return function(e){var n;return e+=1,n=$(App.Render("manage/views/lists/page",e,{entries:_.range(t.perPage),page:e})),t.el.append(n)}}(this)):void 0},i.prototype.inview=function(t){var e;return e=$(t.currentTarget),e.addClass("fetched"),this.fetch(e.data("page"),e)},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ListRangeController=function(n){function i(){this.getBeforeLastCheck=t(this.getBeforeLastCheck,this),this.getEndDate=t(this.getEndDate,this),this.getStartDate=t(this.getStartDate,this),this.get=t(this.get,this),this.setupInputs=t(this.setupInputs,this),i.__super__.constructor.apply(this,arguments),this.setupInputs()}return e(i,n),i.prototype.elements={"input[name='start_date']":"startDate","input[name='end_date']":"endDate","input[name='before_last_check']":"beforeLastCheck"},i.prototype.events={"change input[name='start_date']":"reset","change input[name='end_date']":"reset","change input[name='before_last_check']":"reset"},i.prototype.setupInputs=function(){var t,e,n,i,r;for(i=[this.startDate,this.endDate,this.beforeLastCheck],r=[],t=0,n=i.length;n>t;t++)e=i[t],$(e).length?($(e).val().length&&$(e).val(moment($(e).val()).format(i18n.date.L)),r.push($(e).datepicker({dateFormat:i18n.datepicker.L}))):r.push(void 0);return r},i.prototype.get=function(){var t;return t={},null!=this.getStartDate()&&(t.start_date=this.getStartDate().format("YYYY-MM-DD")),null!=this.getEndDate()&&(t.end_date=this.getEndDate().format("YYYY-MM-DD")),null!=this.getBeforeLastCheck()&&(t.before_last_check=this.getBeforeLastCheck().format("YYYY-MM-DD")),t},i.prototype.getStartDate=function(){return""!==this.startDate.val()?moment(this.startDate.val(),i18n.date.L):void 0},i.prototype.getEndDate=function(){return""!==this.endDate.val()?moment(this.endDate.val(),i18n.date.L):void 0},i.prototype.getBeforeLastCheck=function(){return""!==this.beforeLastCheck.val()?moment(this.beforeLastCheck.val(),i18n.date.L):void 0},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ListSearchController=function(n){function i(){this.term=t(this.term,this),this.search=t(this.search,this),i.__super__.constructor.apply(this,arguments),this.el.preChange()}return e(i,n),i.prototype.events={change:"search",preChange:"search"},i.prototype.search=function(){return this.currentSearch!==this.term()&&this.reset(),this.currentSearch=this.term()},i.prototype.term=function(){return this.el.val().length?this.el.val():null},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ListTabsController=function(n){function i(){this.getData=t(this.getData,this),this["switch"]=t(this["switch"],this),i.__super__.constructor.apply(this,arguments),this.data=this.el.find(".active").data()}return e(i,n),i.prototype.events={"click .inline-tab-item":"switch"},i.prototype["switch"]=function(t){var e;return e=$(t.currentTarget),this.data=e.data(),this.el.find(".inline-tab-item.active").removeClass("active"),e.addClass("active"),this.reset()},i.prototype.getData=function(){return _.clone(this.data)},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ManageUsersViaAutocompleteController=function(n){function i(){this.select=t(this.select,this),this.setupAutocomplete=t(this.setupAutocomplete,this),this.fetchUsers=t(this.fetchUsers,this),this.search=t(this.search,this),i.__super__.constructor.apply(this,arguments),this.input.preChange()}return e(i,n),i.prototype.elements={"input[data-search-users]":"input","[data-users-list]":"usersList"},i.prototype.events={"preChange input[data-search-users]":"search","click [data-remove-user]":"removeHandler"},i.prototype.search=function(){return this.input.val().length?this.fetchUsers().done(function(t){return function(e){var n;return t.setupAutocomplete(function(){var t,i,r;for(r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push(App.User.find(n.id));return r}())}}(this)):!1},i.prototype.fetchUsers=function(){var t;return t={search_term:this.input.val(),per_page:5},$.extend(t,this.fetchUsersParams),App.User.ajaxFetch({data:$.param(t)})},i.prototype.setupAutocomplete=function(t){return this.input.autocomplete({source:function(e){return function(e,n){return n(t)}}(this),focus:function(t){return function(){return!1}}(this),select:this.select}).data("uiAutocomplete")._renderItem=function(t){return function(t,e){return $(App.Render("manage/views/templates/users/autocomplete_element",e)).data("value",e).appendTo(t)}}(this),this.input.autocomplete("search")},i.prototype.select=function(t,e){var n;return n=this.usersList.find("input[value='"+e.item.id+"']").closest(".line"),n.length?this.usersList.prepend(n):this.usersList.prepend(App.Render("manage/views/templates/users/user_inline_entry",App.User.find(e.item.id),{paramName:this.paramName}))},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.MarkVisitLinesController=function(n){function i(){return this.markSelectedLines=t(this.markSelectedLines,this),this.unmarkAllLines=t(this.unmarkAllLines,this),this.update=t(this.update,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.update=function(t){return this.unmarkAllLines(),this.markSelectedLines(t)},i.prototype.unmarkAllLines=function(){var t,e,n,i,r;for(i=this.el.find(".line[data-id]"),r=[],t=0,e=i.length;e>t;t++)n=i[t],r.push($(n).removeClass("green").addClass("light"));return r},i.prototype.markSelectedLines=function(t){var e,n,i,r,o,s,a;for(a=[],i=0,o=t.length;o>i;i++)r=t[i],n=App.Reservation.find(r),n.item()?(s=this.el.find(".line[data-id='"+r+"']"),a.push(s.removeClass("light").addClass("green"))):n.option()?(s=this.el.find(".line[data-id='"+r+"']"),e=n.status,"approved"===e?Number(s.find("input[data-line-quantity]").val())>=1?a.push(s.removeClass("light").addClass("green")):a.push(void 0):"signed"===e&&Number(s.find("input[data-quantity-returned]").val())===n.quantity?a.push(s.removeClass("light").addClass("green")):a.push(void 0)):a.push(void 0);return a},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.TimeLineController=function(n){function i(){return this.onload=t(this.onload,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"click [data-open-time-line]":"show"},i.prototype.show=function(t){var e,n,i,r;return r=$(t.currentTarget),e=r.data("model-id"),n=App.Model.exists(e)||App.Software.find(e),i=App.Render("manage/views/models/timeline_modal",n),this.modal=new App.Modal(i),this.modal.el.find("iframe").load(this.onload)},i.prototype.onload=function(){return this.modal.el.find("#loading").remove()},i}(Spine.Controller)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;window.App.TemplateController=function(e){function n(){n.__super__.constructor.apply(this,arguments),new App.TemplateModelsController({el:this.el.find("#models")}),new App.InlineEntryRemoveController({el:this.el})}return t(n,e),n}(Spine.Controller)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;window.App.TemplateEditController=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n}(App.TemplateController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.TemplateModelsController=function(n){function i(){this.select=t(this.select,this),this.setupAutocomplete=t(this.setupAutocomplete,this),this.fetchModels=t(this.fetchModels,this),this.search=t(this.search,this),i.__super__.constructor.apply(this,arguments),this.input.preChange()}return e(i,n),i.prototype.elements={"input[data-search-models]":"input","[data-models-list]":"modelsList"},i.prototype.events={"preChange input[data-search-models]":"search"},i.prototype.search=function(){return this.input.val().length?this.fetchModels().done(function(t){return function(e){var n;return t.setupAutocomplete(function(){var t,i,r;for(r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push(App.Model.find(n.id));return r}())}}(this)):!1},i.prototype.fetchModels=function(){return App.Model.ajaxFetch({data:$.param({search_term:this.input.val(),borrowable:!0,per_page:5})})},i.prototype.setupAutocomplete=function(t){return this.input.autocomplete({source:function(e){return function(e,n){return n(t)}}(this),focus:function(t){return function(){return!1}}(this),select:this.select}).data("uiAutocomplete")._renderItem=function(t){return function(t,e){return $(App.Render("manage/views/templates/models/autocomplete_element",e)).data("value",e).appendTo(t)}}(this),this.input.autocomplete("search")},i.prototype.select=function(t,e){return App.Availability.ajaxFetch({url:App.Availability.url()+"/in_stock",data:$.param({model_ids:e.item.id})}).done(function(t){return function(n){return _.any(t.modelsList.find("input[name*='model_id']"),function(t){return Number($(t).val())===Number(e.item.id)})?void 0:t.modelsList.prepend(App.Render("manage/views/templates/models/model_allocation_entry",App.Model.find(e.item.id),{currentInventoryPool:App.InventoryPool.current}))}}(this))},i}(Spine.Controller)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;window.App.TemplateNewController=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n}(App.TemplateController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.TopBarController=function(n){function i(){return this.checkStartScreenState=t(this.checkStartScreenState,this),this.changeStartScreen=t(this.changeStartScreen,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"change #start_screen_checkbox":"changeStartScreen"},i.prototype.elements={"#start_screen_checkbox":"startScreenCheckbox"},i.prototype.changeStartScreen=function(){var t;return t=window.location.pathname+window.location.search+window.location.hash,this.startScreenCheckbox.is(":checked")?App.User.current.setStartScreen(t):App.User.current.setStartScreen(null)},i.prototype.checkStartScreenState=function(){var t;return t=window.location.pathname+window.location.search+window.location.hash,App.User.current.start_screen===t?this.startScreenCheckbox.prop("checked",!0):this.startScreenCheckbox.prop("checked",!1)},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.ChangeUserGroupsController=function(n){function i(){this.select=t(this.select,this),this.setupAutocomplete=t(this.setupAutocomplete,this),this.searchGroups=t(this.searchGroups,this),this.search=t(this.search,this),i.__super__.constructor.apply(this,arguments),this.input.preChange()}return e(i,n),i.prototype.elements={"input[name='name']":"input","[data-group-list]":"groupList"},i.prototype.events={"focus input[name='name']":"search","preChange input[name='name']":"search","click [data-remove-group]":"removeGroup"},i.prototype.search=function(){return this.searchGroups().done(function(t){return function(e){var n;return t.setupAutocomplete(function(){var t,i,r;for(r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push(App.Group.find(n.id));return r}())}}(this))},i.prototype.searchGroups=function(){return App.Group.ajaxFetch({data:$.param({search_term:this.input.val()})})},i.prototype.setupAutocomplete=function(t){return this.input.autocomplete({source:function(e){return function(e,n){return n(t)}}(this),focus:function(t){return function(){return!1}}(this),select:this.select,minLength:0}).data("uiAutocomplete")._renderItem=function(t){return function(t,e){return $(App.Render("manage/views/groups/autocomplete_element",e)).data("value",e).appendTo(t)}}(this),this.input.autocomplete("search")},i.prototype.select=function(t,e){return this.groupList.append(App.Render("manage/views/groups/group_entry",e.item))},i.prototype.removeGroup=function(t){return t.preventDefault(),$(t.currentTarget).closest(".line").remove()},i}(Spine.Controller)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;window.App.DelegationController=function(e){function n(){n.__super__.constructor.apply(this,arguments),new App.ManageUsersViaAutocompleteController({el:this.el.find("#users"),removeHandler:this.removeUserHandler,paramName:"user[users][][id]",fetchUsersParams:{type:"user"}})}return t(n,e),n.removeHandler=function(t){return t.preventDefault(),$(t.currentTarget).closest(".line").remove()},n.prototype.removeUserHandler=n.removeHandler,n}(Spine.Controller)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;window.App.DelegationEditController=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.include(App.Modules.InlineEntryHandlers),n.prototype.removeUserHandler=n.prototype.strikeRemoveUserHandler,n}(App.DelegationController)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.UserCellTooltipController=function(n){function i(){return this.onEnter=t(this.onEnter,this),i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.events={"mouseenter [data-type='user-cell']":"onEnter"},i.prototype.onEnter=function(t){var e;return e=$(t.currentTarget),new App.Tooltip({el:e.closest("[data-type='user-cell']"),content:App.Render("manage/views/users/tooltip",App.User.findOrBuild(e.data()))})},i}(Spine.Controller)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;window.App.UserController=function(e){function n(){n.__super__.constructor.apply(this,arguments),new App.ChangeUserGroupsController({el:this.el.find("#change-groups")}),new App.UserSuspendedUntilController({el:this.el})}return t(n,e),n}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.App.UserSuspendedUntilController=function(n){function i(){this.hideSuspendedReason=t(this.hideSuspendedReason,this),this.showSuspendedReason=t(this.showSuspendedReason,this),this.toggleSuspendedReason=t(this.toggleSuspendedReason,this),i.__super__.constructor.apply(this,arguments),this.input.datepicker()}return e(i,n),i.prototype.elements={"input[data-suspended-until-input]":"input","#suspended-reason":"suspendedReason"},i.prototype.events={"change input[data-suspended-until-input]":"toggleSuspendedReason"},i.prototype.toggleSuspendedReason=function(){return _.isEmpty(this.input.val())?this.hideSuspendedReason():this.showSuspendedReason()},i.prototype.showSuspendedReason=function(){return this.suspendedReason.removeClass("hidden")},i.prototype.hideSuspendedReason=function(){return this.suspendedReason.addClass("hidden")},i}(Spine.Controller)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;
window.App.UsersIndexController=function(n){function i(e){this.render=t(this.render,this),this.fetchAccessRights=t(this.fetchAccessRights,this),this.fetchUsers=t(this.fetchUsers,this),this.fetch=t(this.fetch,this),this.reset=t(this.reset,this),i.__super__.constructor.apply(this,arguments),this.users={},new App.UserCellTooltipController({el:this.list}),this.pagination=new App.ListPaginationController({el:this.list,fetch:this.fetch}),this.search=new App.ListSearchController({el:this.el.find("#list-search"),reset:this.reset}),this.filter=new App.ListFiltersController({el:this.el.find("#list-filters"),reset:this.reset}),this.reset()}return e(i,n),i.prototype.elements={"#user-list":"list"},i.prototype.reset=function(){return this.users={},this.list.html(App.Render("manage/views/lists/loading")),this.fetch(1,this.list)},i.prototype.fetch=function(t,e){return this.fetchUsers(t).done(function(n){return function(){return n.fetchAccessRights(t).done(function(){return n.render(e,n.users[t],t)})}}(this))},i.prototype.fetchUsers=function(t){return App.User.ajaxFetch({data:$.param($.extend(this.filter.getData(),{page:t,search_term:this.search.term(),role:this.role,all:_.isEmpty(this.role)?!0:void 0}))}).done(function(e){return function(n,i,r){var o,s;return e.pagination.set(JSON.parse(r.getResponseHeader("X-Pagination"))),s=function(){var t,e,i;for(i=[],t=0,e=n.length;e>t;t++)o=n[t],i.push(App.User.find(o.id));return i}(),e.users[t]=s,App.User.fetchDelegators(s)}}(this))},i.prototype.fetchAccessRights=function(t){var e;return e=_.map(this.users[t],function(t){return t.id}),e.length?App.AccessRight.ajaxFetch({data:$.param({user_ids:e})}):{done:function(t){return t()}}},i.prototype.render=function(t,e,n){return t.html(App.Render("manage/views/users/line",e,{currentInventoryPool:App.InventoryPool.current})),1===n?this.pagination.renderPlaceholders():void 0},i}(Spine.Controller)}.call(this),function(t){t.views.templates("manage/views/availabilities/loaded","<div class='emboss padding-inset-s'>\n  <p class='paragraph-s'>\n    <i class='fa fa-check margin-right-m'></i>\n    {{jed \"Availability loaded\"/}}\n  </p>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/availabilities/loading","<div class='emboss blue padding-inset-s'>\n  <p class='paragraph-s'>\n    <img class='margin-right-s max-width-micro' src='/assets/loading-4eebf3d6e9139e863f2be8c14cad4638df21bf050cea16117739b3431837ee0a.gif'>\n    <strong>{{jed \"Loading availability\"/}}</strong>\n  </p>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/booking_calendar/calendar_dialog","<div class='modal fade ui-modal medium' role='dialog' tabindex='-1'>\n  <div class='modal-header row'>\n    <div class='col3of5'>\n      <h2 class='headline-l'>{{jed \"Edit reservation\"/}}</h2>\n      <h3 class='headline-m'>\n        {{>user.firstname}}\n        {{>user.lastname}}\n      </h3>\n    </div>\n    <div class='col2of5 text-align-right'>\n      <div class='modal-close'>{{jed \"Cancel\"/}}</div>\n      <button class='button green' disabled='disabled' id='submit-booking-calendar'>{{jed \"Save\"/}}</button>\n    </div>\n  </div>\n  <div id='booking-calendar-errors'></div>\n  <div class='modal-body'>\n    <form class='padding-inset-m'>\n      <div class='hidden' id='booking-calendar-controls'>\n        <div class='col5of8 float-right'>\n          <div class='row grey padding-bottom-xxs'>\n            <div class='col1of2'>\n              <div class='col1of2 padding-right-xs text-align-left'>\n                <div class='row {{if ~startDateDisabled}} hidden{{/if}}'>\n                  <span>{{jed \"Startdate\"/}}</span>\n                  <a class='grey fa fa-eye position-absolute-right padding-right-xxs' id='jump-to-start-date'></a>\n                </div>\n              </div>\n              <div class='col1of2 padding-right-xs text-align-left'>\n                <div class='row'>\n                  <span>{{jed \"Enddate\"/}}</span>\n                  <a class='grey fa fa-eye position-absolute-right padding-right-xxs' id='jump-to-end-date'></a>\n                </div>\n              </div>\n            </div>\n            <div class='col1of2'>\n              <div class='col2of8 text-align-left'>{{jed \"Quantity\"/}}</div>\n              <div class='col6of8 padding-left-xs text-align-left'>{{jed \"Availability\"/}}</div>\n            </div>\n          </div>\n          <div class='row'>\n            <div class='col1of2'>\n              <div class='col1of2 padding-right-xs'>\n                <div class='row {{if ~startDateDisabled}} hidden{{/if}}'>\n                  <input autocomplete='off' id='booking-calendar-start-date' type='text'>\n                </div>\n              </div>\n              <div class='col1of2 padding-right-xs'>\n                <input autocomplete='off' id='booking-calendar-end-date' type='text'>\n              </div>\n            </div>\n            <div class='col1of2'>\n              <div class='col2of8'>\n                {{if ~quantityDisabled}}\n                <input autocomplete='off' class='text-align-center' disabled='disabled' id='booking-calendar-quantity' type='text' value='1'>\n                {{else}}\n                <input autocomplete='off' class='text-align-center' id='booking-calendar-quantity' type='text' value='1'>\n                {{/if}}\n              </div>\n              <div class='col6of8 padding-left-xs'>\n                <select class='width-full' id='booking-calendar-partitions'></select>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class='booking-calendar padding-top-xs' id='booking-calendar'></div>\n      <img class='loading margin-horziontal-auto margin-vertical-xl' src='/assets/loading-4eebf3d6e9139e863f2be8c14cad4638df21bf050cea16117739b3431837ee0a.gif'>\n    </form>\n    <div id='booking-calendar-lines'>\n      <div class='list-of-lines separated-top'></div>\n    </div>\n  </div>\n  <div class='modal-footer'></div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/booking_calendar/line","<div class='line row'>\n  {{if model().availability}}\n  <div class='line-info{{if model().availability().withoutLines([#view.data]).maxAvailableForGroups(~start_date, ~end_date, ~groupIds) < (~quantity||quantity)}} red{{/if}}'></div>\n  {{/if}}\n  <div class='col1of10 line-col text-align-center'>\n    <span>\n      {{if ~quantity}}\n      {{>~quantity}}\n      {{else subreservations}}\n      {{sum subreservations \"quantity\"/}}\n      {{else}}\n      {{>quantity}}\n      {{/if}}\n    </span>\n    {{if model().availability}}\n    <span class='grey-text'>\n      /\n      {{if subreservations}}\n      {{>model().availability().withoutLines(subreservations).maxAvailableForGroups(~start_date, ~end_date, ~groupIds)}}\n      {{else}}\n      {{>model().availability().withoutLines([#view.data]).maxAvailableForGroups(~start_date, ~end_date, ~groupIds)}}\n      {{/if}}\n    </span>\n    {{/if}}\n  </div>\n  <div class='col5of10 line-col text-align-left'>\n    <strong>{{>model().name()}}</strong>\n  </div>\n  <div class='col4of10 line-col'>\n    {{if model().availability}}\n    {{for model().availability().withoutLines([#view.data]).unavailableRanges((~quantity||quantity), ~groupIds, ~start_date, ~end_date)}}\n    <strong class='darkred-text'>{{date startDate/}}-{{date endDate/}}</strong>\n    {{/for}}\n    {{/if}}\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/booking_calendar/partitions","<option data-value='[{{>user}}]'>{{jed \"Borrower\"/}}</option>\n{{if userGroups.length}}\n<optgroup label='{{jed 'Groups of this customer'/}}'>\n  {{for userGroups}}\n  <option data-value='[{{>id}}]'>{{>name}}</option>\n  {{/for}}\n</optgroup>\n{{/if}}\n{{if otherGroups.length}}\n<optgroup label='{{jed 'Other groups'/}}'>\n  {{for otherGroups}}\n  <option data-value='[{{>id}}]'>{{>name}}</option>\n  {{/for}}\n</optgroup>\n{{/if}}\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/categories/category_link_inline_entry","<div class='row line font-size-xs focus-hover-thin' data-new data-type='inline-entry'>\n  <input name='category[links][{{>~uid}}][parent_id]' type='hidden' value='{{>id}}'>\n  <div class='line-col col3of10 text-align-left'>\n    {{>name}}\n  </div>\n  <div class='line-col col1of10 text-align-center' title='{{jed 'Subordinate to %s' name/}}'>\n    <i class='fa fa-sitemap'></i>\n  </div>\n  <div class='line-col col3of10 text-align-left'>\n    <input autocomplete='off' class='small width-full' name='category[links][{{>~uid}}][label]' placeholder='{{jed 'Label'/}}' type='text' value='{{>~label}}'>\n  </div>\n  <div class='line-col col3of10 text-align-right'>\n    <button class='button small inset' data-remove>\n      {{jed 'Remove'/}}\n    </button>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/categories/filter_list_current","<a class='emboss links black row focus-hover-thin font-size-m padding-horizontal-s padding-vertical-xs round-border-on-hover' data-id='{{>id}}' data-type='category-current'>\n  <i class='arrow left'></i>\n  {{>name}}\n</a>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/categories/filter_list_entry","<a class='links black row focus-hover-thin font-size-m padding-horizontal-s padding-vertical-xs round-border-on-hover' data-id='{{>id}}' data-type='category-filter'>\n  {{>name}}\n</a>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/categories/filter_list_root","<a class='emboss links black row focus-hover-thin font-size-m padding-horizontal-s padding-vertical-xs round-border-on-hover' data-id='{{>id}}' data-type='category-root'>\n  <strong>{{>name}}</strong>\n</a>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/categories/filter_list_search","<a class='emboss links black row focus-hover-thin font-size-m padding-horizontal-s padding-vertical-xs round-border-on-hover' data-id='{{>id}}' data-type='category-search'>\n  <strong>\n    <i class='fa fa-search icon-xxs vertical-align-top'></i>\n    {{>search_term}}\n  </strong>\n</a>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/categories/line","<div class='row line' data-id='{{>id}}' data-parent>\n  <div class='col1of9 line-col'>\n    {{if children().length}}\n    <button class='button inset small min-width-xs' data-type='expander'>\n      <i class='arrow right'></i>\n      <span>\n        {{>children().length}}\n      </span>\n    </button>\n    {{/if}}\n  </div>\n  <div class='col3of9 line-col text-align-left'>\n    <strong>\n      {{>name}}\n    </strong>\n  </div>\n  <div class='col2of9 line-col'>\n    {{if !is_used()}}\n    <strong class='darkred-text'>\n      {{jed \"not used\"/}}\n    </strong>\n    {{/if}}\n  </div>\n  <div class='col3of9 line-col line-actions'>\n    {{if is_used()}}\n    <a class='button white' href='{{>url('edit')}}'>\n      {{jed \"Edit\"/}}\n    </a>\n    {{else}}\n    <div class='multibutton'>\n      <a class='button white' href='{{>url('edit')}}'>\n        {{jed \"Edit\"/}}\n      </a>\n      <div class='dropdown-holder inline-block'>\n        <div class='button white dropdown-toggle'>\n          <div class='arrow down'></div>\n        </div>\n        <ul class='dropdown right'>\n          <li>\n            <a class='dropdown-item red' data-method='delete' href='{{>url()}}'>\n              <i class='fa fa-trash'></i>\n              {{jed \"Delete\"/}}\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n    {{/if}}\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/contracts/approval_failed_modal","<div class='modal medium hide fade ui-modal padding-inset-m padding-horizontal-l' role='dialog' tabindex='-1'>\n  <form>\n    <div class='row padding-vertical-m'>\n      <div class='col1of2'>\n        <h3 class='headline-l'>{{jed \"Approval failed\"/}}</h3>\n        <h3 class='headline-s light'>\n          {{>user().firstname}}\n          {{>user().lastname}}\n        </h3>\n      </div>\n      <div class='col1of2'>\n        <div class='float-right'>\n          <a aria-hidden='true' class='modal-close weak' data-dismiss='modal' title='{{jed \"close dialog\"/}}' type='button'>\n            {{jed \"Cancel\"/}}\n          </a>\n          {{if ~accessRight.atLeastRole(~currentUserRole, \"lending_manager\") }}\n          <div class='multibutton'>\n            <a class='button white text-ellipsis' href='/manage/{{current_inventory_pool_id/}}/contracts/{{>id}}/edit'>\n              {{jed \"Edit Order\"/}}\n            </a>\n            <div class='dropdown-holder inline-block'>\n              <div class='button white dropdown-toggle'>\n                <div class='arrow down'></div>\n              </div>\n              <ul class='dropdown right'>\n                <li>\n                  <a class='dropdown-item' data-approve-anyway>\n                    <i class='fa fa-thumbs-up'></i>\n                    {{jed \"Approve anyway\"/}}\n                  </a>\n                </li>\n              </ul>\n            </div>\n          </div>\n          {{else}}\n          <a class='button white text-ellipsis' href='/manage/{{current_inventory_pool_id/}}/contracts/{{>id}}/edit'>\n            {{jed \"Edit Order\"/}}\n          </a>\n          {{/if}}\n        </div>\n      </div>\n    </div>\n    <div class='row margin-top-m'>\n      <div class='separated-bottom padding-bottom-m margin-bottom-m'>\n        <div class='row margin-bottom-s emboss red padding-inset-s'>\n          <p class='paragraph-s'>\n            <strong>{{>error}}</strong>\n          </p>\n        </div>\n      </div>\n      <div class='modal-body'>\n        {{for groupedLinesByDateRange(true)}}\n        <div class='padding-bottom-m margin-bottom-m no-last-child-margin'>\n          <div class='row margin-bottom-s'>\n            <div class='col1of2'>\n              <p>\n                {{date start_date/}}\n                -\n                {{date end_date/}}\n              </p>\n            </div>\n            <div class='col1of2 text-align-right'>\n              <strong>{{diffDatesInDays start_date end_date/}}</strong>\n            </div>\n          </div>\n          {{for reservations}}\n          <div class='row'>\n            <div class='col1of8 text-align-center'>\n              <div class='paragraph-s'>\n                {{if subreservations}}\n                {{sum subreservations \"quantity\"/}}\n                {{else}}\n                {{> quantity}}\n                {{/if}}\n              </div>\n            </div>\n            <div class='col7of8'>\n              <div class='paragraph-s'>\n                <strong>{{>model().name()}}</strong>\n              </div>\n            </div>\n          </div>\n          {{/for}}\n        </div>\n        {{/for}}\n      </div>\n    </div>\n    <div class='row separated-top padding-top-m'>\n      <div class='col1of1 padding-bottom-s'>\n        <p>{{jed \"Write a comment... (your comment will be part of the confirmation e-mail)\"/}}</p>\n      </div>\n      <textarea autofocus='autofocus' class='col1of1 height-s' id='comment' name='comment'>{{>~comment}}</textarea>\n    </div>\n  </form>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/contracts/approve_with_comment_modal","<div class='modal medium hide fade ui-modal padding-inset-m padding-horizontal-l' role='dialog' tabindex='-1'>\n  <div class='row padding-vertical-m'>\n    <div class='col1of2'>\n      <h3 class='headline-l'>{{jed \"Approve order\"/}}</h3>\n      <h3 class='headline-s light'>\n        {{>user().firstname}}\n        {{>user().lastname}}\n      </h3>\n    </div>\n    <div class='col1of2'>\n      <div class='float-right'>\n        <a aria-hidden='true' class='modal-close weak' data-dismiss='modal' title='{{jed \"close dialog\"/}}' type='button'>\n          {{jed \"Cancel\"/}}\n        </a>\n        <button class='button green text-ellipsis' data-id='{{>id}}' data-order-approve>\n          <i class='fa fa-thumbs-up'></i>\n          {{jed \"Approve\"/}}\n        </button>\n      </div>\n    </div>\n  </div>\n  <div class='row margin-top-m'>\n    <div class='modal-body'>\n      {{for groupedLinesByDateRange(true)}}\n      <div class='padding-bottom-m margin-bottom-m no-last-child-margin'>\n        <div class='row margin-bottom-s'>\n          <div class='col1of2'>\n            <p>\n              {{date start_date/}}\n              -\n              {{date end_date/}}\n            </p>\n          </div>\n          <div class='col1of2 text-align-right'>\n            <strong>{{diffDatesInDays start_date end_date/}}</strong>\n          </div>\n        </div>\n        {{for reservations}}\n        <div class='row'>\n          <div class='col1of8 text-align-center'>\n            <div class='paragraph-s'>\n              {{if subreservations}}\n              {{sum subreservations \"quantity\"/}}\n              {{else}}\n              {{> quantity}}\n              {{/if}}\n            </div>\n          </div>\n          <div class='col7of8'>\n            <div class='paragraph-s'>\n              <strong>{{>model().name()}}</strong>\n            </div>\n          </div>\n        </div>\n        {{/for}}\n      </div>\n      {{/for}}\n    </div>\n  </div>\n  <div class='row separated-top padding-top-m'>\n    <div class='col1of1 padding-bottom-s'>\n      <p>{{jed \"Write a comment... (your comment will be part of the confirmation e-mail)\"/}}</p>\n    </div>\n    <textarea autofocus='autofocus' class='col1of1 height-s' id='comment' name='comment'></textarea>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/contracts/approved_button","<div class='padding-inset-s inline-block' title='{{jed 'Order approved'/}}'>\n  <i class='fa fa-thumbs-up'></i>\n</div>\n<a class='button white' href='{{>url('hand_over')}}'>\n  <i class='fa fa-mail-forward'></i>\n  {{jed 'Hand Over'/}}\n</a>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/contracts/edit/contact_person","<div class='row padding-vertical-m' id='contact-person'>\n  <div class='row emboss padding-inset-m'>\n    <div class='col4of9 text-align-center' id='swapped-person'>\n      <input autocomplete='off' class='width-m' id='user-id' placeholder='{{jed 'Contact person'/}} {{jed 'Name / ID'/}}' type='text'>\n      <div id='selected-user'></div>\n    </div>\n    <div class='col1of9 text-align-center'>\n      <i class='fa fa-exchange icon-xxl'></i>\n    </div>\n    <div class='col4of9 text-align-center'>\n      {{if delegatedUser()}}\n      <p class='paragraph-s padding-top-xxs margin-top-xxs'>\n        <strong>\n          {{>delegatedUser().firstname}}\n          {{>delegatedUser().lastname}}\n        </strong>\n      </p>\n      {{/if}}\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/contracts/edit/purpose_modal","<div class='modal medium hide fade ui-modal padding-inset-m padding-horizontal-l' role='dialog' tabindex='-1'>\n  <form>\n    <div class='row padding-vertical-m'>\n      <div class='col1of2'>\n        <h3 class='headline-l'>{{jed \"Edit Purpose\"/}}</h3>\n      </div>\n      <div class='col1of2'>\n        <div class='float-right'>\n          <a aria-hidden='true' class='modal-close weak' data-dismiss='modal' title='{{jed \"close dialog\"/}}' type='button'>\n            {{jed \"Cancel\"/}}\n          </a>\n          <button class='button white text-ellipsis' type='submit'>\n            {{jed \"Save\"/}}\n          </button>\n        </div>\n      </div>\n    </div>\n    <div class='padding-vertical-m hidden' id='errors'>\n      <div class='row emboss red text-align-center font-size-m padding-inset-s'>\n        <strong></strong>\n      </div>\n    </div>\n    <div class='row padding-top-m'>\n      <textarea autofocus='autofocus' class='col1of1 height-s' name='purpose'>{{>description}}</textarea>\n    </div>\n  </form>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/contracts/edit/swap_user_modal","<div class='modal medium hide fade ui-modal padding-inset-m padding-horizontal-l' role='dialog' tabindex='-1'>\n  <form>\n    <div class='row padding-vertical-m'>\n      <div class='col1of2'>\n        <h3 class='headline-l'>{{jed \"Change orderer\"/}}</h3>\n      </div>\n      <div class='col1of2'>\n        <div class='float-right'>\n          <a aria-hidden='true' class='modal-close weak' data-dismiss='modal' title='{{jed \"close dialog\"/}}' type='button'>\n            {{jed \"Cancel\"/}}\n          </a>\n          <button class='button white text-ellipsis' type='submit'>\n            {{jed \"Change orderer\"/}}\n          </button>\n        </div>\n      </div>\n    </div>\n    <div class='padding-vertical-m hidden' id='errors'>\n      <div class='row emboss red text-align-center font-size-m padding-inset-s'>\n        <strong></strong>\n      </div>\n    </div>\n    <div class='row padding-vertical-m' id='user'>\n      <div class='row emboss padding-inset-m'>\n        <div class='col4of9 text-align-center' id='swapped-person'>\n          <input autocomplete='off' autofocus='autofocus' class='width-m' data-barcode-scanner-target data-prevent-barcode-scanner-submit id='user-id' placeholder='{{jed 'Name / ID'/}}' type='text'>\n          <div id='selected-user'></div>\n        </div>\n        <div class='col1of9 text-align-center'>\n          <i class='fa fa-exchange icon-xxl'></i>\n        </div>\n        <div class='col4of9 text-align-center'>\n          <p class='paragraph-s padding-top-xxs margin-top-xxs'>\n            <strong>\n              {{>user().firstname}}\n              {{>user().lastname}}\n            </strong>\n          </p>\n        </div>\n      </div>\n    </div>\n  </form>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/contracts/edit/swapped_user","<div class='emboss white padding-inset-xxs'>\n  <div class='row'>\n    <p class='paragraph-s'>\n      <strong>\n        {{>firstname}}\n        {{>lastname}}\n      </strong>\n    </p>\n    <div class='position-absolute-topright padding-inset-xxs'>\n      <a class='grey padding-inset-xxs' id='remove-user'>\n        <i class='fa fa-times-circle icon-m'></i>\n      </a>\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/contracts/line","<div class='line row focus-hover-thin' data-id='{{>id}}' data-type='contract'>\n  {{include tmpl=\"manage/views/contracts/line_\"+status /}}\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/contracts/line_approved","{{partial 'manage/views/users/cell' user() '{\"grid\":\"col1of8\"}'/}}\n<div class='col1of8 line-col'>{{diffToday created_at/}}</div>\n<div class='col1of8 line-col text-align-center' data-type='lines-cell'>{{include tmpl='manage/views/reservations/cell'/}}</div>\n<div class='col1of8 line-col'>\n  {{>getMaxRange()}}\n  {{jed getMaxRange() \"day\" \"days\"/}}\n</div>\n<div class='col2of8 line-col text-align-left'>\n  <strong>{{jed \"Approved\"/}}</strong>\n</div>\n<div class='col2of8 line-col line-actions'>\n  <a class='button white text-ellipsis' href='{{>user().url('hand_over')}}'>\n    {{if ~accessRight.atLeastRole(~currentUserRole, \"lending_manager\") }}\n    <i class='fa fa-mail-forward'></i>\n    {{jed \"Hand Over\"/}}\n    {{else}}\n    {{jed \"Edit\"/}}\n    {{/if}}\n  </a>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/contracts/line_closed","{{partial 'manage/views/users/cell' user() '{\"grid\":\"col1of8\"}'/}}\n<div class='col1of8 line-col'>{{diffToday created_at/}}</div>\n<div class='col1of8 line-col text-align-center' data-type='lines-cell'>{{include tmpl='manage/views/reservations/cell'/}}</div>\n<div class='col1of8 line-col'>\n  {{>getMaxRange()}}\n  {{jed getMaxRange() \"day\" \"days\"/}}\n</div>\n<div class='col2of8 line-col text-align-left'>\n  <strong>{{jed \"Closed\"/}}</strong>\n  {{jed \"Contract\"/}}\n  {{>compact_id}}\n</div>\n<div class='col2of8 line-col line-actions'>\n  <div class='multibutton'>\n    <a class='button white text-ellipsis' href='{{>url()}}' target='_blank'>\n      <i class='fa fa-file'></i>\n      {{jed \"Contract\"/}}\n    </a>\n    <div class='dropdown-holder inline-block'>\n      <div class='button white dropdown-toggle'>\n        <div class='arrow down'></div>\n      </div>\n      <ul class='dropdown right'>\n        <li>\n          <a class='dropdown-item' href='{{>url('value_list')}}' target='_blank'>\n            <i class='fa fa-list-ol'></i>\n            {{jed \"Value List\"/}}\n          </a>\n        </li>\n        <li>\n          <a class='dropdown-item' href='{{>url('picking_list')}}' target='_blank'>\n            <i class='fa fa-list-ol'></i>\n            {{jed \"Picking List\"/}}\n          </a>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/contracts/line_rejected","{{partial 'manage/views/users/cell' user() '{\"grid\":\"col1of8\"}'/}}\n<div class='col1of8 line-col'>{{diffToday created_at/}}</div>\n<div class='col1of8 line-col text-align-center' data-type='lines-cell'>{{include tmpl='manage/views/reservations/cell'/}}</div>\n<div class='col1of8 line-col'>\n  {{>getMaxRange()}}\n  {{jed getMaxRange() \"day\" \"days\"/}}\n</div>\n<div class='col2of8 line-col text-align-left'>\n  <strong>{{jed \"Rejected\"/}}</strong>\n</div>\n<div class='col2of8 line-col line-actions'></div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/contracts/line_signed","{{partial 'manage/views/users/cell' user() '{\"grid\":\"col1of8\"}'/}}\n<div class='col1of8 line-col'>{{diffToday created_at/}}</div>\n<div class='col1of8 line-col text-align-center' data-type='lines-cell'>{{include tmpl='manage/views/reservations/cell'/}}</div>\n<div class='col1of8 line-col'>\n  {{>getMaxRange()}}\n  {{jed getMaxRange() \"day\" \"days\"/}}\n</div>\n<div class='col2of8 line-col text-align-left'>\n  <strong>{{jed \"Signed\"/}}</strong>\n  {{jed \"Contract\"/}}\n  {{>compact_id}}\n</div>\n<div class='col2of8 line-col line-actions'>\n  <div class='multibutton'>\n    {{if ~accessRight.atLeastRole(~currentUserRole, \"lending_manager\") }}\n    <a class='button white text-ellipsis' href='{{>user().url('take_back')}}'>\n      <i class='fa fa-mail-reply'></i>\n      {{jed \"Take Back\"/}}\n    </a>\n    <div class='dropdown-holder inline-block'>\n      <div class='button white dropdown-toggle'>\n        <div class='arrow down'></div>\n      </div>\n      <ul class='dropdown right'>\n        <li>\n          <a class='dropdown-item' href='{{>url()}}' target='_blank'>\n            <i class='fa fa-file-alt'></i>\n            {{jed \"Contract\"/}}\n          </a>\n        </li>\n        <li>\n          <a class='dropdown-item' href='{{>url('value_list')}}' target='_blank'>\n            <i class='fa fa-list-ol'></i>\n            {{jed \"Value List\"/}}\n          </a>\n        </li>\n        <li>\n          <a class='dropdown-item' href='{{>url('picking_list')}}' target='_blank'>\n            <i class='fa fa-list-ol'></i>\n            {{jed \"Picking List\"/}}\n          </a>\n        </li>\n      </ul>\n    </div>\n    {{else}}\n    <a class='button white text-ellipsis' href='{{>url()}}' target='_blank'>\n      <i class='fa fa-file-alt'></i>\n      {{jed \"Contract\"/}}\n    </a>\n    <div class='dropdown-holder inline-block'>\n      <div class='button white dropdown-toggle'>\n        <div class='arrow down'></div>\n      </div>\n      <ul class='dropdown right'>\n        <li>\n          <a class='dropdown-item' href='{{>url('value_list')}}' target='_blank'>\n            <i class='fa fa-list-ol'></i>\n            {{jed \"Value List\"/}}\n          </a>\n        </li>\n        <li>\n          <a class='dropdown-item' href='{{>url('picking_list')}}' target='_blank'>\n            <i class='fa fa-list-ol'></i>\n            {{jed \"Picking List\"/}}\n          </a>\n        </li>\n      </ul>\n    </div>\n    {{/if}}\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/contracts/line_submitted","{{partial 'manage/views/users/cell' user() '{\"grid\":\"col1of8\"}'/}}\n<div class='col1of8 line-col'>{{diffToday created_at/}}</div>\n<div class='col1of8 line-col text-align-center' data-type='lines-cell'>{{include tmpl='manage/views/reservations/cell'/}}</div>\n<div class='col1of8 line-col'>\n  {{>getMaxRange()}}\n  {{jed getMaxRange() \"day\" \"days\"/}}\n</div>\n<div class='col2of8 line-col text-align-left'>{{include tmpl='manage/views/purposes/cell'/}}</div>\n<div class='col2of8 line-col line-actions'>\n  <div class='multibutton'>\n    <a class='button white text-ellipsis' data-order-approve>\n      <i class='fa fa-thumbs-up'></i>\n      {{if to_be_verified()}}\n      {{jed \"Verify\"/}} + {{jed \"Approve\"/}}\n      {{else}}\n      {{jed \"Approve\"/}}\n      {{/if}}\n    </a>\n    <div class='dropdown-holder inline-block'>\n      <div class='button white dropdown-toggle'>\n        <div class='arrow down'></div>\n      </div>\n      <ul class='dropdown right'>\n        <li>\n          <a class='dropdown-item' href='{{>editPath()}}'>\n            <i class='fa fa-edit'></i>\n            {{jed \"Edit\"/}}\n          </a>\n        </li>\n        <li>\n          <a class='dropdown-item red' data-order-reject>\n            <i class='fa fa-thumbs-down'></i>\n            {{jed \"Reject\"/}}\n          </a>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/contracts/reject_modal","<div class='modal medium hide fade ui-modal padding-inset-m padding-horizontal-l' role='dialog' tabindex='-1'>\n  <form action='/manage/{{current_inventory_pool_id/}}/contracts/{{>id}}/reject' method='post'>\n    {{csrf_token/}}\n    <div class='row padding-vertical-m'>\n      <div class='col1of2'>\n        <h3 class='headline-l'>{{jed \"Reject order\"/}}</h3>\n        <h3 class='headline-s light'>\n          {{>user().firstname}}\n          {{>user().lastname}}\n        </h3>\n      </div>\n      <div class='col1of2'>\n        <div class='float-right'>\n          <a aria-hidden='true' class='modal-close weak' data-dismiss='modal' title='{{jed \"close dialog\"/}}' type='button'>\n            {{jed \"Cancel\"/}}\n          </a>\n          <button class='button red' type='submit'>\n            <i class='fa fa-thumbs-down'></i>\n            {{jed 'Reject'/}}\n          </button>\n        </div>\n      </div>\n    </div>\n    <div class='row margin-top-m'>\n      <div class='separated-bottom padding-bottom-m margin-bottom-m'>\n        <div class='row margin-bottom-s emboss padding-inset-s'>\n          <p class='paragraph-s'>{{>concatenatedPurposes()}}</p>\n        </div>\n      </div>\n      <div class='modal-body'>\n        {{for groupedLinesByDateRange(true)}}\n        <div class='padding-bottom-m margin-bottom-m no-last-child-margin'>\n          <div class='row margin-bottom-s'>\n            <div class='col1of2'>\n              <p>\n                {{date start_date/}}\n                -\n                {{date end_date/}}\n              </p>\n            </div>\n            <div class='col1of2 text-align-right'>\n              <strong>{{diffDatesInDays start_date end_date/}}</strong>\n            </div>\n          </div>\n          {{for reservations}}\n          <div class='row'>\n            <div class='col1of8 text-align-center'>\n              <div class='paragraph-s'>\n                {{if subreservations}}\n                {{sum subreservations \"quantity\"/}}\n                {{else}}\n                {{> quantity}}\n                {{/if}}\n              </div>\n            </div>\n            <div class='col7of8'>\n              <div class='paragraph-s'>\n                <strong>{{>model().name()}}</strong>\n              </div>\n            </div>\n          </div>\n          {{/for}}\n        </div>\n        {{/for}}\n      </div>\n    </div>\n    <div class='row separated-top padding-top-m'>\n      <div class='col1of1 padding-bottom-s'>\n        <p>{{jed \"Write a comment. The comment will be part of the rejection e-mail.\"/}}</p>\n      </div>\n      <textarea autofocus='autofocus' class='col1of1 height-s' id='rejection-comment' name='comment'></textarea>\n    </div>\n  </form>\n</div>\n");
}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/contracts/rejected_button","{{jed \"Rejected\"/}}\n<i class='fa fa-thumbs-down'></i>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/groups/autocomplete_element","<li class='separated-bottom exclude-last-child'>\n  <a>\n    <div class='row'>\n      {{>name}}\n    </div>\n  </a>\n</li>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/groups/group_entry","<div class='row line font-size-xs'>\n  <input name='user[groups][][id]' type='hidden' value='{{>id}}'>\n  <div class='line-col col1of2 text-align-left'>\n    {{>name}}\n  </div>\n  <div class='line-col col1of2 text-align-right'>\n    <button class='button inset small' data-remove-group>{{jed \"Remove\"/}}</button>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/groups/partitions/autocomplete_element","<li class='separated-bottom exclude-last-child'>\n  <a>\n    <div class='row'>\n      {{>name()}}\n    </div>\n  </a>\n</li>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/groups/partitions/model_allocation_entry","<div class='row line font-size-xs'>\n  <input name='group[partitions_attributes][][id]' type='hidden'>\n  <input name='group[partitions_attributes][][model_id]' type='hidden' value='{{>id}}'>\n  <input name='group[partitions_attributes][][inventory_pool_id]' type='hidden' value='{{>~currentInventoryPool.id}}'>\n  <div class='line-col col3of6 text-align-left' data-model-name>\n    {{>name()}}\n  </div>\n  <div class='line-col col2of6'>\n    <div class='line-col col1of2' data-quantities>\n      <input class='width-full small text-align-center' min='1' name='group[partitions_attributes][][quantity]' type='text' value='1'>\n    </div>\n    <div class='line-col col1of2 padding-left-xs text-align-left' data-quantities>\n      / {{>availability().total_rentable}}\n    </div>\n  </div>\n  <div class='line-col col1of6 text-align-right'>\n    <button class='button inset small' data-remove-group>{{jed \"Remove\"/}}</button>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/hand_overs/deleted","<strong>\n  {{jed \"Deleted\"/}}\n  <i class='fa fa-trash'></i>\n</strong>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/hand_overs/line","<div class='line row focus-hover-thin' data-id='{{>id}}' data-type='hand_over'>\n  {{if isOverdue()}}\n  <div class='line-info red'></div>\n  {{/if}}\n  {{partial 'manage/views/users/cell' user() '{\"grid\":\"col1of5\"}'/}}\n  <div class='col1of5 line-col'>\n    {{if isOverdue()}}\n    <strong>{{diffToday date/}}</strong>\n    {{else}}\n    {{diffToday date/}}\n    {{/if}}\n  </div>\n  <div class='col1of5 line-col text-align-center' data-type='lines-cell'>{{include tmpl='manage/views/reservations/cell'/}}</div>\n  <div class='col1of5 line-col text-align-center'>\n    {{>getMaxRange()}}\n    {{jed getMaxRange() \"day\" \"days\"/}}\n  </div>\n  <div class='col1of5 line-col line-actions'>\n    <div class='multibutton'>\n      <a class='button white text-ellipsis' href='/manage/{{current_inventory_pool_id/}}/users/{{>user().id}}/hand_over'>\n        <i class='fa fa-mail-forward'></i>\n        {{jed \"Hand Over\"/}}\n      </a>\n      <div class='dropdown-holder inline-block'>\n        <div class='button white dropdown-toggle'>\n          <div class='arrow down'></div>\n        </div>\n        <ul class='dropdown right'>\n          <li>\n            <a class='dropdown-item red' data-hand-over-delete>\n              <i class='fa fa-trash'></i>\n              {{jed \"Delete\"/}}\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/inline_entries/removed_on_save_info","<div class='line-col' title='{{jed 'Removed on save'/}}'>\n  <i class='fa fa-trash'></i>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/inventory/helper/error","<div class='row emboss red text-align-center font-size-m padding-inset-s'>\n  <strong>{{>text}}</strong>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/inventory/helper/item_autocomplete_element","<li class='separated-bottom exclude-last-child'>\n  <a>\n    <div class='row text-ellipsis'>\n      <div class='col1of3'>\n        <strong>{{>inventory_code}}</strong>\n      </div>\n      <div class='col2of3 text-ellipsis' title='{{>current_location}}'>\n        {{>current_location}}\n      </div>\n    </div>\n  </a>\n</li>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/inventory/helper/success","<div class='row emboss green text-align-center font-size-m padding-inset-s'>\n  <strong>{{>text}}</strong>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/inventory/item_line","<div class='line row focus-hover-thin' data-id='{{>id}}' data-type='item'>\n  <div class='col1of5 line-col'>\n    {{if model().is_package}}\n    <div class='row'>\n      <div class='col1of2'></div>\n      <div class='col1of2'>\n        <button class='button inset small width-full' data-type='inventory-expander'>\n          {{if children().count()>0}}\n          <i class='arrow right'></i>\n          {{/if}}\n          <span>{{>children().count()}}</span>\n        </button>\n      </div>\n    </div>\n    {{/if}}\n  </div>\n  <div class='col2of5 line-col text-align-left'>\n    <div class='row'>{{>inventory_code}}</div>\n    {{if parent_id}}\n    <strong class='grey-text'>{{>model().name()}}</strong>\n    <div class='row grey-text text-ellipsis width-full' title='{{jed \"is part of a package\"/}}'>\n      {{jed \"is part of a package\"/}}\n    </div>\n    {{else}}\n    <div class='row grey-text'>\n      {{if ~additionalDataFetched}}\n      {{>current_location}}\n      {{else}}\n      {{partial \"views/loading\" {\"size\":\"micro\"}/}}\n      {{/if}}\n    </div>\n    {{/if}}\n  </div>\n  <div class='col1of5 line-col text-align-center'>\n    <strong class='darkred-text'>{{>getProblems()}}</strong>\n  </div>\n  <div class='col1of5 line-col line-actions padding-right-xs'>\n    {{if ~accessRight.atLeastRole(~currentUserRole, \"lending_manager\") }}\n    <div class='multibutton width-full text-align-right'>\n      <a class='button white text-ellipsis col4of5 negative-margin-right-xxs' href='{{>url('edit')}}' title='{{jed 'Edit Item'/}}'>\n        {{jed \"Edit Item\"/}}\n      </a>\n      <div class='dropdown-holder inline-block col1of5'>\n        <div class='button white dropdown-toggle width-full no-padding text-align-center'>\n          <div class='arrow down'></div>\n        </div>\n        <ul class='dropdown right'>\n          <li>\n            <a class='dropdown-item' href='{{>url('copy')}}'>\n              <i class='fa fa-copy'></i>\n              {{jed \"Copy Item\"/}}\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n    {{/if}}\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/inventory/license_line","<div class='line row focus-hover-thin' data-id='{{>id}}' data-type='license'>\n  <div class='col1of5 line-col'></div>\n  <div class='col2of5 line-col text-align-left'>\n    <div class='row'>{{>inventory_code}}</div>\n    <div class='row grey-text'>\n      {{if ~additionalDataFetched}}\n      {{>current_location}}\n      {{else}}\n      <span>\n        {{partial \"views/loading\" {\"size\":\"micro\"}/}}\n      </span>\n      {{/if}}\n      {{>licenseInformation()}}\n    </div>\n  </div>\n  <div class='col1of5 line-col'></div>\n  <div class='col1of5 line-col line-actions padding-right-xs'>\n    {{if ~accessRight.atLeastRole(~currentUserRole, \"lending_manager\") }}\n    <div class='multibutton width-full text-align-right'>\n      <a class='button white text-ellipsis col4of5 negative-margin-right-xxs' href='{{>url('edit')}}' title='{{jed 'Edit License'/}}'>\n        {{jed \"Edit License\"/}}\n      </a>\n      <div class='dropdown-holder inline-block col1of5'>\n        <div class='button white dropdown-toggle width-full no-padding text-align-center'>\n          <div class='arrow down'></div>\n        </div>\n        <ul class='dropdown right'>\n          <li>\n            <a class='dropdown-item' href='{{>url('copy')}}'>\n              <i class='fa fa-copy'></i>\n              {{jed \"Copy License\"/}}\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n    {{/if}}\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/inventory/line",'{{include tmpl="manage/views/inventory/"+constructor.className.toLowerCase()+"_line" /}}\n')}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/inventory/model_line","<div class='line row focus-hover-thin' data-id='{{>id}}' data-is_package='{{>is_package}}' data-type='model'>\n  <div class='col1of5 line-col'>\n    <div class='row'>\n      <div class='col1of2'>\n        <button class='button inset small width-full' data-type='inventory-expander' title='{{if is_package}}{{jed 'Packages'/}}{{else}}{{jed 'Items'/}}{{/if}}'>\n          {{if items().count()>0}}\n          <i class='arrow right'></i>\n          {{/if}}\n          <span>{{>items().count()}}</span>\n        </button>\n      </div>\n      <div class='col1of2 text-align-center height-xxs'>\n        <div class='table'>\n          <div class='table-row'>\n            <div class='table-cell vertical-align-middle'>\n              <img class='max-width-xxs max-height-xxs' src='/models/{{>id}}/image_thumb'>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class='col2of5 line-col text-align-left'>\n    {{if is_package}}\n    <div class='grey-text'>{{jed 'Package'/}}</div>\n    {{/if}}\n    <strong class='test-fix-timeline'>\n      {{> name()}}\n    </strong>\n  </div>\n  <div class='col1of5 line-col text-align-center'>\n    <span title='{{jed 'in stock'/}}'>{{> availability().in_stock}}</span>\n    /\n    <span title='{{jed 'rentable'/}}'>{{> availability().total_rentable}}</span>\n  </div>\n  <div class='col1of5 line-col line-actions padding-right-xs'>\n    {{if ~accessRight.atLeastRole(~currentUserRole, \"lending_manager\") }}\n    <div class='multibutton width-full text-align-right'>\n      <a class='button white text-ellipsis col4of5 negative-margin-right-xxs' href='{{>url('edit')}}' title='{{jed 'Edit Model'/}}'>\n        {{jed \"Edit Model\"/}}\n      </a>\n      <div class='dropdown-holder inline-block col1of5'>\n        <div class='button white dropdown-toggle width-full no-padding text-align-center'>\n          <div class='arrow down'></div>\n        </div>\n        <ul class='dropdown right'>\n          <li>\n            <a class='dropdown-item' data-model-id='{{>id}}' data-open-time-line>\n              <i class='fa fa-align-left'></i>\n              {{jed \"Timeline\"/}}\n            </a>\n          </li>\n          {{if items().count() == 0}}\n          <li>\n            <a class='dropdown-item red' data-method='delete' href='{{>url()}}'>\n              <i class='fa fa-trash'></i>\n              {{jed \"Delete\"/}}\n            </a>\n          </li>\n          {{/if}}\n        </ul>\n      </div>\n    </div>\n    {{else}}\n    <a class='button white text-ellipsis' data-model-id='{{>id}}' data-open-time-line>\n      <i class='fa fa-align-left'></i>\n      {{jed \"Timeline\"/}}\n    </a>\n    {{/if}}\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/inventory/option_line","<div class='line row focus-hover-thin' data-id='{{>id}}' data-type='option'>\n  <div class='col1of5 line-col text-align-center'>{{>inventory_code}}</div>\n  <div class='col2of5 line-col text-align-left'>\n    <strong class='test-fix-timeline'>{{> name()}}</strong>\n  </div>\n  <div class='col1of5 line-col text-align-center'>\n    {{money price/}}\n  </div>\n  <div class='col1of5 line-col line-actions padding-right-xs'>\n    {{if ~accessRight.atLeastRole(~currentUserRole, \"lending_manager\") }}\n    <a class='button white text-ellipsis' href='{{>url('edit')}}'>\n      {{jed \"Edit Option\"/}}\n    </a>\n    {{/if}}\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/inventory/software_line","<div class='line row focus-hover-thin' data-id='{{>id}}' data-is_package='{{>is_package}}' data-type='software'>\n  <div class='col1of5 line-col'>\n    <div class='row'>\n      <div class='col1of2'>\n        <button class='button inset small width-full' data-type='inventory-expander' title='{{if is_package}}{{jed 'Packages'/}}{{else}}{{jed 'Items'/}}{{/if}}'>\n          {{if licenses().count()>0}}\n          <i class='arrow right'></i>\n          {{/if}}\n          <span>{{>licenses().count()}}</span>\n        </button>\n      </div>\n      <div class='col1of2 text-align-center height-xxs'>\n        <div class='table'>\n          <div class='table-row'>\n            <div class='table-cell vertical-align-middle'>\n              <img class='max-width-xxs max-height-xxs' src='/models/{{>id}}/image_thumb'>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class='col2of5 line-col text-align-left'>\n    {{if is_package}}\n    <div class='grey-text'>{{jed 'Package'/}}</div>\n    {{/if}}\n    <strong class='test-fix-timeline'>\n      {{> name()}}\n    </strong>\n  </div>\n  <div class='col1of5 line-col text-align-center'>\n    <span title='{{jed 'in stock'/}}'>{{> availability().in_stock}}</span>\n    /\n    <span title='{{jed 'rentable'/}}'>{{> availability().total_rentable}}</span>\n  </div>\n  <div class='col1of5 line-col line-actions padding-right-xs'>\n    {{if ~accessRight.atLeastRole(~currentUserRole, \"lending_manager\") }}\n    <div class='multibutton width-full text-align-right'>\n      <a class='button white text-ellipsis col4of5 negative-margin-right-xxs' href='{{>url('edit')}}' title='{{jed 'Edit Software'/}}'>\n        {{jed \"Edit Software\"/}}\n      </a>\n      <div class='dropdown-holder inline-block col1of5'>\n        <div class='button white dropdown-toggle width-full no-padding text-align-center'>\n          <div class='arrow down'></div>\n        </div>\n        <ul class='dropdown right'>\n          <li>\n            <a class='dropdown-item' data-model-id='{{>id}}' data-open-time-line>\n              <i class='fa fa-align-left'></i>\n              {{jed \"Timeline\"/}}\n            </a>\n          </li>\n          {{if licenses().count() == 0}}\n          <li>\n            <a class='dropdown-item red' data-method='delete' href='{{>url()}}'>\n              <i class='fa fa-trash'></i>\n              {{jed \"Delete\"/}}\n            </a>\n          </li>\n          {{/if}}\n        </ul>\n      </div>\n    </div>\n    {{else}}\n    <a class='button white text-ellipsis' data-model-id='{{>id}}' data-open-time-line>\n      <i class='fa fa-align-left'></i>\n      {{jed \"Timeline\"/}}\n    </a>\n    {{/if}}\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/inventory_pools/admin/holiday_entry","<div class='row line font-size-xs' data-index='{{>i}}'>\n  <input name='inventory_pool[holidays_attributes][{{>i}}][name]' type='hidden' value='{{>name}}'>\n  <input name='inventory_pool[holidays_attributes][{{>i}}][start_date]' type='hidden' value='{{>start_date}}'>\n  <input name='inventory_pool[holidays_attributes][{{>i}}][end_date]' type='hidden' value='{{>end_date}}'>\n  <div class='line-col col1of4 text-align-left'>\n    <strong>{{>name}}</strong>\n  </div>\n  <div class='line-col col2of4 text-align-left'>\n    {{>start_date}} - {{>end_date}}\n  </div>\n  <div class='line-col col1of4'>\n    <button class='button inset small' data-remove-holiday>{{jed \"Delete\"/}}</button>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/inventory_pools/daily/workload","<div class='row margin-top-l padding-bottom-m'>\n  <div class='text-align-right margin-right-m'>\n    <span class='badge medium padding-inset-xs text-shadow' style='background-color: #999999'>{{jed \"Take Backs\"/}}</span>\n    <span class='badge medium padding-inset-xs text-shadow' style='background-color: #cccccc'>{{jed \"Hand Overs\"/}}</span>\n  </div>\n</div>\n<div class='bar-chart'></div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/inventory_pools/latest_reminder/tooltip","<div class='row width-l'>\n  <div class='paragraph-s'>\n    <strong>{{dateAndTime created_at/}}</strong>\n    {{>title}}\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/autocomplete_element","<li class='separated-bottom exclude-last-child width-xxl'>\n  <a class='row{{if hasProblems()}} light-red{{/if}}' title='{{>inventory_code}}{{if location}} {{>location}}{{/if}}'>\n    <div class='col1of4 text-ellipsis'>\n      <strong>{{>inventory_code}}</strong>\n    </div>\n    {{if type == 'Item'}}\n    <div class='col3of4 text-ellipsis'>\n      {{>location}}\n    </div>\n    {{else}}\n    <div class='col3of4'>\n      <strong>{{>serial_number}}</strong>\n    </div>\n    {{/if}}\n  </a>\n</li>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/field","<div id='{{>~field.id}}'>\n  <div class='{{if ~fieldColor}}{{>~fieldColor}} {{/if}}{{if ~field.hidden}}hidden {{/if}}field row emboss padding-inset-xs margin-vertical-xxs margin-right-xs' data-editable='{{>~field.isEditable(~itemData)}}' data-id='{{>~field.id}}' data-required='{{>~field.required}}' data-type='field'>\n    <div class='row'>\n      <div class='col1of2 padding-vertical-xs' data-type='key'>\n        {{if !~field.visibility_dependency_field_id && (~removeable || (~hideable && !~field.required) )}}\n        <a class='font-size-m link grey padding-inset-xs' data-placement='top' data-toggle='tooltip' data-type='remove-field' title='{{jed 'Hide this field from all item forms'/}}'>\n          <i class='fa fa-times-circle'></i>\n        </a>\n        {{/if}}\n        <strong class='font-size-m inline-block'>\n          {{>~field.getLabel()}}\n          {{if ~field.required}}*{{/if}}\n        </strong>\n      </div>\n      <div class='col1of2' data-type='value'>\n        {{if (~writeable && !~itemData) || (~writeable && ~field.isEditable(~itemData))}}\n        {{include tmpl=\"manage/views/items/fields/writeable/\"+~field.type/}}\n        {{else}}\n        <div class='padding-vertical-xs font-size-m' data-value='{{>~field.getValue(~itemData, ~field.attribute)}}'>\n          {{include tmpl=\"manage/views/items/fields/readonly/\"+~field.type/}}\n        </div>\n        {{/if}}\n      </div>\n    </div>\n    {{if ~field.id == 'inventory_code' && ~itemData && !~itemData.created_at}}\n    <div class='row text-align-right' id='switch'>\n      <button class='button small green' data-inventory_code='{{>~itemData.inventory_code}}'>\n        {{jed 'last used +1'/}}\n      </button>\n      <button class='button small white' data-inventory_code='{{>~itemData.lowest_proposed_inventory_code}}'>\n        {{jed 'fill up gaps'/}}\n      </button>\n      <button class='button small white' data-inventory_code='{{>~itemData.highest_proposed_inventory_code}}'>\n        {{jed 'assign highest available'/}}\n      </button>\n    </div>\n    {{/if}}\n    {{if ~field.id == 'attachments'}}\n    <div class='list-of-lines even padding-bottom-xxs'>\n      {{if ~writeable && ~field.isEditable(~itemData)}}\n      {{partial 'manage/views/items/fields/writeable/partials/uploaded_attachment' ~itemData.attachments/}}\n      {{else}}\n      {{partial 'manage/views/items/fields/readonly/partials/uploaded_attachment' ~itemData.attachments/}}\n      {{/if}}\n    </div>\n    {{/if}}\n  </div>\n</div>\n<script>\n  (function() {\n    $(document).ready(function() {\n      if (!window.defined_once) {\n        $('[data-toggle=\"tooltip\"]').tooltip();\n        $('body').on('click', '#switch button[data-inventory_code]', function() {\n          $('input[name=\"item[inventory_code]\"]').val($(this).data('inventory_code'));\n          $('#switch button[data-inventory_code]').removeClass('green').addClass('white');\n          $(this).removeClass('white').addClass('green');\n          return false;\n        });\n        return window.defined_once = true;\n      }\n    });\n  \n  }).call(this);\n</script>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/readonly/attachment","")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/readonly/autocomplete-search","{{if ~field.getValue(~itemData, ~field.attribute)}}\n<span>{{>~field.getItemValueLabel(~field.item_value_label, ~itemData)}}</span>\n{{/if}}\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/readonly/autocomplete","{{if ~field.getValue(~itemData, ~field.attribute)}}\n<span>{{>~field.getValueLabel(~field.values, ~field.getValue(~itemData, ~field.attribute))}}</span>\n{{/if}}\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/readonly/date","{{if ~field.getValue(~itemData, ~field.attribute)}}\n<span>{{date ~field.getValue(~itemData, ~field.attribute)/}}</span>\n{{/if}}\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/readonly/partials/uploaded_attachment","<div class='row line font-size-xs focus-hover-thin' data-type='inline-entry'>\n  <div class='line-col col7of10 text-align-left'>\n    <a class='blue' href='{{>public_filename}}' target='_blank'>\n      {{>filename}}\n    </a>\n  </div>\n  <div class='line-col col3of10 text-align-right'></div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/readonly/radio","{{for ~field.values}}\n{{if ~field.getValue(~itemData, ~field.attribute) == value}}\n<span>{{jed label/}}</span>\n{{/if}}\n{{/for}}\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/readonly/select","{{for ~field.values}}\n{{if ~field.getValue(~itemData, ~field.attribute) == value}}\n<span>{{jed label/}}</span>\n{{/if}}\n{{/for}}\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/readonly/text","{{if ~field.getValue(~itemData, ~field.attribute)}}\n<span>{{>~field.getValue(~itemData, ~field.attribute)}}</span>\n{{/if}}\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/readonly/textarea","{{if ~field.getValue(~itemData, ~field.attribute)}}\n<span>{{>~field.getValue(~itemData, ~field.attribute)}}</span>\n{{/if}}\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/writeable/attachment","<button class='button inset width-full' data-type='select'>\n  {{jed \"Select File\"/}}\n</button>\n<input autocomplete='false' class='invisible height-full width-full position-absolute-topleft' type='file'>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/writeable/autocomplete-search","<label class='row'>\n  {{if ~field.getValue(~itemData, ~field.attribute, true)}}\n  <input name='{{>~field.getFormName()}}' type='hidden' value='{{>~field.getValue(~itemData, ~field.attribute, true)}}'>\n  <input autocomplete='off' class='has-addon width-full' data-autocomplete_blur_on_select='true' data-autocomplete_display_attribute='{{>~field.display_attr}}' data-autocomplete_display_attribute_ext='{{>~field.display_attr_ext}}' data-autocomplete_element_tmpl='views/autocomplete/element' data-autocomplete_search_attr='{{>~field.search_attr}}' data-autocomplete_value_attribute='{{>~field.value_attr}}' data-autocomplete_value_target='{{>~field.getFormName()}}' data-type='autocomplete' data-url='{{>~field.search_path}}' placeholder='{{>~field.getLabel()}}' title='{{>~field.getLabel()}}' type='text' value='{{>~field.getItemValueLabel(~field.item_value_label, ~itemData)}}'>\n  {{else}}\n  <input name='{{>~field.getFormName()}}' type='hidden'>\n  <input autocomplete='off' class='has-addon width-full' data-autocomplete_blur_on_select='true' data-autocomplete_display_attribute='{{>~field.display_attr}}' data-autocomplete_display_attribute_ext='{{>~field.display_attr_ext}}' data-autocomplete_element_tmpl='views/autocomplete/element' data-autocomplete_search_attr='{{>~field.search_attr}}' data-autocomplete_value_attribute='{{>~field.value_attr}}' data-autocomplete_value_target='{{>~field.getFormName()}}' data-type='autocomplete' data-url='{{>~field.search_path}}' placeholder='{{>~field.getLabel()}}' title='{{>~field.getLabel()}}' type='text'>\n  {{/if}}\n  <div class='addon transparent'>\n    <i class='arrow down'></i>\n  </div>\n</label>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/writeable/autocomplete","<label class='row'>\n  {{if ~field.extensible}}\n  <input data-type='extended-value' name='{{>~field.getExtendedKeyFormName()}}' type='hidden' value='{{>~field.getValue(~itemData, ~field.extended_key, true)}}'>\n  {{/if}}\n  {{if ~field.getValue(~itemData, ~field.attribute, true)}}\n  <input name='{{>~field.getFormName()}}' type='hidden' value='{{>~field.getValue(~itemData, ~field.attribute, true)}}'>\n  <input autocomplete='off' class='has-addon width-full' data-autocomplete_blur_on_select='true' data-autocomplete_data='{{stringify ~field.values/}}' data-autocomplete_display_attribute='label' data-autocomplete_element_tmpl='views/autocomplete/element' data-autocomplete_extended_key_target='{{>~field.getExtendedKeyFormName()}}' data-autocomplete_extensible='{{>~field.extensible}}' data-autocomplete_search_on_focus='true' data-autocomplete_value_target='{{>~field.getFormName()}}' data-type='autocomplete' placeholder='{{>~field.getLabel()}}' title='{{>~field.getLabel()}}' type='text' value='{{>~field.getValueLabel(~field.values, ~field.getValue(~itemData, ~field.attribute, true))}}'>\n  {{else}}\n  <input name='{{>~field.getFormName()}}' type='hidden'>\n  <input autocomplete='off' class='has-addon width-full' data-autocomplete_blur_on_select='true' data-autocomplete_data='{{stringify ~field.values/}}' data-autocomplete_display_attribute='label' data-autocomplete_element_tmpl='views/autocomplete/element' data-autocomplete_extended_key_target='{{>~field.getExtendedKeyFormName()}}' data-autocomplete_extensible='{{>~field.extensible}}' data-autocomplete_search_on_focus='true' data-autocomplete_value_target='{{>~field.getFormName()}}' data-type='autocomplete' placeholder='{{>~field.getLabel()}}' title='{{>~field.getLabel()}}' type='text'>\n  {{/if}}\n  <div class='addon transparent'>\n    <i class='arrow down'></i>\n  </div>\n</label>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/writeable/checkbox","<div class='padding-inset-xxs'>\n  {{:~setvar(\"values\", ~field.getValue(~itemData, ~field.attribute, true))}}\n  {{for ~field.values}}\n  <label class='padding-inset-xxs'>\n    {{if ~getvar(\"values\") != null && ~getvar(\"values\").indexOf(value) >= 0}}\n    <input checked name='{{>~field.getFormName(~field.attribute, ~field.form_name, 'asArray')}}' type='checkbox' value='{{>value}}'>\n    {{else}}\n    <input name='{{>~field.getFormName(~field.attribute, ~field.form_name, 'asArray')}}' type='checkbox' value='{{>value}}'>\n    {{/if}}\n    <span class='font-size-m'>{{jed label/}}</span>\n  </label>\n  {{/for}}\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/writeable/composite","<div class='row'>\n  <div class='col7of8 padding-vertical-xs' id='remaining-total-quantity'></div>\n  <div class='col1of8'>\n    <button class='button inset float-right' id='add-inline-entry'>\n      <i class='fa fa-plus'></i>\n    </button>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/writeable/composite_partials/license_quantity_allocation","<div class='row line font-size-xs focus-hover-thin' data-type='inline-entry'>\n  <div class='line-col col1of10 text-align-center'>Quantity:</div>\n  <div class='line-col col2of10'>\n    <input class='width-full small text-align-center' data-quantity-allocation='true' name='{{>field.getFormName()}}[][quantity]' type='text' value='{{if allocation}}{{>allocation.quantity}}{{/if}}'>\n  </div>\n  <div class='line-col col1of10 text-align-center'>Location:</div>\n  <div class='line-col col5of10'>\n    <input class='width-full small text-align-center' data-room-allocation='true' name='{{>field.getFormName()}}[][room]' type='text' value='{{if allocation}}{{>allocation.room}}{{/if}}'>\n  </div>\n  <div class='line-col col1of10'>\n    <button class='button inset small' data-remove>Remove</button>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/writeable/date","<input name='{{>~field.getFormName()}}' type='hidden' value='{{>~field.getValue(~itemData, ~field.attribute, true)}}'>\n{{if ~field.getValue(~itemData, ~field.attribute, true)}}\n<input autocomplete='off' class='width-full' data-type='datepicker' type='text' value='{{date ~field.getValue(~itemData, ~field.attribute, true)/}}'>\n{{else}}\n<input autocomplete='off' class='width-full' data-type='datepicker' type='text'>\n{{/if}}\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/writeable/partials/attachment_inline_entry","<div class='row line font-size-xs focus-hover-thin' data-new data-type='inline-entry'>\n  <div class='line-col text-align-center' title='{{jed 'File has to be uploaded on save'/}}'>\n    <i class='fa fa-cloud-upload'></i>\n  </div>\n  <div class='line-col col7of10 text-align-left'>\n    {{>name}}\n  </div>\n  <div class='line-col col3of10 text-align-right'>\n    <button class='button small inset' data-remove type='button'>\n      {{jed \"Remove\"/}}\n    </button>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/writeable/partials/uploaded_attachment","<div class='row line font-size-xs focus-hover-thin' data-type='inline-entry'>\n  <input name='item[attachments_attributes][{{>id}}][id]' type='hidden' value='{{>id}}'>\n  <input name='item[attachments_attributes][{{>id}}][_destroy]' type='hidden'>\n  <div class='line-col col7of10 text-align-left'>\n    <a class='blue' href='{{>public_filename}}' target='_blank'>\n      {{>filename}}\n    </a>\n  </div>\n  <div class='line-col col3of10 text-align-right'>\n    <button class='button small inset' data-remove type='button'>\n      {{jed \"Remove\"/}}\n    </button>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/writeable/radio","<div class='padding-inset-xxs'>\n  {{for ~field.values}}\n  <label class='padding-inset-xxs'>\n    {{if ~field.getValue(~itemData, ~field.attribute, true) == value}}\n    <input checked name='{{>~field.getFormName()}}' type='radio' value='{{>value}}'>\n    {{else}}\n    <input name='{{>~field.getFormName()}}' type='radio' value='{{>value}}'>\n    {{/if}}\n    <span class='font-size-m'>{{jed label/}}</span>\n  </label>\n  {{/for}}\n</div>\n");
}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/writeable/select","<select class='width-full' name='{{>~field.getFormName()}}'>\n  {{for ~field.values}}\n  {{if ~field.getValue(~itemData, ~field.attribute, true) == value}}\n  <option selected value='{{>value}}'>\n    {{jed label/}}\n  </option>\n  {{else}}\n  <option value='{{>value}}'>\n    {{jed label/}}\n  </option>\n  {{/if}}\n  {{/for}}\n</select>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/writeable/text","{{if ~field.getValue(~itemData, ~field.attribute, true)}}\n<input autocomplete='off' class='width-full' name='{{>~field.getFormName()}}' type='text' value='{{>~field.getValue(~itemData, ~field.attribute, true)}}'>\n{{else}}\n<input autocomplete='off' class='width-full' name='{{>~field.getFormName()}}' type='text'>\n{{/if}}\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/fields/writeable/textarea","<textarea autocomplete='off' class='width-full' name='{{>~field.getFormName()}}' rows='5' value=''>{{>~field.getValue(~itemData, ~field.attribute, true)}}</textarea>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/form","<div class='col1of2 padding-right-xs' id='item-form-left-side'></div>\n<div class='col1of2' id='item-form-right-side'></div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/group_of_fields","<section class='padding-bottom-l'>\n  {{if name}}\n  <h2 class='headline-m padding-bottom-m'>\n    {{jed name/}}\n  </h2>\n  {{/if}}\n  <div class='row group-of-fields'></div>\n</section>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/inspect_dialog","<div class='modal medium hide fade ui-modal padding-inset-m padding-horizontal-l' role='dialog' tabindex='-1'>\n  <form>\n    <div class='row padding-vertical-m'>\n      <div class='col1of2'>\n        <h3 class='headline-l'>\n          {{jed \"Inspect Item\"/}}\n          {{>inventory_code}}\n        </h3>\n        <h4 class='headline-m light'>{{>model().name()}}</h4>\n      </div>\n      <div class='col1of2'>\n        <div class='float-right'>\n          <a aria-hidden='true' class='modal-close weak' data-dismiss='modal' title='{{jed \"close dialog\"/}}' type='button'>\n            {{jed \"Cancel\"/}}\n          </a>\n          <button class='button green' type='submit'>\n            {{jed \"Save\"/}}\n          </button>\n        </div>\n      </div>\n      <div class='row padding-vertical-m'>\n        <div class='row padding-top-m'>\n          <label class='col1of3 padding-right-s'>\n            <div class='row'>{{jed 'Status'/}}</div>\n            <div class='row'>\n              <select class='width-full' name='is_broken'>\n                {{if is_broken}}\n                <option value='false'>{{jed 'Functional'/}}</option>\n                <option selected value='true'>{{jed 'Defective'/}}</option>\n                {{else}}\n                <option selected value='false'>{{jed 'Functional'/}}</option>\n                <option value='true'>{{jed 'Defective'/}}</option>\n                {{/if}}\n              </select>\n            </div>\n          </label>\n          <label class='col1of3 padding-right-s'>\n            <div class='row'>{{jed 'Completeness'/}}</div>\n            <div class='row'>\n              <select class='width-full' name='is_incomplete'>\n                {{if is_incomplete}}\n                <option value='false'>{{jed 'Complete'/}}</option>\n                <option selected value='true'>{{jed 'Incomplete'/}}</option>\n                {{else}}\n                <option selected value='false'>{{jed 'Complete'/}}</option>\n                <option value='true'>{{jed 'Incomplete'/}}</option>\n                {{/if}}\n              </select>\n            </div>\n          </label>\n          <div class='col1of3 padding-right-s'>\n            <div class='row'>{{jed 'Borrowable'/}}</div>\n            <div class='row'>\n              <select class='width-full' name='is_borrowable'>\n                {{if is_borrowable}}\n                <option selected value='true'>{{jed 'Borrowable'/}}</option>\n                <option value='false'>{{jed 'Unborrowable'/}}</option>\n                {{else}}\n                <option value='true'>{{jed 'Borrowable'/}}</option>\n                <option selected value='false'>{{jed 'Unborrowable'/}}</option>\n                {{/if}}\n              </select>\n            </div>\n          </div>\n        </div>\n        <div class='row padding-top-m'>\n          <label class='col1of1 padding-right-s'>\n            <div class='row'>{{jed 'Status note'/}}</div>\n            <div class='row'>\n              <textarea class='width-full' name='status_note'>{{> status_note}}</textarea>\n            </div>\n          </label>\n        </div>\n      </div>\n    </div>\n  </form>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/items/line","<div class='line row focus-hover-thin{{if !~currentInventoryPool.isOwnerOrResponsibleFor(#view.data)}} grayed-out{{/if}}' data-id='{{>id}}' data-type='item'>\n  <div class='col1of8 line-col'>\n    <strong>{{>inventory_code}}</strong>\n  </div>\n  <div class='col3of8 line-col text-align-left'>\n    {{>model().name()}}\n    {{if ~currentInventoryPool.isOwnerOrResponsibleFor(#view.data) }}\n    <strong class='block darkred-text'>{{>getProblems()}}</strong>\n    {{/if}}\n  </div>\n  <div class='col2of8 line-col text-align-left padding-right-s'>\n    {{>current_location}}\n  </div>\n  <div class='col2of8 line-col line-actions padding-right-xs'>\n    {{if ~currentInventoryPool.isOwnerOrResponsibleFor(#view.data) && ~accessRight.atLeastRole(~currentUserRole, \"lending_manager\") }}\n    <div class='multibutton'>\n      <a class='button white' href='{{>url('edit')}}' title='{{jed 'Edit Item'/}}'>\n        {{jed \"Edit Item\"/}}\n      </a>\n      <div class='dropdown-holder inline-block'>\n        <div class='button white dropdown-toggle'>\n          <div class='arrow down'></div>\n        </div>\n        <ul class='dropdown right'>\n          <li>\n            <a class='dropdown-item' href='{{>url('copy')}}'>\n              <i class='fa fa-copy'></i>\n              {{jed \"Copy Item\"/}}\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n    {{/if}}\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/licenses/line","<div class='line row focus-hover-thin{{if !~currentInventoryPool.isOwnerOrResponsibleFor(#view.data)}} grayed-out{{/if}}' data-id='{{>id}}' data-type='license'>\n  <div class='col1of8 line-col'>\n    <strong>{{>inventory_code}}</strong>\n  </div>\n  <div class='col3of8 line-col text-align-left'>\n    {{>model().name()}}\n    {{if ~currentInventoryPool.isOwnerOrResponsibleFor(#view.data) }}\n    <strong class='block darkred-text'>{{>getProblems()}}</strong>\n    {{/if}}\n  </div>\n  <div class='col2of8 line-col text-align-left padding-right-s'>\n    {{>current_location}}\n  </div>\n  <div class='col2of8 line-col line-actions padding-right-xs'>\n    {{if ~currentInventoryPool.isOwnerOrResponsibleFor(#view.data) && ~accessRight.atLeastRole(~currentUserRole, \"lending_manager\") }}\n    <div class='multibutton'>\n      <a class='button white' href='{{>url('edit')}}' title='{{jed 'Edit License'/}}'>\n        {{jed \"Edit License\"/}}\n      </a>\n      <div class='dropdown-holder inline-block'>\n        <div class='button white dropdown-toggle'>\n          <div class='arrow down'></div>\n        </div>\n        <ul class='dropdown right'>\n          <li>\n            <a class='dropdown-item' href='{{>url('copy')}}'>\n              <i class='fa fa-copy'></i>\n              {{jed \"Copy License\"/}}\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n    {{/if}}\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/lists/loading","<div class='height-s'></div>\n<img class='margin-horziontal-auto margin-top-xxl margin-bottom-xxl' src='/assets/loading-4eebf3d6e9139e863f2be8c14cad4638df21bf050cea16117739b3431837ee0a.gif'>\n<div class='height-s'></div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/lists/no_results","<div class='height-s'></div>\n<h3 class='headline-s light padding-inset-xl text-align-center'>\n  {{jed \"No entries found\"/}}\n</h3>\n<div class='height-s'></div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/lists/page","<span class='page' data-page='{{> ~page}}'>\n  {{for ~entries}}\n  <div class='line'></div>\n  {{/for}}\n</span>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/models/explorative_add_line","<div class='line row focus-hover-thin{{if availability().maxAvailableForGroups(~startDate, ~endDate, ~groupIds) <= 0}} grayed-out{{/if}}' data-id='{{>id}}' data-type='model'>\n  <div class='col1of10 line-col no-padding text-align-center'>\n    <div class='table'>\n      <div class='table-row'>\n        <div class='table-cell vertical-align-middle'>\n          <img class='max-width-xxs max-height-xxs' src='/models/{{>id}}/image_thumb'>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class='col5of10 line-col text-align-left'>\n    {{if is_package}}\n    <div class='grey-text'>{{jed 'Package'/}}</div>\n    {{/if}}\n    <strong>\n      {{> name()}}\n    </strong>\n  </div>\n  <div class='col2of10 line-col no-padding text-align-center'>\n    <span title='{{jed 'Available for borrower'/}}'>{{>availability().maxAvailableForGroups(~startDate, ~endDate, ~groupIds)}}</span>\n    <span title='{{jed 'Available in total'/}}'>({{>availability().maxAvailableInTotal(~startDate, ~endDate)}})</span>\n    /\n    <span title='{{jed 'Borrowable items'/}}'>{{>availability().total_rentable}}</span>\n  </div>\n  <div class='col2of10 line-col line-actions padding-right-s text-align-center'>\n    <a class='button white' data-type='select'>\n      {{jed \"Select\"/}}\n    </a>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/models/form/accessory_inline_entry","<div class='row line font-size-xs focus-hover-thin' data-new data-type='inline-entry'>\n  <input name='model[accessories_attributes][{{>~uid}}][inventory_pool_toggle]' type='hidden' value='0,{{current_inventory_pool_id/}}'>\n  <label class='line-col col1of10 text-align-center no-padding'>\n    <input autocomplete='off' checked name='model[accessories_attributes][{{>~uid}}][inventory_pool_toggle]' type='checkbox' value='1,{{current_inventory_pool_id/}}'>\n  </label>\n  <div class='line-col col6of10 text-align-left'>\n    {{>name}}\n    <input name='model[accessories_attributes][{{>~uid}}][name]' type='hidden' value='{{>name}}'>\n  </div>\n  <div class='line-col col3of10 text-align-right'>\n    <button class='button small inset' data-remove>Remove</button>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/models/form/allocation_inline_entry","<div class='row line font-size-xs focus-hover-thin' data-new data-type='inline-entry'>\n  <input name='model[partitions_attributes][{{>~uid}}][inventory_pool_id]' type='hidden' value='{{current_inventory_pool_id/}}'>\n  <input name='model[partitions_attributes][{{>~uid}}][group_id]' type='hidden' value='{{>id}}'>\n  <div class='line-col col3of5 text-align-left' data-name='{{>name}}'>\n    {{>name}}\n  </div>\n  <div class='line-col col1of5 text-align-center'>\n    <input autocomplete='off' class='width-xs small text-align-center' name='model[partitions_attributes][{{>~uid}}][quantity]' type='text' value='1'>\n  </div>\n  <div class='line-col col1of5 text-align-right'>\n    <button class='button small inset' data-remove>Remove</button>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/models/form/attachment_inline_entry","<div class='row line font-size-xs focus-hover-thin' data-new data-type='inline-entry'>\n  <div class='line-col text-align-center' title='{{jed 'File has to be uploaded on save'/}}'>\n    <i class='fa fa-cloud-upload'></i>\n  </div>\n  <div class='line-col col7of10 text-align-left'>\n    {{>name}}\n  </div>\n  <div class='line-col col3of10 text-align-right'>\n    <button class='button small inset' data-remove type='button'>Remove</button>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/models/form/category_inline_entry","<div class='row line font-size-xs focus-hover-thin' data-new data-type='inline-entry'>\n  <input data-disable-on-remove name='model[category_ids][]' type='hidden' value='{{>id}}'>\n  <div class='line-col col2of3 text-align-left'>\n    {{>name}}\n  </div>\n  <div class='line-col col1of3 text-align-right'>\n    <button class='button small inset' data-remove>Remove</button>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/models/form/compatible_inline_entry","<div class='row line font-size-xs focus-hover-thin' data-new data-type='inline-entry'>\n  <input data-disable-on-remove name='model[compatible_ids][]' type='hidden' value='{{>id}}'>\n  <div class='line-col col2of3 text-align-left'>\n    {{>name()}}\n  </div>\n  <div class='line-col col1of3 text-align-right'>\n    <button class='button small inset' data-remove type='button'>Remove</button>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/models/form/package_inline_entry","<div class='row line font-size-xs focus-hover-thin' data-new data-type='inline-entry'>\n  {{for data}}\n  <input name='model[packages][{{>~uid}}]{{>name}}' type='hidden' value='{{>value}}'>\n  {{/for}}\n  {{for children}}\n  <input name='model[packages][{{>~uid}}][children][id][]' type='hidden' value='{{>id}}'>\n  {{/for}}\n  <div class='line-col col1of4 text-align-left'>\n    {{jed 'Prepackaged'/}}\n  </div>\n  <div class='line-col col1of4 text-align-left'>\n    <span class='grey-text'>{{jed 'not yet saved'/}}</span>\n  </div>\n  <div class='line-col col1of2 text-align-right'>\n    <button class='button small inset' data-remove title='Remove' type='button'>\n      <i class='fa fa-trash'></i>\n    </button>\n    <button class='button small inset' data-edit-package type='button'>Edit</button>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/models/form/package_inline_entry/updated_package_form_data","{{for data}}\n<input name='model[packages][{{>~uid}}]{{>name}}' type='hidden' value='{{>value}}'>\n{{/for}}\n{{for children}}\n<input name='model[packages][{{>~uid}}][children][id][]' type='hidden' value='{{>id}}'>\n{{/for}}\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/models/form/property_inline_entry","<div class='row line font-size-xs focus-hover-thin' data-type='inline-entry' date-new>\n  <div class='line-col col1of10 text-align-left no-padding text-align-center cursor-move' data-type='sort-handle'>\n    <i class='fa fa-resize-vertical'></i>\n  </div>\n  <div class='line-col col4of10 no-padding'>\n    <input class='small width-full' name='model[properties_attributes][][key]' type='text'>\n  </div>\n  <div class='line-col col4of10'>\n    <input class='small width-full' name='model[properties_attributes][][value]' type='text'>\n  </div>\n  <div class='line-col col1of10 text-align-right'>\n    <button class='button small inset' data-remove title='Remove'>\n      <i class='fa fa-trash'></i>\n    </button>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/models/line","<div class='line row focus-hover-thin' data-id='{{>id}}' data-is_package='{{>is_package}}' data-type='model'>\n  <div class='col1of10 line-col text-align-center no-padding'>\n    <div class='table'>\n      <div class='table-row'>\n        <div class='table-cell vertical-align-middle'>\n          <img class='max-width-xxs max-height-xxs' src='/models/{{>id}}/image_thumb'>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class='col4of10 line-col text-align-left'>\n    {{if is_package}}\n    <div class='grey-text'>{{jed 'Package'/}}</div>\n    {{/if}}\n    <strong class='test-fix-timeline'>\n      {{> name()}}\n    </strong>\n  </div>\n  <div class='col3of10 line-col text-align-center'>\n    <span title='{{jed 'in stock'/}}'>{{> availability().in_stock}}</span>\n    /\n    <span title='{{jed 'rentable'/}}'>{{> availability().total_rentable}}</span>\n  </div>\n  <div class='col2of8 line-col line-actions padding-right-xs'>\n    <div class='multibutton width-full text-align-right'>\n      <a class='button white text-ellipsis col4of5 negative-margin-right-xxs' href='{{>url('edit')}}' title='{{jed 'Edit Model'/}}'>\n        {{jed \"Edit Model\"/}}\n      </a>\n      <div class='dropdown-holder inline-block col1of5'>\n        <div class='button white dropdown-toggle width-full no-padding text-align-center'>\n          <div class='arrow down'></div>\n        </div>\n        <ul class='dropdown right'>\n          <li>\n            <a class='dropdown-item' data-model-id='{{>id}}' data-open-time-line>\n              <i class='fa fa-align-left'></i>\n              {{jed \"Timeline\"/}}\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/models/packages/item","<div class='row emboss padding-bottom-xxs margin-bottom-xxs' data-id='{{>id}}' data-new data-type='inline-entry'>\n  <div class='row padding-inset-xxs'>\n    <div class='col1of4 padding-left-s padding-top-xs'>\n      <strong class='font-size-m inline-block'>\n        {{>inventory_code}}\n      </strong>\n    </div>\n    <div class='col2of4 padding-top-xs'>\n      {{>model().name()}}\n    </div>\n    <div class='col1of4 text-align-right'>\n      <button class='button small inset' data-remove type='button'>Remove</button>\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/models/packages/item_autocomplete_element","<li class='separated-bottom exclude-last-child'>\n  <a>\n    <div class='row text-ellipsis'>\n      <div class='col1of3'>\n        <strong>{{>inventory_code}}</strong>\n      </div>\n      <div class='col2of3'>\n        {{>model().name()}}\n      </div>\n    </div>\n  </a>\n</li>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/models/packages/missing_data_error","<div class='padding-horizontal-m padding-bottom-m'>\n  <div class='row emboss red text-align-center font-size-m padding-inset-s'>\n    <strong>{{jed 'Please provide all required fields'/}}</strong>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/models/packages/no_items_error","<div class='padding-horizontal-m padding-bottom-m'>\n  <div class='row emboss red text-align-center font-size-m padding-inset-s'>\n    <strong>{{jed 'You can not create a package without any item'/}}</strong>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/models/packages/package_dialog","<div class='modal medium hide fade ui-modal padding-vertical-m' role='dialog' tabindex='-1'>\n  <div class='row padding-vertical-m padding-horizontal-l'>\n    <div class='col1of2'>\n      <h3 class='headline-l'>{{jed \"Package\"/}}</h3>\n    </div>\n    <div class='col1of2'>\n      <div class='float-right'>\n        <a aria-hidden='true' class='modal-close weak' data-dismiss='modal' title='{{jed \"close dialog\"/}}' type='button'>\n          {{jed \"Cancel\"/}}\n        </a>\n        <button class='button green' id='save-package' type='button'>\n          {{jed \"Save Package\"/}}\n        </button>\n      </div>\n    </div>\n  </div>\n  <div class='hidden' id='notifications'></div>\n  <div class='modal-body row padding-horizontal-l'>\n    <div class='margin-bottom-m'>\n      <h2 class='headline-m padding-bottom-m'>{{jed 'Items'/}}</h2>\n      <div class='row emboss margin-vertical-xxs margin-right-xs'>\n        <div class='row padding-inset-xs'>\n          <div class='col1of2 padding-vertical-xs'>\n            <strong class='font-size-m inline-block'>{{jed 'Add item'/}}</strong>\n          </div>\n          <div class='col1of2'>\n            <div class='row'>\n              <input autocomplete='off' class='width-full has-addon' data-barcode-scanner-target id='search-item' type='text'>\n              <div class='addon transparent'>\n                <span class='arrow down'></span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class='row' id='items'></div>\n    </div>\n    <form class='padding-top-s' id='item-form'>\n      <div id='flexible-fields'>\n        <div class='height-s'></div>\n        <img class='margin-horziontal-auto margin-top-xxl margin-bottom-xxl' src='/assets/loading-4eebf3d6e9139e863f2be8c14cad4638df21bf050cea16117739b3431837ee0a.gif'>\n        <div class='height-s'></div>\n      </div>\n    </form>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/models/timeline_modal","<div class='modal large hide fade ui-modal padding-inset-m padding-horizontal-l' role='dialog' tabindex='-1'>\n  <div class='row padding-vertical-m'>\n    <div class='col1of2'>\n      <h3 class='headline-l'>{{jed \"Availability Timeline\"/}}</h3>\n      <h3 class='headline-s light'>{{>name()}}</h3>\n    </div>\n    <div class='col1of2'>\n      <div class='float-right'>\n        <a aria-hidden='true' class='modal-close weak' data-dismiss='modal' title='{{jed \"close dialog\"/}}' type='button'>\n          {{jed \"Cancel\"/}}\n        </a>\n        <button aria-hidden='true' class='button modal-close text-ellipsis weak white' data-dismiss='modal' title='{{jed \"close dialog\"/}}' type='button'>\n          {{jed \"Close\"/}}\n        </button>\n      </div>\n    </div>\n  </div>\n  <div class='row margin-top-m'>\n    <div class='modal-body no-padding'>\n      <div class='row'>\n        <div class='position-absolute-topright width-full text-align-center'>\n          <div id='loading'>\n            <div class='height-m'></div>\n            {{partial \"views/loading\"/}}\n          </div>\n        </div>\n        <iframe height='500px' id='timeline' src='/manage/{{current_inventory_pool_id/}}/models/{{>id}}/timeline' width='100%'></iframe>\n      </div>\n      <div class='row text-align-right'>\n        <a class='button white modal-close' href='/manage/{{current_inventory_pool_id/}}/models/{{>id}}/timeline' target='_blank'>\n          <i class='fa fa-resize-full'></i>\n        </a>\n      </div>\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/models/tooltip","<div class='row width-xxl font-size-m'>\n  {{if image_url}}\n  <p>\n    <img class='max-size-xxs margin-horziontal-auto' src='{{>image_url/}}'>\n  </p>\n  {{/if}}\n  <div class='row'>\n    <div class='col1of3 text-align-right padding-right-s'>\n      {{jed \"Product\"/}}:\n    </div>\n    <div class='col2of3'>\n      <strong>{{>product}}</strong>\n    </div>\n  </div>\n  <div class='row'>\n    <div class='col1of3 text-align-right padding-right-s'>\n      {{jed \"Version\"/}}:\n    </div>\n    <div class='col2of3'>\n      <strong>{{>version}}</strong>\n    </div>\n  </div>\n  <div class='row'>\n    <div class='col1of3 text-align-right padding-right-s'>\n      {{jed \"Manufacturer\"/}}:\n    </div>\n    <div class='col2of3'>\n      <strong>{{>manufacturer}}</strong>\n    </div>\n  </div>\n  <div class='row'>\n    <div class='col1of3 text-align-right padding-right-s'>\n      {{jed \"Description\"/}}:\n    </div>\n    <div class='col2of3'>\n      <strong>{{>description}}</strong>\n    </div>\n  </div>\n  <div class='row'>\n    <div class='col1of3 text-align-right padding-right-s'>\n      {{jed \"Internal Description\"/}}:\n    </div>\n    <div class='col2of3'>\n      <strong>{{>internal_description}}</strong>\n    </div>\n  </div>\n  <div class='row'>\n    <div class='col1of3 text-align-right padding-right-s'>\n      {{jed \"Technical Details\"/}}:\n    </div>\n    <div class='col2of3'>\n      <strong>{{>technical_detail}}</strong>\n    </div>\n  </div>\n  <div class='row'>\n    <div class='col1of3 text-align-right padding-right-s'>\n      {{jed \"Important notes for hand over\"/}}:\n    </div>\n    <div class='col2of3'>\n      <strong>{{>hand_over_note}}</strong>\n    </div>\n  </div>\n  <div class='row'>\n    <div class='col1of3 text-align-right padding-right-s'>\n      {{jed \"Accessories\"/}}:\n    </div>\n    <div class='col2of3'>\n      <strong>{{>accessory_names}}</strong>\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/options/line","<div class='line row focus-hover-thin' data-id='{{>id}}' data-type='option'>\n  <div class='col1of5 line-col text-align-center'>{{>inventory_code}}</div>\n  <div class='col2of5 line-col text-align-left'>\n    <strong>{{> name()}}</strong>\n  </div>\n  <div class='col1of5 line-col text-align-center'>\n    {{money price/}}\n  </div>\n  <div class='col1of5 line-col line-actions padding-right-xs'>\n    <a class='button white text-ellipsis' href='{{>url('edit')}}'>\n      {{jed \"Edit Option\"/}}\n    </a>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/purposes/cell","{{if concatenatedPurposes().length > 60}}\n<span class='tooltip' data-tooltip-template='manage/views/purposes/tooltip' title='{{>concatenatedPurposes()}}'>\n  {{truncate concatenatedPurposes() 60 \"...\"/}}\n</span>\n{{else}}\n{{> concatenatedPurposes()}}\n{{/if}}\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/purposes/tooltip","<div class='width-xl padding-inset-s'>\n  <p class='paragraph-s'>{{>content}}</p>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/reservations/add/adding","<div class='emboss blue padding-inset-s'>\n  <p class='paragraph-s'>\n    <img class='margin-right-s max-width-micro' src='/assets/loading-4eebf3d6e9139e863f2be8c14cad4638df21bf050cea16117739b3431837ee0a.gif'>\n    <strong>\n      {{jed \"Adding item\"/}}\n    </strong>\n  </p>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/reservations/add/autocomplete_element","<li class='separated-bottom exclude-last-child'>\n  <a class='row{{if available}}{{else}} light-red{{/if}}' title='{{>name}}'>\n    <div class='row'>\n      <div class='col3of4' title='{{>name}}'>\n        <strong class='wrap'>\n          {{>name}}\n        </strong>\n      </div>\n      <div class='col1of4 text-align-right'>\n        <div class='row'>\n          {{if availability}}\n          {{>availability}}\n          {{/if}}\n        </div>\n        <div class='row'>\n          <span class='grey-text'>{{>type}}</span>\n        </div>\n      </div>\n    </div>\n  </a>\n</li>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/reservations/assign/autocomplete_element","<li class='separated-bottom exclude-last-child width-xl'>\n  <a>\n    <div class='row'>\n      <div class='col1of3'>\n        <strong>\n          {{>inventoryCode}}\n        </strong>\n      </div>\n      <div class='col2of3 text-ellipsis' title='{{>name}}'>\n        <span class='grey-text'>{{>name}}</span>\n      </div>\n    </div>\n  </a>\n</li>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/reservations/cell",'{{>quantity()}}\n{{jed quantity() "Item" "Items"/}}\n')}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/reservations/explorative_add_dialog","<div class='modal fade ui-modal medium' role='dialog' tabindex='-1'>\n  <div class='modal-header row padding-bottom-s'>\n    <div class='col4of5'>\n      <h2 class='headline-l'>{{jed 'Models'/}} {{jed 'by browsing categories'/}}</h2>\n      <h3 class='headline-m light'>({{date startDate/}} - {{date endDate/}})</h3>\n    </div>\n    <div class='col1of5 text-align-right'>\n      <div class='modal-close'>{{jed \"Cancel\"/}}</div>\n    </div>\n  </div>\n  <div class='modal-body separated-top'>\n    <div class='table'>\n      <div class='table-row'>\n        <div class='col1of4 table-cell separated-right padding-inset-m' id='categories'>\n          <div class='row padding-inset-s'>\n            <input autocomplete='off' class='small' id='category-search' placeholder='{{jed 'Search category'/}}' type='text'>\n          </div>\n          <div id='category-root'></div>\n          <div id='category-current'></div>\n          <div class='row padding-bottom-s' id='category-list'>\n            <div class='height-xs'></div>\n            <img class='margin-horziontal-auto margin-top-xxl margin-bottom-xxl' src='/assets/loading-4eebf3d6e9139e863f2be8c14cad4638df21bf050cea16117739b3431837ee0a.gif'>\n          </div>\n        </div>\n        <div class='table-cell col3of4 list-of-lines even min-height-l' id='models'>\n          <div class='height-s'></div>\n          <img class='margin-horziontal-auto margin-top-xxl margin-bottom-xxl' src='/assets/loading-4eebf3d6e9139e863f2be8c14cad4638df21bf050cea16117739b3431837ee0a.gif'>\n          <div class='height-s'></div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class='modal-footer'></div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/reservations/grouped_lines","<div class='emboss deep padding-bottom-s margin-bottom-m' data-selected-lines-container>\n  <div class='row'>\n    <div class='col1of2 padding-vertical-s'>\n      <label class='padding-inset-s inline'>\n        <input autocomplete='off' data-select-lines type='checkbox'>\n      </label>\n      <p class='paragraph-s inline'>\n        {{day start_date/}}\n        {{date start_date/}}\n        -\n        {{day end_date/}}\n        {{date end_date/}}\n      </p>\n    </div>\n    <div class='col1of2 padding-inset-s text-align-right'>\n      <p class='paragraph-s inline'>\n        {{diffDatesInDays start_date end_date/}}\n      </p>\n    </div>\n  </div>\n  <div class='row'>\n    {{partial ~linePartial reservations #view.ctx/}}\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/reservations/grouped_lines_with_action_date",'<h3 class=\'headline-s padding-inset-s\'>\n  {{if ~moment(date).endOf("day").diff(~moment().endOf("day"), "days") == 0}}\n  <strong>{{jed "Today"/}}</strong>\n  {{else}}\n  {{day date/}}\n  {{date date/}}\n  {{/if}}\n</h3>\n{{partial "manage/views/reservations/grouped_lines" groups #view.ctx/}}\n')}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/reservations/hand_over_line","{{if model_id}}\n{{partial 'manage/views/reservations/hand_over_line/item_line' #view.data #view.ctx/}}\n{{else option_id}}\n{{partial 'manage/views/reservations/hand_over_line/option_line' #view.data #view.ctx/}}\n{{/if}}\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/reservations/hand_over_line/assigned_item","<input autocomplete='off' class='small width-full has-addon text-align-center' data-assign-item disabled id='assigned-item-{{>id}}' type='text' value='{{>item().inventory_code}}'>\n<label class='addon small transparent no-padding' data-remove-assignment for='assigned-item-{{>id}}'>\n  <span class='link grey padding-inset-xs vertical-align-middle'>\n    <i class='fa fa-times-circle'></i>\n  </span>\n</label>\n");
}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/reservations/hand_over_line/item_line","<div class='line light row focus-hover-thin' data-id='{{>id}}' data-line-type='item_line'>\n  <div class='{{if ~renderAvailability && anyProblems()}}line-info red{{/if}}'></div>\n  <div class='line-col padding-left-xs'>\n    <div class='row'>\n      <div class='col1of4'>\n        <label class='padding-inset-s'>\n          <input autocomplete='off' data-select-line type='checkbox'>\n        </label>\n      </div>\n    </div>\n  </div>\n  <div class='col2of10 line-col text-align-center'>\n    <div class='row'>\n      {{if item()}}\n      {{partial 'manage/views/reservations/hand_over_line/assigned_item' #view.data/}}\n      {{else}}\n      {{partial 'manage/views/reservations/hand_over_line/unassigned_item' #view.data/}}\n      {{/if}}\n    </div>\n  </div>\n  <div class='col4of10 line-col text-align-left'>\n    <strong class='test-fix-timeline' data-id='{{>model().id}}' data-type='model-cell'>\n      {{>model().name()}}\n    </strong>\n    {{if item() && item().children().all().length}}\n    <ul style='font-size: 0.8em; list-style-type: disc; margin-left: 1.5em;'>\n      {{for item().children().all()}}\n      <li>\n        {{>to_s}}\n      </li>\n      {{/for}}\n    </ul>\n    {{/if}}\n    {{if model().accessory_names && model().accessory_names.length}}\n    <br>\n    <span>{{>model().accessory_names}}</span>\n    {{/if}}\n    {{if model().hand_over_note}}\n    <br>\n    <span class='grey-text'>{{>model().hand_over_note}}</span>\n    {{/if}}\n  </div>\n  <div class='col1of10 line-col text-align-center'>\n    {{if purpose_id}}\n    <div class='tooltip' data-tooltip-template='manage/views/purposes/tooltip' title='{{>purpose().description}}'>\n      <i class='fa fa-comment grey'></i>\n    </div>\n    {{/if}}\n  </div>\n  <div class='col1of10 line-col text-align-center'>\n    {{if ~renderAvailability && anyProblems()}}\n    <div class='emboss red padding-inset-xxs-alt text-align-center tooltip' data-tooltip-data='{{JSON getProblems()/}}' data-tooltip-template='manage/views/reservations/problems_tooltip'>\n      <strong>{{>getProblems().length}}</strong>\n    </div>\n    {{/if}}\n  </div>\n  <div class='col2of10 line-col line-actions padding-left-xxs padding-right-s'>\n    <div class='multibutton'>\n      <button class='button white text-ellipsis' data-edit-lines data-ids='{{JSON [id]/}}'>{{jed \"Change entry\"/}}</button>\n      <div class='dropdown-holder inline-block'>\n        <div class='button white dropdown-toggle'>\n          <div class='arrow down'></div>\n        </div>\n        <ul class='dropdown right'>\n          <li>\n            <a class='dropdown-item' data-model-id='{{>model().id}}' data-open-time-line>\n              <i class='fa fa-align-left'></i>\n              {{jed \"Timeline\"/}}\n            </a>\n          </li>\n          <li>\n            <a class='dropdown-item' data-swap-model>\n              <i class='fa fa-exchange'></i>\n              {{jed \"Swap Model\"/}}\n            </a>\n          </li>\n          <li>\n            <a class='dropdown-item red' data-destroy-line>\n              <i class='fa fa-trash'></i>\n              {{jed \"Delete\"/}}\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/reservations/hand_over_line/option_line","<div class='line light row focus-hover-thin' data-id='{{>id}}' data-line-type='option_line'>\n  <div class='line-info{{if ~renderAvailability && anyProblems()}} red{{/if}}'></div>\n  <div class='line-col padding-left-xs'>\n    <div class='row'>\n      <div class='col1of4'>\n        <label class='padding-inset-s'>\n          <input autocomplete='off' data-select-line type='checkbox'>\n        </label>\n      </div>\n    </div>\n  </div>\n  <div class='col1of10 line-col'>\n    <input class='small width-full text-align-center' data-line-quantity type='text' value='{{>quantity}}'>\n  </div>\n  <div class='col1of10 line-col text-align-center'>\n    <span class='grey-text'>{{>option().inventory_code}}</span>\n  </div>\n  <div class='col4of10 line-col text-align-left'>\n    <strong class='test-fix-timeline'>{{>option().name()}}</strong>\n  </div>\n  <div class='col1of10 line-col text-align-center'>\n    {{if purpose_id}}\n    <div class='tooltip' data-tooltip-template='manage/views/purposes/tooltip' title='{{>purpose().description}}'>\n      <i class='fa fa-comment grey'></i>\n    </div>\n    {{/if}}\n  </div>\n  <div class='col1of10 line-col text-align-center'>\n    {{if ~renderAvailability && anyProblems()}}\n    <div class='emboss red padding-inset-xxs-alt text-align-center tooltip' data-tooltip-data='{{JSON getProblems()/}}' data-tooltip-template='manage/views/reservations/problems_tooltip'>\n      <strong>{{>getProblems().length}}</strong>\n    </div>\n    {{else ~renderAvailability && !anyProblems()}}\n    <div class='padding-inset-xxs-alt text-align-center'>\n      <i class='fa fa-check'></i>\n    </div>\n    {{/if}}\n  </div>\n  <div class='col2of10 line-col line-actions padding-left-xxs padding-right-s'>\n    <div class='multibutton'>\n      <button class='button white text-ellipsis' data-edit-lines data-ids='{{JSON [id]/}}'>{{jed 'Change entry'/}}</button>\n      <div class='dropdown-holder inline-block'>\n        <div class='button white dropdown-toggle'>\n          <div class='arrow down'></div>\n        </div>\n        <ul class='dropdown right'>\n          <li>\n            <a class='dropdown-item' data-model-id='{{>model().id}}' data-open-time-line>\n              <i class='fa fa-align-left'></i>\n              {{jed \"Timeline\"/}}\n            </a>\n          </li>\n          <li>\n            <a class='dropdown-item red' data-destroy-line>\n              <i class='fa fa-trash'></i>\n              {{jed \"Delete\"/}}\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/reservations/hand_over_line/unassigned_item","<form data-assign-item-form>\n  <input autocomplete='off' class='small width-full has-addon text-align-center' data-assign-item id='assigned-item-{{>id}}' type='text'>\n  <label class='addon small transparent padding-right-s' for='assigned-item-{{>id}}'>\n    <div class='arrow down'></div>\n  </label>\n</form>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/reservations/order_line","<div class='order-line line light row focus-hover-thin' data-ids='{{JSON ids/}}'>\n  <div class='line-info{{if ~renderAvailability && anyProblems()}} red{{/if}}'></div>\n  <div class='line-col padding-left-xs'>\n    <div class='row'>\n      <div class='col1of4'>\n        <label class='padding-inset-s'>\n          <input autocomplete='off' data-select-line type='checkbox'>\n        </label>\n      </div>\n    </div>\n  </div>\n  <div class='col1of10 line-col text-align-center'>\n    <span>\n      {{if subreservations}}\n      {{sum subreservations \"quantity\"/}}\n      {{else}}\n      {{>quantity}}\n      {{/if}}\n    </span>\n    {{if ~renderAvailability}}\n    <span class='grey-text'>\n      /\n      {{if subreservations}}\n      {{>model().availability().withoutLines(subreservations).maxAvailableForGroups(start_date, end_date, user().groupIds)}}\n      {{else}}\n      {{>model().availability().withoutLines([#view.data]).maxAvailableForGroups(start_date, end_date, user().groupIds)}}\n      {{/if}}\n    </span>\n    {{/if}}\n  </div>\n  <div class='col6of10 line-col text-align-left'>\n    <strong class='test-fix-timeline' data-id='{{>model().id}}' data-type='model-cell'>\n      {{>model().name()}}\n    </strong>\n  </div>\n  <div class='col1of10 line-col text-align-left padding-horizontal-m'>\n    {{if ~renderAvailability && anyProblems()}}\n    <div class='emboss red padding-inset-xxs-alt text-align-center tooltip' data-tooltip-data='{{JSON getProblems()/}}' data-tooltip-template='manage/views/reservations/problems_tooltip'>\n      <strong>{{>getProblems().length}}</strong>\n    </div>\n    {{/if}}\n  </div>\n  <div class='col2of10 line-col line-actions'>\n    <div class='multibutton'>\n      <button class='button white text-ellipsis' data-edit-lines data-ids='{{JSON ids/}}'>\n        {{jed \"Change entry\"/}}\n      </button>\n      <div class='dropdown-holder inline-block'>\n        <div class='button white dropdown-toggle'>\n          <div class='arrow down'></div>\n        </div>\n        <ul class='dropdown right'>\n          <li>\n            <a class='dropdown-item' data-model-id='{{>model_id}}' data-open-time-line>\n              <i class='fa fa-align-left'></i>\n              {{jed \"Timeline\"/}}\n            </a>\n          </li>\n          <li>\n            <a class='dropdown-item' data-swap-model>\n              <i class='fa fa-exchange'></i>\n              {{jed \"Swap Model\"/}}\n            </a>\n          </li>\n          <li>\n            <a class='dropdown-item red' data-destroy-lines data-ids='{{JSON ids/}}'>\n              <i class='fa fa-trash'></i>\n              {{jed \"Delete\"/}}\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/reservations/problems_tooltip","<div class='width-m'>\n  {{for content}}\n  <div class='padding-vertical-xxs'>\n    <div class='padding-inset-s emboss'>\n      <strong class='font-size-m'>{{>message}}</strong>\n    </div>\n  </div>\n  {{/for}}\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/reservations/removing","<div class='emboss blue padding-inset-s'>\n  <p class='paragraph-s'>\n    <img class='margin-right-s max-width-micro' src='/assets/loading-4eebf3d6e9139e863f2be8c14cad4638df21bf050cea16117739b3431837ee0a.gif'>\n    <strong>\n      {{jed \"Removing items\"/}}\n    </strong>\n  </p>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/reservations/take_back_line","{{if model_id}}\n{{partial 'manage/views/reservations/take_back_line/item_line' #view.data #view.ctx/}}\n{{else option_id}}\n{{partial 'manage/views/reservations/take_back_line/option_line' #view.data #view.ctx/}}\n{{/if}}\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/reservations/take_back_line/item_line","<div class='line light row focus-hover-thin' data-id='{{>id}}' data-line-type='item_line'>\n  <div class='line-info{{if ~renderAvailability && anyProblems()}} red{{/if}}'></div>\n  <div class='line-col padding-left-xs'>\n    <div class='row'>\n      <div class='col1of4'>\n        <label class='padding-inset-s'>\n          <input autocomplete='off' data-select-line type='checkbox'>\n        </label>\n      </div>\n    </div>\n  </div>\n  <div class='col2of10 line-col text-align-center'>\n    <div class='row'>{{>item().inventory_code}}</div>\n  </div>\n  <div class='col4of10 line-col text-align-left'>\n    <strong class='test-fix-timeline' data-id='{{>model().id}}' data-type='model-cell'>\n      {{>model().name()}}\n    </strong>\n    {{if model().accessory_names && model().accessory_names.length}}\n    <br>\n    <span>{{>model().accessory_names}}</span>\n    {{/if}}\n  </div>\n  <div class='col1of10 line-col text-align-center'>\n    {{if purpose_id}}\n    <div class='tooltip' data-tooltip-template='manage/views/purposes/tooltip' title='{{>purpose().description}}'>\n      <i class='fa fa-comment grey'></i>\n    </div>\n    {{/if}}\n  </div>\n  <div class='col1of10 line-col text-align-center'>\n    {{if ~renderAvailability && anyProblems()}}\n    <div class='emboss red padding-inset-xxs-alt text-align-center tooltip' data-tooltip-data='{{JSON getProblems()/}}' data-tooltip-template='manage/views/reservations/problems_tooltip'>\n      <strong>{{>getProblems().length}}</strong>\n    </div>\n    {{else ~renderAvailability && !anyProblems() && item()}}\n    <div class='padding-inset-xxs-alt text-align-center'>\n      <i class='fa fa-check'></i>\n    </div>\n    {{/if}}\n  </div>\n  <div class='col2of10 line-col line-actions padding-left-xxs padding-right-s'>\n    <div class='multibutton'>\n      <button class='button white text-ellipsis' data-edit-lines data-ids='{{JSON [id]/}}'>{{jed \"Change entry\"/}}</button>\n      <div class='dropdown-holder inline-block'>\n        <div class='button white dropdown-toggle'>\n          <div class='arrow down'></div>\n        </div>\n        <ul class='dropdown right'>\n          <li>\n            <a class='dropdown-item' href='{{>contract().url()}}' target='_blank'>\n              <i class='fa fa-file-alt'></i>\n              {{jed \"Contract\"/}}\n              {{>contract().compact_id}}\n            </a>\n          </li>\n          <li>\n            <a class='dropdown-item' data-model-id='{{>model().id}}' data-open-time-line>\n              <i class='fa fa-align-left'></i>\n              {{jed \"Timeline\"/}}\n            </a>\n          </li>\n          <li>\n            <a class='dropdown-item' data-inspect-item data-item-id='{{>item_id}}'>\n              <i class='fa fa-search'></i>\n              {{jed \"Inspect\"/}}\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/reservations/take_back_line/option_line","<div class='line light row focus-hover-thin' data-id='{{>id}}' data-line-type='option_line'>\n  <div class='line-info{{if ~renderAvailability && anyProblems()}} red{{/if}}'></div>\n  <div class='line-col padding-left-xs'>\n    <div class='row'>\n      <div class='col1of4'>\n        <label class='padding-inset-s'>\n          <input autocomplete='off' data-select-line type='checkbox'>\n        </label>\n      </div>\n    </div>\n  </div>\n  <div class='col1of10 line-col'>\n    <div class='row table'>\n      <div class='table-row'>\n        <div class='col2of3 table-cell vertical-align-middle line-height-xxl'>\n          <input autocomplete='off' class='small width-full text-align-center' data-quantity-returned inputmode='numeric' type='text'>\n        </div>\n        <div class='col1of3 table-cell vertical-align-middle line-height-xxl'>\n          <span>/{{>quantity}}</span>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class='col1of10 line-col text-align-center'>\n    <span class='grey-text'>{{>option().inventory_code}}</span>\n  </div>\n  <div class='col4of10 line-col text-align-left'>\n    <strong class='test-fix-timeline'>{{>option().name()}}</strong>\n  </div>\n  <div class='col1of10 line-col text-align-center'>\n    {{if purpose_id}}\n    <div class='tooltip' data-tooltip-template='manage/views/purposes/tooltip' title='{{>purpose().description}}'>\n      <i class='fa fa-comment grey'></i>\n    </div>\n    {{/if}}\n  </div>\n  <div class='col1of10 line-col text-align-center'>\n    {{if ~renderAvailability && anyProblems()}}\n    <div class='emboss red padding-inset-xxs-alt text-align-center tooltip' data-tooltip-data='{{JSON getProblems()/}}' data-tooltip-template='manage/views/reservations/problems_tooltip'>\n      <strong>{{>getProblems().length}}</strong>\n    </div>\n    {{else ~renderAvailability && !anyProblems()}}\n    <div class='padding-inset-xxs-alt text-align-center'>\n      <i class='fa fa-check'></i>\n    </div>\n    {{/if}}\n  </div>\n  <div class='col2of10 line-col line-actions padding-left-xxs padding-right-s'>\n    <div class='multibutton'>\n      <button class='button white text-ellipsis' data-edit-lines data-ids='{{JSON [id]/}}'>{{jed \"Change entry\"/}}</button>\n      <div class='dropdown-holder inline-block'>\n        <div class='button white dropdown-toggle'>\n          <div class='arrow down'></div>\n        </div>\n        <ul class='dropdown right'>\n          <li>\n            <a class='dropdown-item' href='{{>contract().url()}}' target='_blank'>\n              <i class='fa fa-file-alt'></i>\n              {{jed \"Contract\"/}}\n              {{>contract().compact_id}}\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/reservations/tooltip","<div class='min-width-l'>\n  {{for groupedLinesByDateRange(true)}}\n  <div class='exclude-last-child padding-bottom-m margin-bottom-m no-last-child-margin'>\n    <div class='row margin-bottom-s'>\n      <div class='col1of2'>\n        <span>\n          {{date start_date/}}\n          -\n          {{date end_date/}}\n        </span>\n      </div>\n      <div class='col1of2 text-align-right'>\n        <strong>{{diffDatesInDays start_date end_date/}}</strong>\n      </div>\n    </div>\n    {{for reservations}}\n    <div class='row padding-top-xs'>\n      <div class='col1of8 text-align-center'>\n        <div class='paragraph-s line-height-s'>\n          {{if ~quantity}}\n          {{>~quantity}}\n          {{else subreservations}}\n          {{sum subreservations \"quantity\"/}}\n          {{else}}\n          {{>quantity}}\n          {{/if}}\n        </div>\n      </div>\n      <div class='col7of8'>\n        <div class='paragraph-s line-height-s text-ellipsis width-full padding-right-s'>\n          <strong>{{>model().name()}}</strong>\n        </div>\n      </div>\n    </div>\n    {{/for}}\n  </div>\n  {{/for}}\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/software/line","<div class='line row focus-hover-thin' data-id='{{>id}}' data-is_package='{{>is_package}}' data-type='model'>\n  <div class='col1of10 line-col text-align-center no-padding'>\n    <div class='table'>\n      <div class='table-row'>\n        <div class='table-cell vertical-align-middle'>\n          <img class='max-width-xxs max-height-xxs' src='/models/{{>id}}/image_thumb'>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class='col4of10 line-col text-align-left'>\n    {{if is_package}}\n    <div class='grey-text'>{{jed 'Package'/}}</div>\n    {{/if}}\n    <strong class='test-fix-timeline'>\n      {{> name()}}\n    </strong>\n  </div>\n  <div class='col3of10 line-col text-align-center'>\n    <span title='{{jed 'in stock'/}}'>{{> availability().in_stock}}</span>\n    /\n    <span title='{{jed 'rentable'/}}'>{{> availability().total_rentable}}</span>\n  </div>\n  <div class='col2of8 line-col line-actions padding-right-xs'>\n    <div class='multibutton width-full text-align-right'>\n      <a class='button white text-ellipsis col4of5 negative-margin-right-xxs' href='{{>url('edit')}}' title='{{jed 'Edit Software'/}}'>\n        {{jed \"Edit Software\"/}}\n      </a>\n      <div class='dropdown-holder inline-block col1of5'>\n        <div class='button white dropdown-toggle width-full no-padding text-align-center'>\n          <div class='arrow down'></div>\n        </div>\n        <ul class='dropdown right'>\n          <li>\n            <a class='dropdown-item' data-model-id='{{>id}}' data-open-time-line>\n              <i class='fa fa-align-left'></i>\n              {{jed \"Timeline\"/}}\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(){$.views.tags({current_inventory_pool_id:function(){return App.InventoryPool.current.id}})}.call(this),function(){$.views.tags({dailyPath:function(){return App.InventoryPool.current.url("daily")}})}.call(this),function(t){t.views.templates("manage/views/take_backs/line","<div class='line row focus-hover-thin' data-id='{{>id}}' data-type='take_back'>\n  {{if isOverdue()}}\n  <div class='line-info red'></div>\n  {{/if}}\n  {{partial 'manage/views/users/cell' user() '{\"grid\":\"col1of5\"}'/}}\n  <div class='col1of5 line-col'>\n    {{if isOverdue()}}\n    <strong>{{diffToday date/}}</strong>\n    {{else}}\n    {{diffToday date/}}\n    {{/if}}\n  </div>\n  <div class='col1of5 line-col text-align-center' data-type='lines-cell'>{{include tmpl='manage/views/reservations/cell'/}}</div>\n  {{if isOverdue()}}\n  <div class='col1of5 line-col latest-reminder-cell text-align-center' data-user-id='{{>user().id}}' data-visit-id='{{>id}}'>\n    {{jed \"Latest reminder\"/}}\n    <i class='fa fa-envelope-alt'></i>\n  </div>\n  {{else}}\n  <div class='col1of5 line-col text-align-center'>\n    {{>getMaxRange()}}\n    {{jed getMaxRange() \"day\" \"days\"/}}\n  </div>\n  {{/if}}\n  <div class='col1of5 line-col line-actions'>\n    {{if isOverdue()}}\n    <div class='multibutton'>\n      <a class='button white text-ellipsis' href='/manage/{{>inventory_pool_id}}/users/{{>user().id}}/take_back'>\n        <i class='fa fa-mail-reply'></i>\n        {{jed \"Take Back\"/}}\n      </a>\n      <div class='dropdown-holder inline-block'>\n        <div class='button white dropdown-toggle'>\n          <div class='arrow down'></div>\n        </div>\n        <ul class='dropdown right'>\n          <li>\n            <a class='dropdown-item' data-send-takeback-reminder data-user-id='{{>user().id}}'>\n              <i class='fa fa-envelope'></i>\n              {{jed \"Send reminder\"/}}\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n    {{else}}\n    <a class='button white text-ellipsis' href='/manage/{{>inventory_pool_id}}/users/{{>user().id}}/take_back'>\n      <i class='fa fa-mail-reply'></i>\n      {{jed \"Take Back\"/}}\n    </a>\n    {{/if}}\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/take_backs/reminder_send","<strong>{{jed \"Reminder sent\"/}}</strong>\n<i class='fa fa-envelope'></i>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/templates/models/autocomplete_element","<li class='separated-bottom exclude-last-child'>\n  <a>\n    <div class='row'>\n      {{>name()}}\n    </div>\n  </a>\n</li>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/templates/models/model_allocation_entry","<div class='row line font-size-xs' data-new data-type='inline-entry'>\n  <input name='template[model_links_attributes][][model_id]' type='hidden' value='{{>id}}'>\n  <div class='line-col col2of6 no-padding'>\n    <div class='line-col col1of2' data-quantities>\n      <input autocomplete='off' class='width-full small text-align-center' max='{{>availability().total_rentable}}' min='1' name='template[model_links_attributes][][quantity]' type='text' value='1'>\n    </div>\n    <div class='line-col col1of2 padding-left-xs text-align-left' data-quantities>\n      / {{>availability().total_rentable}}\n    </div>\n  </div>\n  <div class='line-col col3of6 text-align-left' data-model-name>\n    {{>name()}}\n  </div>\n  <div class='line-col col1of6 text-align-right'>\n    <button class='button inset small' data-remove>{{jed \"Remove\"/}}</button>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/templates/upload/image_inline_entry","<div class='row line font-size-xs focus-hover-thin' data-new data-type='inline-entry'>\n  <div class='line-col text-align-center' title='{{jed 'File has to be uploaded on save'/}}'>\n    <i class='fa fa-cloud-upload'></i>\n  </div>\n  <div class='line-col col1of10 text-align-center'>\n    <img class='max-height-xxs max-width-xxs'>\n  </div>\n  <div class='line-col col6of10 text-align-left'>\n    {{>name}}\n  </div>\n  <div class='line-col col3of10 text-align-right'>\n    <button class='button small inset' data-remove type='button'>Remove</button>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/templates/upload/upload_errors_dialog","<div class='modal medium hide fade ui-modal padding-inset-m padding-horizontal-l' role='dialog' tabindex='-1'>\n  <div class='row padding-vertical-m'>\n    <div class='col2of3'>\n      <h3 class='headline-l'>{{jed \"Upload problems\"/}}</h3>\n      <h3 class='headline-s light'>\n        {{>headlineMessage}}\n      </h3>\n    </div>\n    <div class='col1of3'>\n      <div class='float-right'>\n        <a class='button white' href='{{>url}}'>\n          {{>buttonLabel}}\n        </a>\n      </div>\n    </div>\n  </div>\n  <div class='modal-body row margin-top-m'>\n    <div class='emboss error padding-inset-s'>\n      <p class='paragraph-s'>{{>errors}}</p>\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/templates/users/autocomplete_element","<li class='separated-bottom exclude-last-child'>\n  <a>\n    <div class='row'>\n      {{>name()}}\n    </div>\n  </a>\n</li>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/templates/users/user_inline_entry","<div class='row line font-size-xs'>\n  <input name='{{>~paramName}}' type='hidden' value='{{>id}}'>\n  <div class='line-col col5of6 text-align-left' data-user-name>\n    {{>name()}}\n  </div>\n  <div class='line-col col1of6 text-align-right'>\n    <button class='button inset small' data-remove-user>{{jed \"Remove\"/}}</button>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/users/autocomplete_element","<li class='separated-bottom exclude-last-child'>\n  <a class='row' title='{{>firstname}} {{>lastname}}'>\n    <div class='row text-ellipsis'>\n      <strong>\n        {{>firstname}}\n        {{>lastname}}\n      </strong>\n    </div>\n    <div class='row text-ellipsis'>\n      {{>address}}{{>city}}\n    </div>\n  </a>\n</li>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/users/cell","<div class='line-col {{>~grid}}'>\n  <strong data-address='{{>address}}' data-badge_id='{{>badge_id}}' data-city='{{>city}}' data-email='{{>email}}' data-firstname='{{>firstname}}' data-id='{{>id}}' data-image_url='{{>image_url}}' data-lastname='{{>lastname}}' data-phone='{{>phone}}' data-type='user-cell' data-zip='{{>zip}}'>\n    {{>firstname}} {{>lastname}}\n    {{if isSuspended()}}\n    <span class='darkred-text'>{{jed \"Suspended\"/}}!</span>\n    {{/if}}\n  </strong>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/users/hand_over/no_handover_found","<div class='emboss padding-inset-s'>\n  <p class='paragraph-s'>\n    <strong>\n      {{jed \"No hand overs found\"/}}\n    </strong>\n  </p>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/users/hand_over_dialog","<div class='modal fade ui-modal medium' role='dialog' tabindex='-1'>\n  <div class='modal-header row'>\n    <div class='col3of5'>\n      <h2 class='headline-l'>{{jed itemsCount \"Hand over of %s item\" \"Hand over of %s items\" itemsCount/}}</h2>\n      <h3 class='headline-m light'>\n        {{>user.firstname}} {{>user.lastname}}\n      </h3>\n    </div>\n    <div class='col2of5 text-align-right'>\n      <div class='modal-close'>{{jed \"Cancel\"/}}</div>\n      <button class='button green' data-hand-over>\n        <i class='fa fa-mail-forward'></i>\n        {{jed \"Hand Over\"/}}\n      </button>\n    </div>\n  </div>\n  <div class='row margin-top-s padding-horizontal-l'>\n    <div class='separated-bottom padding-bottom-m margin-bottom-m'>\n      <p class='emboss red padding-inset-s hidden paragraph-s margin-bottom-s' id='error'>\n        <strong></strong>\n      </p>\n      {{if user.isDelegation()}}\n      <div class='row margin-bottom-l'>\n        <div class='col1of3' id='contact-person'>\n          <input autocomplete='off' autofocus='autofocus' class='width-full' data-barcode-scanner-target data-prevent-barcode-scanner-submit id='user-id' placeholder='{{jed 'Contact person'/}} {{jed 'Name / ID'/}}' type='text'>\n          <div id='selected-user'></div>\n        </div>\n      </div>\n      {{/if}}\n      {{if purpose}}\n      <div class='row margin-bottom-s emboss padding-inset-s'>\n        <div class='col3of4'>\n          <p class='paragraph-s'>{{>purpose}}</p>\n        </div>\n        <div class='col1of4 text-align-right'>\n          {{if ~showAddPurpose}}\n          <button class='button inset' id='add-purpose'>{{jed 'Add Purpose'/}}</button>\n          {{/if}}\n        </div>\n      </div>\n      {{/if}}\n      <div class='{{if purpose}}hidden{{/if}}' id='purpose-input'>\n        <div class='row padding-bottom-s'>\n          <p>{{jed \"Please provide a purpose...\"/}}</p>\n        </div>\n        <textarea class='row height-xs' id='purpose' name='purpose'></textarea>\n      </div>\n    </div>\n    <div class='modal-body'>\n      {{for groupedLines}}\n      <div class='padding-bottom-m margin-bottom-m no-last-child-margin'>\n        <div class='row margin-bottom-s'>\n          <div class='col1of2'>\n            <p>\n              {{date start_date/}}\n              -\n              {{date end_date/}}\n            </p>\n          </div>\n          <div class='col1of2 text-align-right'>\n            <strong>{{diffDatesInDays start_date end_date/}}</strong>\n          </div>\n        </div>\n        {{for reservations}}\n        <div class='row'>\n          <div class='col1of8 text-align-center'>\n            <div class='paragraph-s'>\n              {{if subreservations}}\n              {{sum subreservations \"quantity\"/}}\n              {{else}}\n              {{> quantity}}\n              {{/if}}\n            </div>\n          </div>\n          <div class='col7of8'>\n            <div class='paragraph-s'>\n              <strong>{{>model().name()}}</strong>\n            </div>\n          </div>\n        </div>\n        {{/for}}\n      </div>\n      {{/for}}\n    </div>\n    <div class='row separated-top padding-top-m padding-bottom-m'>\n      <div class='col1of1 padding-bottom-s'>\n        <p>{{jed \"Write a note... the note will be part of the contract\"/}}</p>\n      </div>\n      <textarea class='col1of1 height-xs' id='note' name='note'>{{>~currentInventoryPool.default_contract_note}}</textarea>\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/users/hand_over_documents_dialog","<div class='modal fade ui-modal medium min-height-m' role='dialog' tabindex='-1'>\n  <div class='modal-header row'>\n    <div class='col3of5'>\n      <h2 class='headline-l'>{{jed \"Hand over completed\"/}}</h2>\n      <h3 class='headline-m light'>\n        {{jed itemsCount \"%s item\" \"%s items\" itemsCount/}}\n        {{jed \"to %s\" contract.user().name()/}}\n      </h3>\n    </div>\n    <div class='col2of5 text-align-right'>\n      <div class='multibutton'>\n        <a class='button white text-ellipsis' href='{{dailyPath/}}'>{{jed \"Finish this hand over\"/}}</a>\n        <div class='dropdown-holder inline-block'>\n          <div class='button white dropdown-toggle'>\n            <div class='arrow down'></div>\n          </div>\n          <ul class='dropdown right'>\n            <li>\n              <a class='dropdown-item' href=''>\n                <i class='fa fa-undo'></i>\n                {{jed \"Back to this user\"/}}\n              </a>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class='modal-body'>\n    <div class='padding-inset-l margin-top-s'>\n      <div class='row emboss padding-inset-s margin-bottom-s'>\n        <div class='col1of3'></div>\n        <div class='col1of3'>\n          <a class='button white width-full' href='{{>contract.url()}}' target='_blank'>\n            <i class='fa fa-file-alt'></i>\n            {{jed \"Contract\"/}}\n          </a>\n        </div>\n        <div class='col1of3'></div>\n      </div>\n      <div class='row emboss padding-inset-s margin-bottom-s'>\n        <div class='col1of3'></div>\n        <div class='col1of3'>\n          <a class='button white width-full' href='{{>contract.url('value_list')}}' target='_blank'>\n            <i class='fa fa-list-ol'></i>\n            {{jed \"Value List\"/}}\n          </a>\n        </div>\n        <div class='col1of3'></div>\n      </div>\n    </div>\n  </div>\n</div>\n");
}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/users/line","<div class='row line'>\n  <div class='col1of5 line-col'>\n    <strong data-address='{{>address}}' data-badge_id='{{>badge_id}}' data-city='{{>city}}' data-email='{{>email}}' data-firstname='{{>firstname}}' data-id='{{>id}}' data-image_url='{{>image_url}}' data-lastname='{{>lastname}}' data-phone='{{>phone}}' data-type='user-cell' data-zip='{{>zip}}'>\n      {{>name()}}\n    </strong>\n  </div>\n  <div class='col1of5 line-col text-align-left'>\n    {{>phone}}\n  </div>\n  <div class='col1of5 line-col text-align-left'>\n    {{>roleName()}}\n  </div>\n  <div class='col1of5 line-col text-align-left darkred-text'>\n    {{if suspended()}}\n    {{jed \"Suspended until\"/}} {{date suspendedUntil()/}}\n    {{/if}}\n  </div>\n  <div class='col1of5 line-col line-actions'>\n    <div class='multibutton'>\n      {{if ~currentInventoryPool && accessRight()}}\n      <a class='button white' href='{{>url('hand_over')}}'>\n        <i class='fa fa-mail-forward'></i>\n        {{jed \"Hand Over\"/}}\n      </a>\n      <div class='dropdown-holder inline-block'>\n        <div class='button white dropdown-toggle'>\n          <div class='arrow down'></div>\n        </div>\n        <ul class='dropdown right'>\n          <li>\n            <a class='dropdown-item' href='{{>url('edit')}}'>\n              <i class='fa fa-edit'></i>\n              {{jed \"Edit\"/}}\n            </a>\n          </li>\n          <li>\n            <a class='dropdown-item' href='mailto:{{>email}}'>\n              <i class='fa fa-envelope'></i>\n              {{jed \"E-Mail\"/}}\n            </a>\n          </li>\n        </ul>\n      </div>\n      {{else}}\n      <a class='button white' href='{{>url('edit')}}'>\n        {{jed \"Edit\"/}}\n      </a>\n      <div class='dropdown-holder inline-block'>\n        <div class='button white dropdown-toggle'>\n          <div class='arrow down'></div>\n        </div>\n        <ul class='dropdown right'>\n          <li>\n            <a class='dropdown-item' href='mailto:{{>email}}'>\n              <i class='fa fa-envelope'></i>\n              {{jed \"E-Mail\"/}}\n            </a>\n          </li>\n          {{if !~currentInventoryPool}}\n          <li>\n            <a class='dropdown-item red' data-method='delete' href='{{>url()}}'>\n              <i class='fa fa-trash'></i>\n              {{jed \"Delete\"/}}\n            </a>\n          </li>\n          {{/if}}\n        </ul>\n      </div>\n      {{/if}}\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/users/search_result_line","<div class='row line'>\n  <div class='col2of8 line-col'>\n    <strong data-address='{{>address}}' data-badge_id='{{>badge_id}}' data-city='{{>city}}' data-email='{{>email}}' data-firstname='{{>firstname}}' data-id='{{>id}}' data-image_url='{{>image_url}}' data-lastname='{{>lastname}}' data-phone='{{>phone}}' data-type='user-cell' data-zip='{{>zip}}'>\n      {{>name()}}\n      {{if isSuspended()}}\n      <span class='darkred-text'>{{jed \"Suspended\"/}}!</span>\n      {{/if}}\n    </strong>\n  </div>\n  <div class='col2of8 line-col text-align-left'>\n    {{>city}}\n  </div>\n  <div class='col1of8 line-col text-align-left'>\n    {{if phone}}\n    <div class='row grey-text'>{{jed 'Phone'/}}</div>\n    {{>phone}}\n    {{/if}}\n  </div>\n  <div class='col1of8 line-col text-align-left'>\n    {{if badge_id}}\n    <div class='row grey-text'>{{jed 'Badge'/}}</div>\n    {{>badge_id}}\n    {{/if}}\n  </div>\n  <div class='col2of8 line-col line-actions'>\n    <div class='multibutton'>\n      <a class='button white' href='{{>url('hand_over')}}'>\n        <i class='fa fa-mail-forward'></i>\n        {{jed \"Hand Over\"/}}\n      </a>\n      <div class='dropdown-holder inline-block'>\n        <div class='button white dropdown-toggle'>\n          <div class='arrow down'></div>\n        </div>\n        <ul class='dropdown right'>\n          <li>\n            <a class='dropdown-item' href='{{>url('edit')}}'>\n              <i class='fa fa-edit'></i>\n              {{jed \"Edit\"/}}\n            </a>\n          </li>\n          <li>\n            <a class='dropdown-item' href='mailto:{{>email}}'>\n              <i class='fa fa-envelope'></i>\n              {{jed \"E-Mail\"/}}\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/users/take_back_dialog","<div class='modal fade ui-modal medium' role='dialog' tabindex='-1'>\n  <div class='modal-header row'>\n    <div class='col3of5'>\n      <h2 class='headline-l'>{{jed itemsCount \"Take back of %s item\" \"Take back of %s items\" itemsCount/}}</h2>\n      <h3 class='headline-m light'>\n        {{>user.firstname}} {{>user.lastname}}\n      </h3>\n    </div>\n    <div class='col2of5 text-align-right'>\n      <div class='modal-close'>{{jed \"Cancel\"/}}</div>\n      <button class='button green' data-take-back>\n        <i class='fa fa-mail-reply'></i>\n        {{jed \"Take Back\"/}}\n      </button>\n    </div>\n  </div>\n  <div class='row margin-top-s padding-horizontal-l'>\n    <div class='modal-body'>\n      {{for groupedLines}}\n      <div class='padding-bottom-m margin-bottom-m no-last-child-margin'>\n        <div class='row margin-bottom-s'>\n          <div class='col1of2'>\n            <p>\n              {{date start_date/}}\n              -\n              {{date end_date/}}\n            </p>\n          </div>\n          <div class='col1of2 text-align-right'>\n            <strong>{{diffDatesInDays start_date end_date/}}</strong>\n          </div>\n        </div>\n        {{for reservations}}\n        <div class='row'>\n          <div class='col1of8 text-align-center'>\n            <div class='paragraph-s'>\n              {{if ~returnedQuantity[id]}}\n              {{> ~returnedQuantity[id]}}/{{>quantity}}\n              {{else}}\n              {{if subreservations}}\n              {{sum subreservations \"quantity\"/}}\n              {{else}}\n              {{> quantity}}\n              {{/if}}\n              {{/if}}\n            </div>\n          </div>\n          <div class='col7of8'>\n            <div class='paragraph-s'>\n              <strong>{{>model().name()}}</strong>\n            </div>\n          </div>\n        </div>\n        {{/for}}\n      </div>\n      {{/for}}\n    </div>\n  </div>\n  <div class='modal-footer'></div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/users/take_back_documents_dialog","<div class='modal fade ui-modal medium min-height-m' role='dialog' tabindex='-1'>\n  <div class='modal-header row'>\n    <div class='col3of5'>\n      <h2 class='headline-l'>{{jed \"Take back completed\"/}}</h2>\n      <h3 class='headline-m light'>\n        {{jed itemsCount \"%s item\" \"%s items\" itemsCount/}}\n        {{jed \"from %s\" user.name()/}}\n      </h3>\n    </div>\n    <div class='col2of5 text-align-right'>\n      <div class='multibutton'>\n        <a class='button white text-ellipsis' href='{{dailyPath/}}'>{{jed \"Finish this take back\"/}}</a>\n        <div class='dropdown-holder inline-block'>\n          <div class='button white dropdown-toggle'>\n            <div class='arrow down'></div>\n          </div>\n          <ul class='dropdown right'>\n            <li>\n              <a class='dropdown-item' href=''>\n                <i class='fa fa-undo'></i>\n                {{jed \"Back to this user\"/}}\n              </a>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class='modal-body'>\n    <div class='padding-inset-l margin-top-s'>\n      {{for contracts}}\n      <div class='row emboss padding-inset-s margin-bottom-s'>\n        <div class='col1of6'></div>\n        <div class='col2of6 padding-inset-s'>\n          <a class='button white width-full' href='{{>url()}}' target='_blank'>\n            <i class='fa fa-file-alt'></i>\n            {{jed \"Contract\"/}}\n            {{>compact_id}}\n          </a>\n        </div>\n        <div class='col2of6 padding-inset-s'>\n          <a class='button white width-full' href='{{>url('value_list')}}' target='_blank'>\n            <i class='fa fa-list-ol'></i>\n            {{jed \"Value List\"/}}\n          </a>\n        </div>\n        <div class='col1of6'></div>\n      </div>\n      {{/for}}\n    </div>\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/users/tooltip","<div class='row width-xl min-height-s padding-right-s padding-left-s'>\n  <div class='col3of4'>\n    <div class='row'>\n      <h3 class='headline-l'>{{>firstname}} {{>lastname}}</h3>\n      <h3 class='headline-s light'>{{>email}}</h3>\n    </div>\n    {{if delegator_user()}}\n    <div class='row margin-top-m'>\n      <p class='paragraph-s line-height-s'>{{jed \"Responsible\"/}}: {{>delegator_user().name()}}</p>\n    </div>\n    {{/if}}\n    {{if address}}\n    <div class='row margin-top-m'>\n      <p class='paragraph-xs line-height-s'>{{jed \"Address\"/}}</p>\n      <p class='paragraph-s line-height-s'>{{>address}}{{>zip}} {{>city}}</p>\n    </div>\n    {{/if}}\n    {{if phone}}\n    <div class='row margin-top-m'>\n      <p class='paragraph-xs line-height-s'>{{jed \"Phone\"/}}</p>\n      <p class='paragraph-s line-height-s'>{{>phone}}</p>\n    </div>\n    {{/if}}\n    {{if badge_id}}\n    <div class='row margin-top-m'>\n      <p class='paragraph-xs line-height-s'>{{jed \"Badge\"/}}</p>\n      <p class='paragraph-s line-height-s'>{{>badge_id}}</p>\n    </div>\n    {{/if}}\n  </div>\n  <div class='col1of4'>\n    {{if image_url}}\n    <img class='max-size-xxs margin-horziontal-auto' src='{{>image_url/}}'>\n    {{/if}}\n  </div>\n</div>\n")}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews}),function(t){t.views.templates("manage/views/visits/line",'{{include tmpl="manage/views/"+action+"s/line" /}}\n')}("undefined"!=typeof jQuery&&null!==jQuery?jQuery:{views:jsviews});